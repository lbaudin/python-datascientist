<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lino Galiana">
<meta name="dcterms.date" content="2020-09-08">
<meta name="description" content="Python permet de facilement récupérer une page web pour en extraire des données à restructurer. Le web scraping, que les Canadiens nomment “moissonnage du web”, est une manière de plus en plus utilisée de récupérer une grande masse d’information en temps réel.">

<title>Python pour la data science - Webscraping avec python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../content/manipulation/04c_API_TP.html" rel="next">
<link href="../../content/manipulation/03_geopandas_TP.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #e9f3fa;
      }
</style>


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="Python pour la data science - Webscraping avec python">
<meta name="twitter:description" content="Python permet de facilement récupérer une page web pour en extraire des
données à restructurer. Le web scraping, que les Canadiens nomment
“moissonnage du web”, est une manière de plus en plus utilisée de
récupérer une grande masse d’information en temps réel.">
<meta name="twitter:image" content="https://pythonds.linogaliana.fr/content/manipulation/featured_webscraping.jpg">
<meta name="twitter:card" content="summary_large_image">
<meta name="citation_title" content="Python pour la data science">
<meta name="citation_author" content="Lino Galiana">
<meta name="citation_publication_date" content="2023">
<meta name="citation_cover_date" content="2023">
<meta name="citation_year" content="2023">
<meta name="citation_online_date" content="2020-09-08">
<meta name="citation_fulltext_html_url" content="https://pythonds.linogaliana.fr/">
<meta name="citation_doi" content="10.5281/zenodo.8229676">
<meta name="citation_language" content="en">
</head>

<body class="nav-sidebar floating nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Python pour la data science</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-introduction" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Introduction</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-introduction">    
        <li>
    <a class="dropdown-item" href="../../content/getting-started/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/01_installation.html" rel="" target="">
 <span class="dropdown-text">Configuration de Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/02_DS_environment.html" rel="" target="">
 <span class="dropdown-text">L’environnement Python pour la data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/03_data_analysis.html" rel="" target="">
 <span class="dropdown-text">Comment aborder un jeu de données</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/04_python_practice.html" rel="" target="">
 <span class="dropdown-text">Bonne pratique de Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/05_rappels_types.html" rel="" target="">
 <span class="dropdown-text">Quelques rappels sur les principes de base de Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/06_rappels_fonctions.html" rel="" target="">
 <span class="dropdown-text">Modules, tests, boucles, fonctions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/07_rappels_classes.html" rel="" target="">
 <span class="dropdown-text">Les classes en Python</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-manipuler" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Manipuler</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-manipuler">    
        <li>
    <a class="dropdown-item" href="../../content/manipulation/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/01_numpy.html" rel="" target="">
 <span class="dropdown-text">Numpy, la brique de base de la data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/02a_pandas_tutorial.html" rel="" target="">
 <span class="dropdown-text">Introduction à Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/02b_pandas_TP.html" rel="" target="">
 <span class="dropdown-text">Pratique de pandas : un exemple complet</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/03_geopandas_tutorial.html" rel="" target="">
 <span class="dropdown-text">Données spatiales : découverte de geopandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/03_geopandas_TP.html" rel="" target="">
 <span class="dropdown-text">Pratique de geopandas avec les données vélib</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04a_webscraping_TP.html" rel="" target="">
 <span class="dropdown-text">Webscraping avec python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04c_API_TP.html" rel="" target="">
 <span class="dropdown-text">Récupérer des données avec des API depuis Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04b_regex_TP.html" rel="" target="">
 <span class="dropdown-text">Maîtriser les expressions régulières</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/07_dask.html" rel="" target="">
 <span class="dropdown-text">Introduction à dask grâce aux données DVF</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-communiquer" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Communiquer</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-communiquer">    
        <li>
    <a class="dropdown-item" href="../../content/visualisation/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/visualisation/matplotlib.html" rel="" target="">
 <span class="dropdown-text">De beaux graphiques avec python: mise en pratique</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/visualisation/maps.html" rel="" target="">
 <span class="dropdown-text">De belles cartes avec python: mise en pratique</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-modéliser" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Modéliser</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-modéliser">    
        <li>
    <a class="dropdown-item" href="../../content/modelisation/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/0_preprocessing.html" rel="" target="">
 <span class="dropdown-text">Préparation des données pour construire un modèle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/1_modelevaluation.html" rel="" target="">
 <span class="dropdown-text">Evaluer la qualité d’un modèle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/2_SVM.html" rel="" target="">
 <span class="dropdown-text">Classification: premier modèle avec les SVM</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/3_regression.html" rel="" target="">
 <span class="dropdown-text">Régression : une introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/4_featureselection.html" rel="" target="">
 <span class="dropdown-text">Sélection de variables : une introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/5_clustering.html" rel="" target="">
 <span class="dropdown-text">Clustering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/6_pipeline.html" rel="" target="">
 <span class="dropdown-text">Premier pas vers l’industrialisation avec les pipelines scikit</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-approfondissements" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Approfondissements</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-approfondissements">    
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/continuous_integration.html" rel="" target="">
 <span class="dropdown-text">Intégration continue avec Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/dallE.html" rel="" target="">
 <span class="dropdown-text">Génération d’images avec Python, DALL-E et StableDiffusion</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/s3.html" rel="" target="">
 <span class="dropdown-text">Les nouveaux modes d’accès aux données : le format parquet et les données sur le cloud</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/elastic_approfondissement.html" rel="" target="">
 <span class="dropdown-text">Approfondissement ElasticSearch pour des recherches de proximité géographique</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/elastic_intro.html" rel="" target="">
 <span class="dropdown-text">Introduction à ElasticSearch pour la recherche textuelle</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-git" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Git</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-git">    
        <li>
    <a class="dropdown-item" href="../../content/git/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/git/introgit.html" rel="" target="">
 <span class="dropdown-text">Git : un élément essentiel au quotidien</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/git/exogit.html" rel="" target="">
 <span class="dropdown-text">Un cadavre exquis pour découvrir Git</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-annexes" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Annexes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-annexes">    
        <li>
    <a class="dropdown-item" href="../../content/annexes/evaluation.html" rel="" target="">
 <span class="dropdown-text">Evaluation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/annexes/corrections.html" rel="" target="">
 <span class="dropdown-text">Corrections</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://linogaliana.github.io/python-datascientist-slides/#/title-slide" rel="" target="">
 <span class="dropdown-text">Slides de présentation</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="https://github.com/linogaliana/python-datascientist">
            Code source
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../content/manipulation/04a_webscraping_TP.html">Webscraping avec python</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Webscraping avec python</h1>
                  <div>
        <div class="description">
          <p><code>Python</code> permet de facilement récupérer une page web pour en extraire des
          données à restructurer. Le web scraping, que les Canadiens nomment
          <em>“moissonnage du web”</em>, est une manière de plus en plus utilisée de
          récupérer une grande masse d’information en temps réel.</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Exercice</div>
                <div class="quarto-category">Manipulation</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Lino Galiana </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 8, 2020</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/01_numpy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Numpy, la brique de base de la data science</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/02a_pandas_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction à Pandas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/02b_pandas_TP.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pratique de pandas : un exemple complet</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/03_geopandas_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Données spatiales : découverte de geopandas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/03_geopandas_TP.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pratique de geopandas avec les données vélib</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/04a_webscraping_TP.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Webscraping avec python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/04c_API_TP.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Récupérer des données avec des API depuis Python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/04b_regex_TP.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Maîtriser les expressions régulières</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/07_dask.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction à dask grâce aux données DVF</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#enjeux" id="toc-enjeux" class="nav-link active" data-scroll-target="#enjeux">Enjeux</a>
  <ul class="collapse">
  <li><a href="#la-zone-grise-de-la-légalité-du-web-scraping" id="toc-la-zone-grise-de-la-légalité-du-web-scraping" class="nav-link" data-scroll-target="#la-zone-grise-de-la-légalité-du-web-scraping">La zone grise de la légalité du <em>web scraping</em></a></li>
  <li><a href="#stabilité-et-fiabilité-des-informations-reçues" id="toc-stabilité-et-fiabilité-des-informations-reçues" class="nav-link" data-scroll-target="#stabilité-et-fiabilité-des-informations-reçues">Stabilité et fiabilité des informations reçues</a></li>
  <li><a href="#les-bonnes-pratiques" id="toc-les-bonnes-pratiques" class="nav-link" data-scroll-target="#les-bonnes-pratiques">Les bonnes pratiques</a></li>
  </ul></li>
  <li><a href="#un-détour-par-le-web-comment-fonctionne-un-site" id="toc-un-détour-par-le-web-comment-fonctionne-un-site" class="nav-link" data-scroll-target="#un-détour-par-le-web-comment-fonctionne-un-site">Un détour par le Web : comment fonctionne un site ?</a>
  <ul class="collapse">
  <li><a href="#les-balises" id="toc-les-balises" class="nav-link" data-scroll-target="#les-balises">Les balises</a></li>
  </ul></li>
  <li><a href="#scraper-avec-python-le-package-beautifulsoup" id="toc-scraper-avec-python-le-package-beautifulsoup" class="nav-link" data-scroll-target="#scraper-avec-python-le-package-beautifulsoup">Scraper avec <code>Python</code>: le package <code>BeautifulSoup</code></a>
  <ul class="collapse">
  <li><a href="#les-packages-disponibles" id="toc-les-packages-disponibles" class="nav-link" data-scroll-target="#les-packages-disponibles">Les packages disponibles</a></li>
  <li><a href="#récupérer-le-contenu-dune-page-html" id="toc-récupérer-le-contenu-dune-page-html" class="nav-link" data-scroll-target="#récupérer-le-contenu-dune-page-html">Récupérer le contenu d’une page HTML</a></li>
  <li><a href="#la-méthode-find" id="toc-la-méthode-find" class="nav-link" data-scroll-target="#la-méthode-find">La méthode <code>find</code></a></li>
  <li><a href="#la-méthode-findall" id="toc-la-méthode-findall" class="nav-link" data-scroll-target="#la-méthode-findall">La méthode <code>findAll</code></a></li>
  </ul></li>
  <li><a href="#exercice-guidé-obtenir-la-liste-des-équipes-de-ligue-1" id="toc-exercice-guidé-obtenir-la-liste-des-équipes-de-ligue-1" class="nav-link" data-scroll-target="#exercice-guidé-obtenir-la-liste-des-équipes-de-ligue-1">Exercice guidé : obtenir la liste des équipes de Ligue 1</a></li>
  <li><a href="#pour-aller-plus-loin" id="toc-pour-aller-plus-loin" class="nav-link" data-scroll-target="#pour-aller-plus-loin">Pour aller plus loin</a>
  <ul class="collapse">
  <li><a href="#récupération-des-localisations-des-stades" id="toc-récupération-des-localisations-des-stades" class="nav-link" data-scroll-target="#récupération-des-localisations-des-stades">Récupération des localisations des stades</a></li>
  <li><a href="#cartes-stades-ligue1" id="toc-cartes-stades-ligue1" class="nav-link" data-scroll-target="#cartes-stades-ligue1">Carte des stades avec <code>folium</code></a></li>
  </ul></li>
  <li><a href="#récupérer-des-informations-sur-les-pokemons" id="toc-récupérer-des-informations-sur-les-pokemons" class="nav-link" data-scroll-target="#récupérer-des-informations-sur-les-pokemons">Récupérer des informations sur les pokemons</a>
  <ul class="collapse">
  <li><a href="#version-non-guidée" id="toc-version-non-guidée" class="nav-link" data-scroll-target="#version-non-guidée">Version non guidée</a></li>
  <li><a href="#version-guidée" id="toc-version-guidée" class="nav-link" data-scroll-target="#version-guidée">Version guidée</a></li>
  </ul></li>
  <li><a href="#selenium-mimer-le-comportement-dun-utilisateur-internet" id="toc-selenium-mimer-le-comportement-dun-utilisateur-internet" class="nav-link" data-scroll-target="#selenium-mimer-le-comportement-dun-utilisateur-internet"><code>Selenium</code> : mimer le comportement d’un utilisateur internet</a>
  <ul class="collapse">
  <li><a href="#premier-exemple-en-scrapant-un-moteur-de-recherche" id="toc-premier-exemple-en-scrapant-un-moteur-de-recherche" class="nav-link" data-scroll-target="#premier-exemple-en-scrapant-un-moteur-de-recherche">Premier exemple en scrapant un moteur de recherche</a></li>
  <li><a href="#utiliser-selenium-pour-jouer-à-2048" id="toc-utiliser-selenium-pour-jouer-à-2048" class="nav-link" data-scroll-target="#utiliser-selenium-pour-jouer-à-2048">Utiliser selenium pour jouer à 2048</a></li>
  </ul></li>
  <li><a href="#exercices-supplémentaires" id="toc-exercices-supplémentaires" class="nav-link" data-scroll-target="#exercices-supplémentaires">Exercices supplémentaires</a>
  <ul class="collapse">
  <li><a href="#récupérer-les-noms-et-âges-des-ministres-français" id="toc-récupérer-les-noms-et-âges-des-ministres-français" class="nav-link" data-scroll-target="#récupérer-les-noms-et-âges-des-ministres-français">Récupérer les noms et âges des ministres français</a></li>
  <li><a href="#analyse-textuelle-des-commentaires-clients-de-services-de-commande-de-repas-en-ligne" id="toc-analyse-textuelle-des-commentaires-clients-de-services-de-commande-de-repas-en-ligne" class="nav-link" data-scroll-target="#analyse-textuelle-des-commentaires-clients-de-services-de-commande-de-repas-en-ligne">Analyse textuelle des commentaires clients de services de commande de repas en ligne</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/linogaliana/python-datascientist/edit/master/content/manipulation/04a_webscraping_TP.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/linogaliana/python-datascientist/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="cell markdown">
<p class="badges">
<a href="https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/04a_webscraping_TP.ipynb" class="github"><i class="fab fa-github"></i></a>
<a href="https://downgit.github.io/#/home?url=https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/04a_webscraping_TP.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Download-Notebook-important?logo=Jupyter" alt="Download"></a>
<a href="https://nbviewer.jupyter.org/github/linogaliana/python-datascientist-notebooksblob/main/notebooks/manipulation/04a_webscraping_TP.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Visualize-nbviewer-blue?logo=Jupyter" alt="nbviewer"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/jupyter-python?autoLaunch=true&amp;onyxia.friendlyName=%C2%ABpython-datascience%C2%BB&amp;init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmaster%2Fsspcloud%2Finit-jupyter.sh%C2%BB&amp;init.personalInitArgs=%C2%ABmanipulation%2004a_webscraping_TP%C2%BB&amp;security.allowlist.enabled=false" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Tester_avec_Jupyter-orange?logo=Jupyter&amp;logoColor=orange" alt="Onyxia"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/vscode-python?autoLaunch=true&amp;onyxia.friendlyName=%C2%ABpython-datascience%C2%BB&amp;init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmaster%2Fsspcloud%2Finit-vscode.sh%C2%BB&amp;init.personalInitArgs=%C2%ABmanipulation%2004a_webscraping_TP%C2%BB&amp;security.allowlist.enabled=false" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Tester_avec_VSCode-blue?logo=visualstudiocode&amp;logoColor=blue" alt="Onyxia"></a><br>
<a href="https://mybinder.org/v2/gh/linogaliana/python-datascientist-notebooks/main?filepath={binder_path}" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Launch-Binder-E66581.svg?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFkAAABZCAMAAABi1XidAAAB8lBMVEX///9XmsrmZYH1olJXmsr1olJXmsrmZYH1olJXmsr1olJXmsrmZYH1olL1olJXmsr1olJXmsrmZYH1olL1olJXmsrmZYH1olJXmsr1olL1olJXmsrmZYH1olL1olJXmsrmZYH1olL1olL0nFf1olJXmsrmZYH1olJXmsq8dZb1olJXmsrmZYH1olJXmspXmspXmsr1olL1olJXmsrmZYH1olJXmsr1olL1olJXmsrmZYH1olL1olLeaIVXmsrmZYH1olL1olL1olJXmsrmZYH1olLna31Xmsr1olJXmsr1olJXmsrmZYH1olLqoVr1olJXmsr1olJXmsrmZYH1olL1olKkfaPobXvviGabgadXmsqThKuofKHmZ4Dobnr1olJXmsr1olJXmspXmsr1olJXmsrfZ4TuhWn1olL1olJXmsqBi7X1olJXmspZmslbmMhbmsdemsVfl8ZgmsNim8Jpk8F0m7R4m7F5nLB6jbh7jbiDirOEibOGnKaMhq+PnaCVg6qWg6qegKaff6WhnpKofKGtnomxeZy3noG6dZi+n3vCcpPDcpPGn3bLb4/Mb47UbIrVa4rYoGjdaIbeaIXhoWHmZYHobXvpcHjqdHXreHLroVrsfG/uhGnuh2bwj2Hxk17yl1vzmljzm1j0nlX1olL3AJXWAAAAbXRSTlMAEBAQHx8gICAuLjAwMDw9PUBAQEpQUFBXV1hgYGBkcHBwcXl8gICAgoiIkJCQlJicnJ2goKCmqK+wsLC4usDAwMjP0NDQ1NbW3Nzg4ODi5+3v8PDw8/T09PX29vb39/f5+fr7+/z8/Pz9/v7+zczCxgAABC5JREFUeAHN1ul3k0UUBvCb1CTVpmpaitAGSLSpSuKCLWpbTKNJFGlcSMAFF63iUmRccNG6gLbuxkXU66JAUef/9LSpmXnyLr3T5AO/rzl5zj137p136BISy44fKJXuGN/d19PUfYeO67Znqtf2KH33Id1psXoFdW30sPZ1sMvs2D060AHqws4FHeJojLZqnw53cmfvg+XR8mC0OEjuxrXEkX5ydeVJLVIlV0e10PXk5k7dYeHu7Cj1j+49uKg7uLU61tGLw1lq27ugQYlclHC4bgv7VQ+TAyj5Zc/UjsPvs1sd5cWryWObtvWT2EPa4rtnWW3JkpjggEpbOsPr7F7EyNewtpBIslA7p43HCsnwooXTEc3UmPmCNn5lrqTJxy6nRmcavGZVt/3Da2pD5NHvsOHJCrdc1G2r3DITpU7yic7w/7Rxnjc0kt5GC4djiv2Sz3Fb2iEZg41/ddsFDoyuYrIkmFehz0HR2thPgQqMyQYb2OtB0WxsZ3BeG3+wpRb1vzl2UYBog8FfGhttFKjtAclnZYrRo9ryG9uG/FZQU4AEg8ZE9LjGMzTmqKXPLnlWVnIlQQTvxJf8ip7VgjZjyVPrjw1te5otM7RmP7xm+sK2Gv9I8Gi++BRbEkR9EBw8zRUcKxwp73xkaLiqQb+kGduJTNHG72zcW9LoJgqQxpP3/Tj//c3yB0tqzaml05/+orHLksVO+95kX7/7qgJvnjlrfr2Ggsyx0eoy9uPzN5SPd86aXggOsEKW2Prz7du3VID3/tzs/sSRs2w7ovVHKtjrX2pd7ZMlTxAYfBAL9jiDwfLkq55Tm7ifhMlTGPyCAs7RFRhn47JnlcB9RM5T97ASuZXIcVNuUDIndpDbdsfrqsOppeXl5Y+XVKdjFCTh+zGaVuj0d9zy05PPK3QzBamxdwtTCrzyg/2Rvf2EstUjordGwa/kx9mSJLr8mLLtCW8HHGJc2R5hS219IiF6PnTusOqcMl57gm0Z8kanKMAQg0qSyuZfn7zItsbGyO9QlnxY0eCuD1XL2ys/MsrQhltE7Ug0uFOzufJFE2PxBo/YAx8XPPdDwWN0MrDRYIZF0mSMKCNHgaIVFoBbNoLJ7tEQDKxGF0kcLQimojCZopv0OkNOyWCCg9XMVAi7ARJzQdM2QUh0gmBozjc3Skg6dSBRqDGYSUOu66Zg+I2fNZs/M3/f/Grl/XnyF1Gw3VKCez0PN5IUfFLqvgUN4C0qNqYs5YhPL+aVZYDE4IpUk57oSFnJm4FyCqqOE0jhY2SMyLFoo56zyo6becOS5UVDdj7Vih0zp+tcMhwRpBeLyqtIjlJKAIZSbI8SGSF3k0pA3mR5tHuwPFoa7N7reoq2bqCsAk1HqCu5uvI1n6JuRXI+S1Mco54YmYTwcn6Aeic+kssXi8XpXC4V3t7/ADuTNKaQJdScAAAAAElFTkSuQmCC" alt="Binder"></a>
<a href="https://colab.research.google.com/github/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/04a_webscraping_TP.ipynb" target="_blank" rel="noopener"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a>
<a href="https://github.dev/linogaliana/python-datascientist-notebooks/notebooks/manipulation/04a_webscraping_TP.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/static/v1?logo=visualstudiocode&amp;label=&amp;message=Open%20in%20Visual%20Studio%20Code&amp;labelColor=2c2c32&amp;color=007acc&amp;logoColor=007acc" alt="githubdev"></a>
</p>
<p></p>
</div>
<p>Le <a href="https://fr.wikipedia.org/wiki/Web_scraping">webscraping</a> désigne les techniques d’extraction du contenu des sites internet.
C’est une pratique très utile pour toute personne souhaitant travailler sur des informations disponibles en ligne, mais n’existant pas forcément sous la forme d’un tableau <em>Excel</em>.</p>
<p>Ce TP vous présente comment créer et exécuter des robots afin de recupérer rapidement des informations utiles à vos projets actuels ou futurs.
Il part de quelques cas d’usages concret.
Ce chapitre est très fortement inspiré et réadapté à partir de <a href="http://www.xavierdupre.fr/app/ensae_teaching_cs/helpsphinx/notebooks/TD2A_Eco_Web_Scraping.html">celui de Xavier Dupré</a>, l’ancien professeur de la matière.</p>
<section id="enjeux" class="level2">
<h2 class="anchored" data-anchor-id="enjeux">Enjeux</h2>
<p>Un certain nombre d’enjeux du <em>web scraping</em> ne seront évoqués
que superficiellement dans le cadre de ce chapitre.</p>
<section id="la-zone-grise-de-la-légalité-du-web-scraping" class="level3">
<h3 class="anchored" data-anchor-id="la-zone-grise-de-la-légalité-du-web-scraping">La zone grise de la légalité du <em>web scraping</em></h3>
<p>En premier lieu, en ce qui concerne la question de la légalité
de la récupération d’information par <em>scraping</em>, il existe
une zone grise. Ce n’est pas parce qu’une information est
disponible sur internet, directement ou avec un peu de recherche,
qu’elle peut être récupérée et réutilisée.</p>
<p>L’excellent cours d’<a href="https://inseefrlab.github.io/formation-webscraping/">Antoine Palazzolo</a> évoque un certain nombre de cas
médiatiques et judiciaires sur cette question.
Dans le champ français, la CNIL a publié en 2020
de nouvelles directives sur le <em>webscraping</em> reprécisant
que toute donnée ne peut être réutilisée à l’insu de la personne
à laquelle ces données appartiennent. Autrement dit, en principe,
les données collectées par <em>web scraping</em> sont soumises au
RGPD, c’est-à-dire nécessitent le consentement des personnes
à partir desquelles la réutilisation des données est faite.</p>
<p>Il est donc recommandé d’<strong>être vigilant avec les données récupérées</strong>
par <em>web scraping</em> pour ne pas se mettre en faute légalement.</p>
</section>
<section id="stabilité-et-fiabilité-des-informations-reçues" class="level3">
<h3 class="anchored" data-anchor-id="stabilité-et-fiabilité-des-informations-reçues">Stabilité et fiabilité des informations reçues</h3>
<p>La récupération de données par <em>web scraping</em>
est certes pratique mais elle ne correspond pas nécessairement
à un usage pensé, ou désiré, par un fournisseur de données.
Les données étant coûteuses à collecter et à mettre à disposition,
certains sites ne désirent pas nécessairement que celles-ci soient
extraites gratuitement et facilement. <em>A fortiori</em> lorsque la donnée
peut permettre à un concurrent de disposer d’une information
utile d’un point de vue commercial (prix d’un produit concurrent, etc.).</p>
<p>Les acteurs mettent donc souvent en oeuvre des stratégies pour bloquer ou
limiter la quantité de données scrappées. La méthode la plus
classique est la détection et le blocage
des requêtes faites par des robots plutôt que par des humains.
Pour des acteurs spécialisés, cette détection est très facile car
de nombreuses preuves permettent d’identifier si une visite du site <em>web</em>
provient d’un utilisateur
humain derrière un navigateur ou d’un robot. Pour ne citer que quelques indices:
vitesse de la navigation entre pages, rapidité à extraire la donnée,
empreinte digitale du navigateur utilisé, capacité à répondre à des
questions aléatoires (captcha)…
Les bonnes pratiques, évoquées par la suite, ont pour objectif de faire
en sorte qu’un robot se comporte de manière civile en adoptant un comportement
proche de celui de l’humain mais sans contrefaire le fait qu’il ne s’agit
pas d’un humain.</p>
<p>Il convient d’ailleurs
d’être prudent quant aux informations reçues par <em>web scraping</em>.
La donnée étant au coeur du modèle économique de certains acteurs, certains
n’hésitent pas à renvoyer des données fausses aux robots
plutôt que les bloquer. C’est de bonne guerre!
Une autre technique piège s’appelle le <em>honey pot</em>. Il s’agit de pages qu’un humain
n’irait jamais visiter - par exemple parce qu’elles n’apparaissent pas dans
l’interface graphique - mais sur lesquelles un robot, en recherche automatique
de contenu, va rester bloquer.</p>
<p>Sans aller jusqu’à la stratégie de blocage du <em>web scraping</em>, d’autres raisons
peuvent expliquer qu’une récupération de données ait fonctionné par
le passé mais ne fonctionne plus. La plus fréquente est un changement dans la structure
d’un site <em>web</em>. Le <em>web scraping</em> présente en effet l’inconvénient d’aller chercher
de l’information dans une structure très hiérarchisée. Un changement dans cette structure
peut suffire à rendre un robot incapable de récupérer du contenu. Or, pour rester
attractifs, les sites <em>web</em> changent fréquemment ce qui peut facilement
rendre inopérant un robot.</p>
<p>De manière générale, l’un des principaux messages de ce
chapitre, à retenir, est que le
<strong>webscraping est une solution de dernier ressort, pour des récupérations ponctuelles de données sans garantie de fonctionnement ultérieur</strong>. Il est préférable de <strong>privilégier les API</strong> lorsque celles-ci sont disponibles.
Ces dernières ressemblent à un contrat (formel ou non) entre un fournisseur de données
et un utilisateur où sont définis des besoins (les données) mais aussi des
conditions d’accès (nombre de requêtes, volumétrie, authentification…) là
où le <em>web scraping</em> est plus proche du comportement dans le <em>Far West</em>.</p>
</section>
<section id="les-bonnes-pratiques" class="level3">
<h3 class="anchored" data-anchor-id="les-bonnes-pratiques">Les bonnes pratiques</h3>
<p>La possibilité de récupérer des données par l’intermédiaire
d’un robot ne signifie pas qu’on peut se permettre de n’être
pas civilisé. En effet, lorsqu’il est non-maîtrisé, le
<em>webscraping</em> peut ressembler à une attaque informatique
classique pour faire sauter un site <em>web</em> : le déni de service.
Le cours d’<a href="https://inseefrlab.github.io/formation-webscraping/">Antoine Palazzolo</a> revient
sur certaines bonnes pratiques qui ont émergé dans la communauté
des <em>scrapeurs</em>. Il est recommandé de lire cette ressource
pour en apprendre plus sur ce sujet. Y sont évoqués
plusieurs conventions, parmi lesquelles :</p>
<ul>
<li>Se rendre, depuis la racine du site,
sur le fichier <code>robots.txt</code> pour vérifier les consignes
proposées par les développeurs du site <em>web</em> pour
cadrer le comportement des robots ;</li>
<li>Espacer chaque requêtes de plusieurs secondes, comme le ferait
un humain, afin d’éviter de surcharger le site <em>web</em> et de le
faire sauter par déni de service ;</li>
<li>Faire les requêtes dans les heures creuses de fréquentation du
site <em>web</em> s’il ne s’agit pas d’un site consulté internationalement.
Par exemple, pour un site en Français, lancer le robot
pendant la nuit en France métropolitaine, est une bonne pratique.
Pour lancer un robot depuis <code>Python</code> a une heure programmée
à l’avancer, il existe les <code>cronjobs</code>.</li>
</ul>
</section>
</section>
<section id="un-détour-par-le-web-comment-fonctionne-un-site" class="level2">
<h2 class="anchored" data-anchor-id="un-détour-par-le-web-comment-fonctionne-un-site">Un détour par le Web : comment fonctionne un site ?</h2>
<p>Même si ce TP ne vise pas à faire un cours de web, il vous faut néanmoins certaines bases sur la manière dont un site internet fonctionne afin de comprendre comment sont structurées les informations sur une page.</p>
<p>Un site Web est un ensemble de pages codées en <em>HTML</em> qui permet de décrire à la fois le contenu et la forme d’une page <em>Web</em>.</p>
<p>Pour voir cela, ouvrez n’importe quelle page web et faites un clic-droit dessus.
- Sous <code>Chrome</code> <i class="fab fa-chrome"></i> : Cliquez ensuite sur <em>“Affichez le code source de la page”</em> (<kbd>CTRL</kbd>+<kbd>U</kbd>) ;
- Sous <code>Firefox</code> <i class="fab fa-firefox"></i> : <em>“Code source de la page”</em> (<kbd>CTRL</kbd>+<kbd>MAJ</kbd>+<kbd>K</kbd>) ;
- Sous <code>Edge</code> <i class="fab fa-edge"></i> : <em>“Affichez la page source”</em> (<kbd>CTRL</kbd>+<kbd>U</kbd>) ;
- Sous <code>Safari</code> <i class="fab fa-safari"></i> : voir comment faire <a href="https://fr.wikihow.com/voir-le-code-source">ici</a></p>
<section id="les-balises" class="level3">
<h3 class="anchored" data-anchor-id="les-balises">Les balises</h3>
<p>Sur une page web, vous trouverez toujours à coup sûr des éléments comme <code>&lt;head&gt;</code>, <code>&lt;title&gt;</code>, etc. Il s’agit des codes qui vous permettent de structurer le contenu d’une page <em>HTML</em> et qui s’appellent des <strong>balises</strong>.
Citons, par exemple, les balises <code>&lt;p&gt;</code>, <code>&lt;h1&gt;</code>, <code>&lt;h2&gt;</code>, <code>&lt;h3&gt;</code>, <code>&lt;strong&gt;</code> ou <code>&lt;em&gt;</code>.
Le symbole <code>&lt; &gt;</code> est une balise : il sert à indiquer le début d’une partie. Le symbole <code>&lt;/ &gt;</code> indique la fin de cette partie. La plupart des balises vont par paires, avec une <em>balise ouvrante</em> et une <em>balise fermante</em> (par exemple <code>&lt;p&gt;</code> et <code>&lt;/p&gt;</code>).</p>
<section id="exemple-les-balise-des-tableaux" class="level4">
<h4 class="anchored" data-anchor-id="exemple-les-balise-des-tableaux">Exemple : les balise des tableaux</h4>
<table class="table">
<thead>
<tr class="header">
<th>Balise</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&lt;table&gt;</code></td>
<td>Tableau</td>
</tr>
<tr class="even">
<td><code>&lt;caption&gt;</code></td>
<td>Titre du tableau</td>
</tr>
<tr class="odd">
<td><code>&lt;tr&gt;</code></td>
<td>Ligne de tableau</td>
</tr>
<tr class="even">
<td><code>&lt;th&gt;</code></td>
<td>Cellule d’en-tête</td>
</tr>
<tr class="odd">
<td><code>&lt;td&gt;</code></td>
<td>Cellule</td>
</tr>
<tr class="even">
<td><code>&lt;thead&gt;</code></td>
<td>Section de l’en-tête du tableau</td>
</tr>
<tr class="odd">
<td><code>&lt;tbody&gt;</code></td>
<td>Section du corps du tableau</td>
</tr>
<tr class="even">
<td><code>&lt;tfoot&gt;</code></td>
<td>Section du pied du tableau</td>
</tr>
</tbody>
</table>
<p><strong>Application : un tableau en HTML</strong></p>
<p>Le code <em>HTML</em> du tableau suivant</p>
<pre class="{html}"><code>&lt;table&gt;
&lt;caption&gt; Le Titre de mon tableau &lt;/caption&gt;

   &lt;tr&gt;
      &lt;th&gt;Prénom&lt;/th&gt;
      &lt;th&gt;Nom&lt;/th&gt;
      &lt;th&gt;Profession&lt;/th&gt;
   &lt;/tr&gt;
   &lt;tr&gt;
      &lt;td&gt;Mike &lt;/td&gt;
      &lt;td&gt;Stuntman&lt;/td&gt;
      &lt;td&gt;Cascadeur&lt;/td&gt;
   &lt;/tr&gt;
   &lt;tr&gt;
      &lt;td&gt;Mister&lt;/td&gt;
      &lt;td&gt;Pink&lt;/td&gt;
      &lt;td&gt;Gangster&lt;/td&gt;
   &lt;/tr&gt;
&lt;/table&gt;</code></pre>
<p>Donnera dans le navigateur :</p>
<div class="cell markdown">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Le Titre de mon tableau</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Prénom</td>
<td data-quarto-table-cell-role="th">Nom</td>
<td data-quarto-table-cell-role="th">Profession</td>
</tr>
<tr class="even">
<td>Mike</td>
<td>Stuntman</td>
<td>Cascadeur</td>
</tr>
<tr class="odd">
<td>Mister</td>
<td>Pink</td>
<td>Gangster</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="parent-et-enfant" class="level4">
<h4 class="anchored" data-anchor-id="parent-et-enfant">Parent et enfant</h4>
<p>Dans le cadre du langage HTML, les termes de parent (<em>parent</em>) et enfant (<em>child</em>) servent à désigner des élements emboîtés les uns dans les autres. Dans la construction suivante, par exemple :</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;</span> div&gt; </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span> p&gt;</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>       bla,bla</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span> /p&gt;</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;</span> /div&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Sur la page web, cela apparaitra de la manière suivante :</p>
<div>
<pre><code>&lt;p&gt;
   bla,bla
&lt;/p&gt;</code></pre>
</div>
<p>On dira que l’élément <code>&lt;div&gt;</code> est le parent de l’élément <code>&lt;p&gt;</code> tandis que l’élément <code>&lt;p&gt;</code> est l’enfant de l’élément <code>&lt;div&gt;</code>.</p>
<blockquote class="blockquote">
<p><em>Mais pourquoi apprendre ça pour “scraper” ?</em></p>
</blockquote>
<p>Parce que, pour bien récupérer les informations d’un site internet, il faut pouvoir comprendre sa structure et donc son code HTML. Les fonctions <code>Python</code> qui servent au <em>scraping</em> sont principalement construites pour vous permettre de naviguer entre les balises.
Avec <code>Python</code>, vous allez en fait reproduire votre comportement manuel de recherche de manière
à l’automatiser.</p>
</section>
</section>
</section>
<section id="scraper-avec-python-le-package-beautifulsoup" class="level2">
<h2 class="anchored" data-anchor-id="scraper-avec-python-le-package-beautifulsoup">Scraper avec <code>Python</code>: le package <code>BeautifulSoup</code></h2>
<section id="les-packages-disponibles" class="level3">
<h3 class="anchored" data-anchor-id="les-packages-disponibles">Les packages disponibles</h3>
<p>Dans la première partie de ce chapitre,
nous allons essentiellement utiliser le package <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/"><code>BeautifulSoup4</code></a>,
en conjonction avec <a href="https://docs.python.org/3/library/urllib.html#module-urllib"><code>urllib</code></a>
ou <code>requests</code>. Ces deux derniers <em>packages</em> permettent de récupérer le texte
brut d’une page qui sera ensuite
inspecté via <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/"><code>BeautifulSoup4</code></a>.</p>
<p><code>BeautifulSoup</code> sera suffisant quand vous voudrez travailler sur des pages HTML statiques. Dès que les informations que vous recherchez sont générées via l’exécution de scripts <a href="https://fr.wikipedia.org/wiki/JavaScript">Javascript</a>, il vous faudra passer par des outils comme <a href="https://selenium-python.readthedocs.io/">Selenium</a>.</p>
<p>De même, si vous ne connaissez pas l’URL, il faudra passer par un <em>framework</em> comme <a href="https://scrapy.org/">Scrapy</a>, qui passe facilement d’une page à une autre. On appelle
cette technique le <em>“webcrawling”</em>. <code>Scrapy</code> est plus complexe à manipuler que <code>BeautifulSoup</code> : si vous voulez plus de détails, rendez-vous sur la page du <a href="https://doc.scrapy.org/en/latest/intro/tutorial.html">tutoriel <code>Scrapy</code></a>.</p>
<p>Le <em>webscraping</em> est un domaine où la reproductibilité est compliquée à mettre en oeuvre.
Une page <em>web</em> évolue
potentiellement régulièrement et d’une page web à l’autre, la structure peut
être très différente ce qui rend certains codes difficilement exportables.
Par conséquent, la meilleure manière d’avoir un programme fonctionnel est
de comprendre la structure d’une page web et dissocier les éléments exportables
à d’autres cas d’usages des requêtes <em>ad hoc</em>.</p>
<p></p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bs4</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> urllib <span class="im">import</span> request</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="récupérer-le-contenu-dune-page-html" class="level3">
<h3 class="anchored" data-anchor-id="récupérer-le-contenu-dune-page-html">Récupérer le contenu d’une page HTML</h3>
<p>On va commencer doucement. Prenons une page <em>wikipedia</em>,
par exemple celle de la Ligue 1 de football, millésime 2019-2020 : <a href="https://fr.wikipedia.org/wiki/Championnat_de_France_de_football_2019-2020">Championnat de France de football 2019-2020</a>. On va souhaiter récupérer la liste des équipes, ainsi que les url des pages Wikipedia de ces équipes.</p>
<p>Etape :one: : se connecter à la page wikipedia et obtenir le code source.
Pour cela, le plus simple est d’utiliser le package <code>urllib</code> ou, mieux, <code>requests</code>.
Nous allons ici utiliser la fonction <code>request</code> du <em>package</em> <code>urllib</code>:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>url_ligue_1 <span class="op">=</span> <span class="st">"https://fr.wikipedia.org/wiki/Championnat_de_France_de_football_2019-2020"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>request_text <span class="op">=</span> request.urlopen(url_ligue_1).read()</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print(request_text[:1000])    </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(request_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Etape :two: : utiliser le package BeautifulSoup
qui permet de rechercher efficacement
les balises contenues dans la chaine de caractères
renvoyée par la fonction <code>request</code>:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>page <span class="op">=</span> bs4.BeautifulSoup(request_text, <span class="st">"lxml"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si on <em>print</em> l’objet <code>page</code> créée avec <code>BeautifulSoup</code>,
on voit que ce n’est plus une chaine de caractères mais bien une page HTML avec des balises.
On peut à présent chercher des élements à l’intérieur de ces balises.</p>
</section>
<section id="la-méthode-find" class="level3">
<h3 class="anchored" data-anchor-id="la-méthode-find">La méthode <code>find</code></h3>
<p>Par exemple, si on veut connaître le titre de la page, on utilise la méthode <code>.find</code> et on lui demande <em>“title”</em></p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(page.find(<span class="st">"title"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La methode <code>.find</code> ne renvoie que la première occurence de l’élément.</p>
<p>Pour vous en assurer vous pouvez :</p>
<ul>
<li>copier le bout de code source obtenu,</li>
<li>le coller dans une cellule de votre notebook</li>
<li>et passer la cellule en <em>“Markdown”</em></li>
</ul>
<p>La cellule avec le copier-coller du code source donne :</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(page.find(<span class="st">"table"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ce qui est le texte source permettant de générer le tableau suivant:</p>
<div class="cell markdown">

</div>
</section>
<section id="la-méthode-findall" class="level3">
<h3 class="anchored" data-anchor-id="la-méthode-findall">La méthode <code>findAll</code></h3>
<p>Pour trouver toutes les occurences, on utilise <code>.findAll()</code>.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Il y a"</span>, <span class="bu">len</span>(page.findAll(<span class="st">"table"</span>)), <span class="st">"éléments dans la page qui sont des &lt;table&gt;"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="exercice-guidé-obtenir-la-liste-des-équipes-de-ligue-1" class="level2">
<h2 class="anchored" data-anchor-id="exercice-guidé-obtenir-la-liste-des-équipes-de-ligue-1">Exercice guidé : obtenir la liste des équipes de Ligue 1</h2>
<p>Dans le premier paragraphe de la page <em>“Participants”</em>,
on a le tableau avec les résultats de l’année.</p>
<div class="cell markdown">
<div class="alert alert-success" role="alert">
<h3 class="alert-heading anchored"><i class="fa-solid fa-pencil"></i> Exercice 1 : Récupérer les participants de la Ligue 1</h3>
<p>Pour cela, nous allons procéder en 6 étapes:</p>
<ol type="1">
<li>Trouver le tableau</li>
<li>Récupérer chaque ligne du table</li>
<li>Nettoyer les sorties en ne gardant que le texte sur une ligne</li>
<li>Généraliser sur toutes les lignes</li>
<li>Récupérer les entêtes du tableau</li>
<li>Finalisation du tableau</li>
</ol>
</div>
</div>
<p>1️ Trouver le tableau</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># on identifie le tableau en question : c'est le premier qui a cette classe "wikitable sortable"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>tableau_participants <span class="op">=</span> page.find(<span class="st">'table'</span>, {<span class="st">'class'</span> : <span class="st">'wikitable sortable'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tableau_participants)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>2️ Récupérer chaque ligne du tableau.</p>
<p>On recherche d’abord toutes les lignes du tableau avec la balise <code>tr</code></p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>table_body <span class="op">=</span> tableau_participants.find(<span class="st">'tbody'</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> table_body.find_all(<span class="st">'tr'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On obtient une liste où chaque élément est une des lignes du tableau
Pour illustrer cela, on va d’abord afficher la première ligne.
Celle-ci correspont aux entêtes de colonne:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rows[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La seconde ligne va correspondre à la ligne du premier club présent dans le tableau:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rows[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>3️ Nettoyer les sorties en ne gardant que le texte sur une ligne</p>
<p>On va utiliser l’attribut <code>text</code> afin de se débarasser de toute la couche de HTML qu’on obtient à l’étape 2.</p>
<p>Un exemple sur la ligne du premier club :
- on commence par prendre toutes les cellules de cette ligne, avec la balise <code>td</code>.
- on fait ensuite une boucle sur chacune des cellules et on ne garde que le texte de la cellule avec l’attribut <code>text</code>.
- enfin, on applique la méthode <code>strip()</code> pour que le texte soit bien mis en forme (sans espace inutile etc).</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> rows[<span class="dv">1</span>].find_all(<span class="st">'td'</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cols[<span class="dv">0</span>])</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cols[<span class="dv">0</span>].text.strip())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ele <span class="kw">in</span> cols : </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(ele.text.strip())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>4️ Généraliser sur toutes les lignes :</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> rows:</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> row.find_all(<span class="st">'td'</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> [ele.text.strip() <span class="cf">for</span> ele <span class="kw">in</span> cols]</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(cols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On a bien réussi à avoir les informations contenues dans le tableau des participants du championnat.
Mais la première ligne est étrange : c’est une liste vide …</p>
<p>Il s’agit des en-têtes : elles sont reconnues par la balise <code>th</code> et non <code>td</code>.</p>
<p>On va mettre tout le contenu dans un dictionnaire, pour le transformer ensuite en DataFrame pandas :</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-overflow-wrap code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dico_participants <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> rows:</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> row.find_all(<span class="st">'td'</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> [ele.text.strip() <span class="cf">for</span> ele <span class="kw">in</span> cols]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(cols) <span class="op">&gt;</span> <span class="dv">0</span> : </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        dico_participants[cols[<span class="dv">0</span>]] <span class="op">=</span> cols[<span class="dv">1</span>:]</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>dico_participants</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data_participants <span class="op">=</span> pandas.DataFrame.from_dict(dico_participants,orient<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>data_participants.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>5️ Récupérer les en-têtes du tableau:</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> rows:</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> row.find_all(<span class="st">'th'</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(cols)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(cols) <span class="op">&gt;</span> <span class="dv">0</span> : </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        cols <span class="op">=</span> [ele.get_text(separator<span class="op">=</span><span class="st">' '</span>).strip().title() <span class="cf">for</span> ele <span class="kw">in</span> cols]</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        columns_participants <span class="op">=</span> cols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>columns_participants</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>6️ Finalisation du tableau</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>data_participants.columns <span class="op">=</span> columns_participants[<span class="dv">1</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>data_participants.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pour-aller-plus-loin" class="level2">
<h2 class="anchored" data-anchor-id="pour-aller-plus-loin">Pour aller plus loin</h2>
<section id="récupération-des-localisations-des-stades" class="level3">
<h3 class="anchored" data-anchor-id="récupération-des-localisations-des-stades">Récupération des localisations des stades</h3>
<p>Essayez de comprendre pas à pas ce qui est fait dans les étapes qui suivent (la récupération d’informations supplémentaires en naviguant dans les pages des différents clubs).</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bs4 </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>division<span class="op">=</span>[]</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>equipe<span class="op">=</span>[]</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>stade<span class="op">=</span>[]</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>latitude_stade<span class="op">=</span>[]        </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>longitude_stade<span class="op">=</span>[]     </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dms2dd(degrees, minutes, seconds, direction):</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    dd <span class="op">=</span> <span class="bu">float</span>(degrees) <span class="op">+</span> <span class="bu">float</span>(minutes)<span class="op">/</span><span class="dv">60</span> <span class="op">+</span> <span class="bu">float</span>(seconds)<span class="op">/</span>(<span class="dv">60</span><span class="op">*</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> direction <span class="op">==</span> <span class="st">'S'</span> <span class="kw">or</span> direction <span class="op">==</span> <span class="st">'O'</span>:</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        dd <span class="op">*=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dd<span class="op">;</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>url_list<span class="op">=</span>[<span class="st">"http://fr.wikipedia.org/wiki/Championnat_de_France_de_football_2019-2020"</span>, <span class="st">"http://fr.wikipedia.org/wiki/Championnat_de_France_de_football_de_Ligue_2_2019-2020"</span>]</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> url_ligue <span class="kw">in</span> url_list :</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(url_ligue)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    sock <span class="op">=</span> urllib.request.urlopen(url_ligue).read() </span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    page<span class="op">=</span>bs4.BeautifulSoup(sock)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Rechercher les liens des équipes dans la liste disponible sur wikipedia </span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> team <span class="kw">in</span> page.findAll(<span class="st">'span'</span> , {<span class="st">'class'</span> : <span class="st">'toponyme'</span>}) :  </span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Indiquer si c'est de la ligue 1 ou de la ligue 2</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> url_ligue<span class="op">==</span>url_list[<span class="dv">0</span>] :</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>            division.append(<span class="st">"L1"</span>)</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> :</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>            division.append(<span class="st">"L2"</span>)</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>       <span class="co"># Trouver le nom et le lien de l'équipe</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> team.find(<span class="st">'a'</span>)<span class="op">!=</span><span class="va">None</span> :</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>            team_url<span class="op">=</span>team.find(<span class="st">'a'</span>).get(<span class="st">'href'</span>)</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>            name_team<span class="op">=</span>team.find(<span class="st">'a'</span>).get(<span class="st">'title'</span>)</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>            equipe.append(name_team)</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>            url_get_info <span class="op">=</span> <span class="st">"http://fr.wikipedia.org"</span><span class="op">+</span>team_url</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(url_get_info)</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>       <span class="co"># aller sur la page de l'équipe</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>            search <span class="op">=</span> urllib.request.urlopen(url_get_info).read()</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>            search_team<span class="op">=</span>bs4.BeautifulSoup(search)</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>       <span class="co"># trouver le stade             </span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>            compteur <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> stadium <span class="kw">in</span> search_team.findAll(<span class="st">'tr'</span>):</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> x <span class="kw">in</span> stadium.findAll(<span class="st">'th'</span> , {<span class="st">'scope'</span> : <span class="st">'row'</span>} ) :</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> x.contents[<span class="dv">0</span>].string<span class="op">==</span><span class="st">"Stade"</span> <span class="kw">and</span> compteur <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>                        compteur <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># trouver le lien du stade et son nom</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>                        url_stade<span class="op">=</span>stadium.findAll(<span class="st">'a'</span>)[<span class="dv">1</span>].get(<span class="st">'href'</span>)</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>                        name_stadium<span class="op">=</span>stadium.findAll(<span class="st">'a'</span>)[<span class="dv">1</span>].get(<span class="st">'title'</span>)</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>                        stade.append(name_stadium)</span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>                        url_get_stade <span class="op">=</span> <span class="st">"http://fr.wikipedia.org"</span><span class="op">+</span>url_stade</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(url_get_stade)</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Aller sur la page du stade et trouver ses coodronnées géographiques</span></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>                        search_stade <span class="op">=</span> urllib.request.urlopen(url_get_stade).read()</span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>                        soup_stade<span class="op">=</span>bs4.BeautifulSoup(search_stade) </span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>                        kartographer <span class="op">=</span> soup_stade.find(<span class="st">'a'</span>,{<span class="st">'class'</span>: <span class="st">"mw-kartographer-maplink"</span>})</span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> kartographer <span class="op">==</span> <span class="va">None</span> :</span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>                          latitude_stade.append(<span class="va">None</span>)</span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>                          longitude_stade.append(<span class="va">None</span>) </span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span> :</span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">for</span> coordinates <span class="kw">in</span> kartographer :</span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a>                                <span class="bu">print</span>(coordinates)</span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a>                                liste <span class="op">=</span>   coordinates.split(<span class="st">","</span>)          </span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a>                                latitude_stade.append(<span class="bu">str</span>(liste[<span class="dv">0</span>]).replace(<span class="st">" "</span>, <span class="st">""</span>) <span class="op">+</span> <span class="st">"'"</span>)</span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a>                                longitude_stade.append(<span class="bu">str</span>(liste[<span class="dv">1</span>]).replace(<span class="st">" "</span>, <span class="st">""</span>) <span class="op">+</span> <span class="st">"'"</span>)</span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a><span class="bu">dict</span> <span class="op">=</span> {<span class="st">'division'</span> : division , <span class="st">'equipe'</span>: equipe, <span class="st">'stade'</span>: stade, <span class="st">'latitude'</span>: latitude_stade, <span class="st">'longitude'</span> : longitude_stade}</span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame(<span class="bu">dict</span>)</span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>data.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On va transformer les coordonnées en degrés en coordonnées numériques
afin d’être en mesure de faire une carte</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dms2dd(degrees, minutes, seconds, direction):</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    dd <span class="op">=</span> <span class="bu">float</span>(degrees) <span class="op">+</span> <span class="bu">float</span>(minutes)<span class="op">/</span><span class="dv">60</span> <span class="op">+</span> <span class="bu">float</span>(seconds)<span class="op">/</span>(<span class="dv">60</span><span class="op">*</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> direction <span class="kw">in</span> (<span class="st">'S'</span>, <span class="st">'O'</span>):</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        dd <span class="op">*=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dd</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_dms(dms):</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    parts <span class="op">=</span> re.split(<span class="st">'[^\d\w]+'</span>, dms)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> dms2dd(parts[<span class="dv">0</span>], parts[<span class="dv">1</span>], parts[<span class="dv">2</span>], parts[<span class="dv">3</span>])</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#lng = dms2dd(parts[4], parts[5], parts[6], parts[7])</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'latitude'</span>] <span class="op">=</span> data[<span class="st">'latitude'</span>].<span class="bu">apply</span>(parse_dms)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'longitude'</span>] <span class="op">=</span> data[<span class="st">'longitude'</span>].<span class="bu">apply</span>(parse_dms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Tous les éléments sont en place pour faire une belle carte à ce stade. On
va utiliser <code>folium</code> pour celle-ci, qui est présenté dans la partie
<a href="#cartotp">visualisation</a>.</p>
</section>
<section id="cartes-stades-ligue1" class="level3">
<h3 class="anchored" data-anchor-id="cartes-stades-ligue1">Carte des stades avec <code>folium</code></h3>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!pip install geopandas</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    data, geometry<span class="op">=</span>gpd.points_from_xy(data.longitude, data.latitude))</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>Path(<span class="st">"leaflet"</span>).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>center <span class="op">=</span> gdf[[<span class="st">'latitude'</span>, <span class="st">'longitude'</span>]].mean().values.tolist()</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>sw <span class="op">=</span> gdf[[<span class="st">'latitude'</span>, <span class="st">'longitude'</span>]].<span class="bu">min</span>().values.tolist()</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>ne <span class="op">=</span> gdf[[<span class="st">'latitude'</span>, <span class="st">'longitude'</span>]].<span class="bu">max</span>().values.tolist()</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(location <span class="op">=</span> center, tiles<span class="op">=</span><span class="st">'Stamen Toner'</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co"># I can add marker one by one on the map</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(gdf)):</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    folium.Marker([gdf.iloc[i][<span class="st">'latitude'</span>], gdf.iloc[i][<span class="st">'longitude'</span>]], popup<span class="op">=</span>gdf.iloc[i][<span class="st">'stade'</span>]).add_to(m) </span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>m.fit_bounds([sw, ne])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La carte obtenue doit ressembler à la suivante :</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher la carte</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="récupérer-des-informations-sur-les-pokemons" class="level2">
<h2 class="anchored" data-anchor-id="récupérer-des-informations-sur-les-pokemons">Récupérer des informations sur les pokemons</h2>
<p>Le prochain exercice pour mettre en pratique le <em>web scraping</em>
consiste à récupérer des informations sur les
pokemons à partir du
site internet <a href="http://pokemondb.net/pokedex/national">pokemondb.net</a>.</p>
<section id="version-non-guidée" class="level3">
<h3 class="anchored">Version non guidée</h3>
<div class="cell markdown">
<div class="alert alert-success" role="alert">
<h3 class="alert-heading anchored"><i class="fa-solid fa-pencil"></i> Exercice 2 : Les pokemon (version non guidée)</h3>
<p>Pour cet exercice, nous vous demandons d’obtenir différentes informations sur les pokémons :</p>
<ol type="1">
<li>les informations personnelles des <strong>893</strong> pokemons sur le site internet <a href="http://pokemondb.net/pokedex/national">pokemondb.net</a>.
Les informations que nous aimerions obtenir au final dans un <code>DataFrame</code> sont celles contenues dans 4 tableaux :</li>
</ol>
<ul>
<li>Pokédex data</li>
<li>Training</li>
<li>Breeding</li>
<li>Base stats</li>
</ul>
<ol start="2" type="1">
<li>Nous aimerions que vous récupériez également les images de chacun des pokémons et que vous les enregistriez dans un dossier</li>
</ol>
<ul>
<li>Petit indice : utilisez les modules <code>request</code> et <a href="https://docs.python.org/3/library/shutil.html"><code>shutil</code></a></li>
<li>Pour cette question, il faut que vous cherchiez de vous même certains éléments, tout n’est pas présent dans le TD.</li>
</ul>
</div>
</div>
<p>Pour la question 1, l’objectif est d’obtenir le code source d’un tableau comme
celui qui suit
(Pokemon <a href="http://pokemondb.net/pokedex/nincada">Nincada</a>.)</p>
<div class="cell markdown">
<div class="grid-col span-md-6 span-lg-4">
<h2 class="anchored" data-anchor-id="version-non-guidée">
Pokédex data
</h2>

<table class="vitals-table">
<tbody>
<tr>
<th>
National №
</th>
<td>
<strong>290</strong>
</td>
</tr>
<tr>
<th>
Type
</th>
<td>
<a class="type-icon type-bug" href="../../type/bug">Bug</a> <a class="type-icon type-ground" href="../../type/ground">Ground</a>
</td>
</tr>
<tr>
<th>
Species
</th>
<td>
Trainee Pokémon
</td>
</tr>
<tr>
<th>
Height
</th>
<td>
0.5&nbsp;m (1′08″)
</td>
</tr>
<tr>
<th>
Weight
</th>
<td>
5.5&nbsp;kg (12.1&nbsp;lbs)
</td>
</tr>
<tr>
<th>
Abilities
</th>
<td>
<span class="text-muted">1. <a href="../../ability/compound-eyes" title="The Pokémon's accuracy is boosted.">Compound Eyes</a></span><br><small class="text-muted"><a href="../../ability/run-away" title="Enables a sure getaway from wild Pokémon.">Run Away</a> (hidden ability)</small><br>
</td>
</tr>
<tr>
<th>
Local №
</th>
<td>
042 <small class="text-muted">(Ruby/Sapphire/Emerald)</small><br>111 <small class="text-muted">(X/Y — Central Kalos)</small><br>043 <small class="text-muted">(Omega Ruby/Alpha Sapphire)</small><br>104 <small class="text-muted">(Sword/Shield)</small><br>
</td>
</tr>
</tbody>

</table>
</div>
<div class="grid-col span-md-12 span-lg-4">
<div class="grid-row">
<div class="grid-col span-md-6 span-lg-12">
<h2 class="anchored">
Training
</h2>

<table class="vitals-table">
<tbody>
<tr>
<th>
EV yield
</th>
<td class="text">
1 Defense
</td>
</tr>
<tr>
<th>
Catch rate
</th>
<td>
255 <small class="text-muted">(33.3% with PokéBall, full HP)</small>
</td>
</tr>
<tr>
<th>
Base <a href="../../glossary#def-friendship">Friendship</a>
</th>
<td>
70 <small class="text-muted">(normal)</small>
</td>
</tr>
<tr>
<th>
Base Exp.
</th>
<td>
53
</td>
</tr>
<tr>
<th>
Growth Rate
</th>
<td>
Erratic
</td>
</tr>
</tbody>

</table>
</div>
<div class="grid-col span-md-6 span-lg-12">
<h2 class="anchored">
Breeding
</h2>

<table class="vitals-table">
<tbody>
<tr>
<th>
Egg Groups
</th>
<td>
<a href="../../egg-group/bug">Bug</a>
</td>
</tr>
<tr>
<th>
Gender
</th>
<td>
<span class="text-blue">50% male</span>, <span class="text-pink">50% female</span>
</td>
</tr>
<tr>
<th>
<a href="../../glossary#def-eggcycle">Egg cycles</a>
</th>
<td>
15 <small class="text-muted">(3,599–3,855 steps)</small>
</td>
</tr>
</tbody>

</table>
</div>
</div>
</div>
<div class="grid-col span-md-12 span-lg-8">
<div id="dex-stats">

</div>
<h2 class="anchored">
Base stats
</h2>
<div class="resp-scroll">

<table class="vitals-table">
<tbody>
<tr>
<th>
HP
</th>
<td class="cell-num">
31
</td>
<td class="cell-barchart">
<div class="barchart-bar barchart-rank-2" style="width:17.22%;">

</div>
</td>
<td class="cell-num">
172
</td>
<td class="cell-num">
266
</td>
</tr>
<tr>
<th>
Attack
</th>
<td class="cell-num">
45
</td>
<td class="cell-barchart">
<div class="barchart-bar barchart-rank-2" style="width:25.00%;">

</div>
</td>
<td class="cell-num">
85
</td>
<td class="cell-num">
207
</td>
</tr>
<tr>
<th>
Defense
</th>
<td class="cell-num">
90
</td>
<td class="cell-barchart">
<div class="barchart-bar barchart-rank-4" style="width:50.00%;">

</div>
</td>
<td class="cell-num">
166
</td>
<td class="cell-num">
306
</td>
</tr>
<tr>
<th>
Sp. Atk
</th>
<td class="cell-num">
30
</td>
<td class="cell-barchart">
<div class="barchart-bar barchart-rank-2" style="width:16.67%;">

</div>
</td>
<td class="cell-num">
58
</td>
<td class="cell-num">
174
</td>
</tr>
<tr>
<th>
Sp. Def
</th>
<td class="cell-num">
30
</td>
<td class="cell-barchart">
<div class="barchart-bar barchart-rank-2" style="width:16.67%;">

</div>
</td>
<td class="cell-num">
58
</td>
<td class="cell-num">
174
</td>
</tr>
<tr>
<th>
Speed
</th>
<td class="cell-num">
40
</td>
<td class="cell-barchart">
<div class="barchart-bar barchart-rank-2" style="width:22.22%;">

</div>
</td>
<td class="cell-num">
76
</td>
<td class="cell-num">
196
</td>
</tr>
</tbody>
<tfoot>
<tr>
<th>
Total
</th>
<td class="cell-total">
<b>266</b>
</td>
<th class="cell-barchart">
</th>
<th>
Min
</th>
<th>
Max
</th>
</tr>
</tfoot>

</table>
</div>
</div>
</div>
<p>Pour la question 2, l’objectif est d’obtenir
l’une des images suivantes</p>
</section>
<section id="version-guidée" class="level3">
<h3 class="anchored" data-anchor-id="version-guidée">Version guidée</h3>
<p>Les prochaines parties permettront de faire l’exercice ci-dessus
étape par étape,
de manière guidée.</p>
<p>Nous souhaitons tout d’abord obtenir les
informations personnelles de tous
les pokemons sur <a href="http://pokemondb.net/pokedex/national">pokemondb.net</a>.</p>
<p>Les informations que nous aimerions obtenir au final pour les pokemons sont celles contenues dans 4 tableaux :</p>
<ul>
<li>Pokédex data</li>
<li>Training</li>
<li>Breeding</li>
<li>Base stats</li>
</ul>
<p>Nous proposons ensuite de récupérer et afficher les images.</p>
<section id="etape-1-constituer-un-dataframe-de-caractéristiques" class="level4">
<h4 class="anchored">Etape 1: constituer un DataFrame de caractéristiques</h4>
<div class="cell markdown">
<div class="alert alert-success" role="alert">
<h3 class="alert-heading anchored" data-anchor-id="etape-1-constituer-un-dataframe-de-caractéristiques"><i class="fa-solid fa-pencil"></i> Exercice 2b : Les pokémons (version guidée)</h3>
<p>Pour récupérer les informations, le code devra être divisé en plusieurs étapes :</p>
<ol type="1">
<li>Trouvez la page principale du site et la transformer en un objet intelligible pour votre code.
Les fonctions suivantes vous seront utiles :</li>
</ol>
<ul>
<li><code>urllib.request.Request</code></li>
<li><code>urllib.request.urlopen</code></li>
<li><code>bs4.BeautifulSoup</code></li>
</ul>
<ol start="2" type="1">
<li><p>Créez une fonction qui permet de récupérer la page d’un pokémon à partir de son nom.</p></li>
<li><p>A partir de la page de <code>bulbasaur</code>, obtenez les 4 tableaux qui nous intéressent :</p></li>
</ol>
<ul>
<li>on va chercher l’élément suivant : <code>('table', { 'class' : "vitals-table"})</code></li>
<li>puis stocker ses éléments dans un dictionnaire</li>
</ul>
<ol start="4" type="1">
<li><p>Récupérez par ailleurs la liste de noms des pokémons qui nous permettra de faire une boucle par la suite. Combien trouvez-vous de pokémons ?</p></li>
<li><p>Ecrire une fonction qui récupère l’ensemble des informations sur les dix premiers pokémons de la liste et les intègre dans un <code>DataFrame</code></p></li>
</ol>
</div>
</div>
<p>A l’issue de la question 3,
vous devriez obtenir une liste de caractéristiques proche de celle-ci:</p>
<p>La structure est ici en dictionnaire, ce qui est pratique.</p>
<p>Enfin, vous les
informations sur les dix premiers pokémons de la liste intégrées dans un
<code>DataFrame</code> prendront l’aspect suivant:</p>
</section>
<section id="etape-2-récupérer-et-afficher-des-photos-de-pokemon" class="level4">
<h4 class="anchored">Etape 2: récupérer et afficher des photos de Pokemon</h4>
<p>Nous aimerions que vous récupériez également les images des 5 premiers pokémons
et que vous les enregistriez dans un dossier.</p>
<div class="cell markdown">
<div class="alert alert-success" role="alert">
<h3 class="alert-heading anchored" data-anchor-id="etape-2-récupérer-et-afficher-des-photos-de-pokemon"><i class="fa-solid fa-pencil"></i> Exercice 2b : Les pokémons (version guidée)</h3>
<ul>
<li>Les URL des images des pokemon prennent la forme <em>“https://img.pokemondb.net/artwork/{pokemon}.jpg”</em>.
Utiliser les modules <code>requests</code> et <code>shutil</code> pour télécharger
et enregistrer en local les images.</li>
<li>Importer ces images stockées au format JPEG dans <code>Python</code> grâce à la fonction <code>imread</code> du package <code>skimage.io</code></li>
</ul>
</div>
</div>
</section>
</section>
</section>
<section id="selenium-mimer-le-comportement-dun-utilisateur-internet" class="level2">
<h2 class="anchored" data-anchor-id="selenium-mimer-le-comportement-dun-utilisateur-internet"><code>Selenium</code> : mimer le comportement d’un utilisateur internet</h2>
<p>Jusqu’à présent,
nous avons raisonné comme si nous connaissions toujours l’url qui nous intéresse.
De plus, les pages que nous visitons sont <strong>“statiques”</strong>,
elles ne dépendent pas d’une action ou d’une recherche de l’internaute.</p>
<p>Nous allons voir à présent comment nous en sortir pour remplir
des champs sur un site <em>web</em> et récupérer ce qui nous intéresse.
La réaction d’un site <em>web</em> à l’action d’un utilisateur passe régulièrement par
l’usage de <code>JavaScript</code> dans le monde du développement <em>web</em>.
Le <em>package</em> <a href="https://pypi.python.org/pypi/selenium">Selenium</a> permet
de reproduire, depuis un code automatisé, le comportement
manuel d’un utilisateur. Il permet ainsi
d’obtenir des informations du site qui ne sont pas dans le
code <code>HTML</code> mais qui apparaissent uniquement à la suite de
l’exécution de script <code>JavaScript</code> en arrière plan.</p>
<p><code>Selenium</code> se comporte comme un utilisateur <em>lambda</em> sur internet :
il clique sur des liens, il remplit des formulaires, etc.</p>
<section id="premier-exemple-en-scrapant-un-moteur-de-recherche" class="level3">
<h3 class="anchored" data-anchor-id="premier-exemple-en-scrapant-un-moteur-de-recherche">Premier exemple en scrapant un moteur de recherche</h3>
<p>Dans cet exemple, nous allons essayer d’aller sur le
site de <a href="https://www.bing.com/news">Bing Actualités</a>
et entrer dans la barre de recherche un sujet donné.
Pour tester, nous allons faire une recherche avec le mot-clé <strong>“Trump”</strong>.</p>
<p>L’installation de <code>Selenium</code> nécessite d’avoir <code>Chromium</code> qui est un
navigateur Google Chrome minimaliste.
La version de <a href="https://sites.google.com/a/chromium.org/chromedriver/">chromedriver</a>
doit être <code>&gt;= 2.36</code> et dépend de la version de <code>Chrome</code> que vous avez sur votre environnement
de travail. Pour installer cette version minimaliste de <code>Chrome</code> sur un environnement
<code>Linux</code>, vous pouvez
vous référer à l’encadré dédié</p>
<div class="cell markdown">
<div class="alert alert-info" role="alert">
<h3 class="alert-heading anchored"><i class="fa-solid fa-pencil"></i> `Installation de Selenium`</h3>
<p>D’abord, il convient d’installer les dépendances.
Sur <code>Colab</code>, vous pouvez utiliser les commandes suivantes :</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>sudo apt<span class="op">-</span>get update</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>sudo apt install <span class="op">-</span>y unzip xvfb libxi6 libgconf<span class="op">-</span><span class="dv">2</span><span class="op">-</span><span class="dv">4</span> <span class="op">-</span>y</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>sudo apt install chromium<span class="op">-</span>chromedriver <span class="op">-</span>y</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cp <span class="op">/</span>usr<span class="op">/</span>lib<span class="op">/</span>chromium<span class="op">-</span>browser<span class="op">/</span>chromedriver <span class="op">/</span>usr<span class="op">/</span><span class="bu">bin</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si vous êtes sur le <code>SSP Cloud</code>, vous pouvez
exécuter les commandes suivantes :</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>wget https:<span class="op">//</span>dl.google.com<span class="op">/</span>linux<span class="op">/</span>direct<span class="op">/</span>google<span class="op">-</span>chrome<span class="op">-</span>stable_current_amd64.deb <span class="op">-</span>O <span class="op">/</span>tmp<span class="op">/</span>chrome.deb</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>sudo apt<span class="op">-</span>get update</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>sudo <span class="op">-</span>E apt<span class="op">-</span>get install <span class="op">-</span>y <span class="op">/</span>tmp<span class="op">/</span>chrome.deb</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install chromedriver<span class="op">-</span>autoinstaller selenium</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> chromedriver_autoinstaller</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>chromedriver_autoinstaller.install()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vous pouvez ensuite installer <code>Selenium</code>.
Par
exemple, depuis une
cellule de <code>Notebook</code>:</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install selenium</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Après avoir installé <code>Chromium</code>,
il est nécessaire d’indiquer à <code>Python</code> où
le trouver. Si vous êtes sur <code>Linux</code> et que vous
avez suivi les consignes précédentes, vous
pouvez faire:</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>,<span class="st">'/usr/lib/chromium-browser/chromedriver'</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> selenium</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>path_to_web_driver <span class="op">=</span> <span class="st">"chromedriver"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En premier lieu, il convient d’initialiser le comportement
de <code>Selenium</code> en répliquant les paramètres
du navigateur. Pour cela, on va d’abord initialiser
notre navigateur avec quelques options:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium <span class="im">import</span> webdriver</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium.webdriver.common.keys <span class="im">import</span> Keys</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>chrome_options <span class="op">=</span> webdriver.ChromeOptions()</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>chrome_options.add_argument(<span class="st">'--headless'</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>chrome_options.add_argument(<span class="st">'--no-sandbox'</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">#chrome_options.add_argument('--verbose') </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Puis on lance le navigateur:</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium.webdriver.chrome.service <span class="im">import</span> Service</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>service <span class="op">=</span> Service(executable_path<span class="op">=</span>path_to_web_driver)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>browser <span class="op">=</span> webdriver.Chrome(service<span class="op">=</span>service,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                           options<span class="op">=</span>chrome_options)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On va sur le site de <code>Bing Actualités</code>, et on lui indique le mot clé que nous souhaitons chercher.
En l’occurrence, on s’intéresse aux actualités de Donald Trump.
Après avoir inspecté la page depuis les outils de développement du navigateur,
on voit que la barre de recherche est un élement du code appelé <code>q</code> (comme <em>query</em>).
On va ainsi demander à <code>selenium</code> de chercher cet élément:</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>browser.get(<span class="st">'https://www.bing.com/news'</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>search <span class="op">=</span> browser.find_element(<span class="st">"name"</span>, <span class="st">"q"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(search)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>([search.text, search.tag_name, search.<span class="bu">id</span>])</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># on envoie à cet endroit le mot qu'on aurait tapé dans la barre de recherche</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>search.send_keys(<span class="st">"Trump"</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>search_button <span class="op">=</span> browser.find_element(<span class="st">"xpath"</span>, <span class="st">"//input[@id='sb_form_go']"</span>) </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>search_button.click()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>selenium</code> permet de capturer l’image qu’on verrait dans le navigateur
avec <code>get_screenshot_as_png</code>. Cela peut être utile pour vérifier qu’on
a fait la bonne action:</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>png <span class="op">=</span> browser.get_screenshot_as_png()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>Image(png, width<span class="op">=</span><span class="st">'500'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Enfin, on peut extraire les résultats. Plusieurs
méthodes sont disponibles. La méthode la plus
pratique, lorsqu’elle est disponible,
est d’utiliser le <code>XPath</code> qui est un chemin
non ambigu pour accéder à un élement. En effet,
plusieurs éléments peuvent partager la même classe ou
le même attribut ce qui peut faire qu’une recherche
de ce type peut renvoyer plusieurs échos.
Pour déterminer le <code>XPath</code> d’un objet, les outils
de développeurs de votre site <em>web</em> sont pratiques.
Par exemple, sous <code>Firefox</code>, une fois que vous
avez trouvé un élément dans l’inspecteur, vous
pouvez faire <code>click droit &gt; Copier &gt; XPath</code>.</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium.common.exceptions <span class="im">import</span> StaleElementReferenceException</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>links <span class="op">=</span> browser.find_elements(<span class="st">"xpath"</span>, <span class="st">"//div/a[@class='title'][@href]"</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> link <span class="kw">in</span> links:</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>        url <span class="op">=</span> link.get_attribute(<span class="st">'href'</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> StaleElementReferenceException <span class="im">as</span> e:</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Issue with '</span><span class="sc">{0}</span><span class="st">' and '</span><span class="sc">{1}</span><span class="st">'"</span>.<span class="bu">format</span>(url, link))</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"It might be due to slow javascript which produces the HTML page."</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    results.append(url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Enfin, pour mettre fin à notre session, on demande
à <code>Python</code> de quitter le navigateur</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>browser.quit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On a obtenu les résultats suivants:</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Les autres méthodes utiles de <code>Selenium</code>:</p>
<div class="line-block"><code>find_element(****).click()</code> | Une fois qu’on a trouvé un élément réactif, notamment un bouton, on peut cliquer dessus pour activer une nouvelle page |<br>
<code>find_element(****).send_keys("toto")</code> | Une fois qu’on a trouvé un élément, notamment un champ où s’authentifier, on peut envoyer une valeur, ici <em>“toto”</em>.</div>
</section>
<section id="utiliser-selenium-pour-jouer-à-2048" class="level3">
<h3 class="anchored" data-anchor-id="utiliser-selenium-pour-jouer-à-2048">Utiliser selenium pour jouer à 2048</h3>
<p>Dans cet exemple, on utilise le module pour que <code>Python</code>
appuie lui même sur les touches du clavier afin de jouer à 2048.</p>
<p>Note : ce bout de code ne donne pas une solution à 2048,
il permet juste de voir ce qu’on peut faire avec <code>Selenium</code></p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium <span class="im">import</span> webdriver</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium.webdriver.chrome.service <span class="im">import</span> Service</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium.webdriver.common.keys <span class="im">import</span> Keys</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># on ouvre la page internet du jeu 2048</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>service <span class="op">=</span> Service(executable_path<span class="op">=</span>path_to_web_driver)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>browser <span class="op">=</span> webdriver.Chrome(service<span class="op">=</span>service)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>browser.get(<span class="st">'https://play2048.co//'</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Ce qu'on va faire : une boucle qui répète inlassablement la même chose : haut / droite / bas / gauche</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co"># on commence par cliquer sur la page pour que les touches sachent </span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>browser.find_element(<span class="st">"class name"</span>, <span class="st">'grid-container'</span>).click()</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> browser.find_element(<span class="st">"tag name"</span>, <span class="st">'body'</span>)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co"># pour savoir quels coups faire à quel moment, on crée un dictionnaire</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>direction <span class="op">=</span> {<span class="dv">0</span>: Keys.UP, <span class="dv">1</span>: Keys.RIGHT, <span class="dv">2</span>: Keys.DOWN, <span class="dv">3</span>: Keys.LEFT}</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>: <span class="co"># on vérifie que le bouton "Try again" n'est pas là - sinon ça veut dire que le jeu est fini</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>        retryButton <span class="op">=</span> browser.find_element(<span class="st">"link text"</span>,<span class="st">'Try again'</span>)</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>        scoreElem <span class="op">=</span> browser.find_element(<span class="st">"class name"</span>, <span class="st">'score-container'</span>)</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Do nothing.  Game is not over yet</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># on continue le jeu - on appuie sur la touche suivante pour le coup d'après</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>    count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>    grid.send_keys(direction[count <span class="op">%</span> <span class="dv">4</span>]) </span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.1</span>)</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Score final : </span><span class="sc">{}</span><span class="st"> en </span><span class="sc">{}</span><span class="st"> coups'</span>.<span class="bu">format</span>(scoreElem.text, count))    </span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>browser.quit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="exercices-supplémentaires" class="level2">
<h2 class="anchored" data-anchor-id="exercices-supplémentaires">Exercices supplémentaires</h2>
<section id="récupérer-les-noms-et-âges-des-ministres-français" class="level3">
<h3 class="anchored" data-anchor-id="récupérer-les-noms-et-âges-des-ministres-français">Récupérer les noms et âges des ministres français</h3>
<p>Pour cet exercice, on propose de scraper la liste des ministres français depuis le <a href="https://www.gouvernement.fr/composition-du-gouvernement">site du gouvernement</a>. L’objectif sera, <em>in fine</em> de faire un graphique qui représente la distribution de leurs âges.
La solution pour cet exercice a été proposée
par <a href="https://github.com/tttienthinh">Tien-Thinh</a>
et <a href="https://github.com/antoine-palazz">Antoine Palazzolo</a>.</p>
<p>Pour être en mesure de faire cet exercice, il est
recommandé d’installer le package <code>dateparser</code></p>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install dateparser</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">#depuis un notebook. En ligne de commande, retirer le !</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour cet exercice, nous proposons d’utiliser les <em>packages</em>
suivants:</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re, datetime</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dateutil.parser <span class="im">import</span> parse <span class="im">as</span> parse_dt</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dateparser</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bs4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous proposons également d’utiliser la fonction suivante
pour calculer l’âge à partir de la date de naissance.</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> from_birth_to_age(birth):</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    today <span class="op">=</span> datetime.date.today()</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> today.year <span class="op">-</span> birth.year <span class="op">-</span> ((today.month, today.day) <span class="op">&lt;</span> (birth.month, birth.day))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<div class="alert alert-success" role="alert">
<h3 class="alert-heading anchored"><i class="fa-solid fa-pencil"></i> Exercice : Les ministres français </h3>
<ol type="1">
<li>Créer des variables globales <code>url_gouvernement</code> et <code>url_gouvernement</code> qui représenteront,
respectivement, la racine de l’URL du site web et le chemin au sein de celui-ci ;</li>
<li>Utiliser <code>bs4</code> pour récupérer la composition du gouvernement, qui est contenue dans un <code>&lt;div&gt;</code>
ayant une classe <em>ad hoc</em>. Nommer cet objet <code>compo</code></li>
<li>Utiliser <code>find_all</code> pour récupérer la liste des ministres dans <code>compo</code>. Nommer
cet objet <code>ministres</code></li>
<li>Inspecter la structure des champs au sein de <code>ministres</code>. Répérer les id <code>biography</code>. Comme
la structure est générique, on va écrire une fonction <code>from_bio_to_age</code> sur laquelle on va itérer
pour chaque élément de la liste <code>ministres</code>. Cette fonction effectuera les opérations suivantes :
<ul>
<li>Remplacer les champs de dates de naissance non numériques (par exemple <em>“1er”</em>), en valeur numérique (par exemple 1).</li>
<li>Utiliser la regex <code>[0-3]?\d \S* \d{4}</code> avec le <em>package</em> <code>re</code> pour extraire les dates
de naissance. Nommer l’objet <code>str_date</code>.</li>
<li>Appliquer <code>dateparser.parse</code> pour convertir sous forme de date</li>
<li>Appliquer <code>from_birth_to_age</code> pour transformer cette date de naissance en âge</li>
</ul></li>
<li>Pour chaque élément de la liste <code>ministres</code>, faire une boucle (en introduisant un
<code>time.sleep(0.25)</code> entre chaque itération pour ne pas surcharger le site):
<ul>
<li>Récupérer les noms et prénoms, fonctions pour chaque ministre</li>
<li>Récupérer l’URL de la photo</li>
<li>Créer un URL pour chaque ministre afin d’appliquer la fonction
<code>from_bio_to_age</code></li>
</ul></li>
<li>Utiliser <code>matplotlib</code> ou <code>seaborn</code> pour faire un histogramme d’âge</li>
</ol>
</div>
</div>
<p>A l’issue de la question 4, on devrait
retrouver les informations suivantes :</p>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Nous retrouvons ainsi </span><span class="sc">{</span><span class="bu">len</span>(ministres)<span class="sc">}</span><span class="ss"> ministres."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> from_bio_to_age(url):</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    html <span class="op">=</span> urllib.request.urlopen(url).read()</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    page <span class="op">=</span> bs4.BeautifulSoup(html)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> page.find(<span class="st">"div"</span>, {<span class="st">"id"</span>:<span class="st">"biography"</span>}).text.replace(<span class="st">"1er"</span>, <span class="st">"1"</span>) <span class="co"># un peu ad hoc</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    expression <span class="op">=</span> re.<span class="bu">compile</span>(<span class="st">"[0-3]?\d \S* \d</span><span class="sc">{4}</span><span class="st">"</span>) <span class="co"># renvoie parfois des dates autres que dates de naissance</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    str_date <span class="op">=</span> expression.findall(s)[<span class="dv">0</span>]</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    date_de_naissance <span class="op">=</span> dateparser.parse(str_date).date()</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> from_birth_to_age(date_de_naissance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>In fine</em>, on obtient une liste dont le premier élément
prend la forme suivante :</p>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>liste[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finalement, le <code>DataFrame</code> pourra être
structuré sous la forme suivante. On va éliminer
les âges égaux à 0 sont qui sont des erreurs
de scraping:
lorsque la date de naissance complète n’est pas disponible
sur la biographie d’un ministre.</p>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(liste)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.loc[df[<span class="st">'Age'</span>] <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finalement, l’histogramme aura l’aspect suivant:</p>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>plt.hist(df.Age, bins<span class="op">=</span>np.arange(<span class="dv">25</span>, <span class="dv">80</span>, <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="analyse-textuelle-des-commentaires-clients-de-services-de-commande-de-repas-en-ligne" class="level3">
<h3 class="anchored" data-anchor-id="analyse-textuelle-des-commentaires-clients-de-services-de-commande-de-repas-en-ligne">Analyse textuelle des commentaires clients de services de commande de repas en ligne</h3>
<p>Pour découvrir une autre application possible du <em>web scraping</em>, vous pouvez également vous lancer dans le sujet 5 de l’édition 2023 du Funathon, disponible :</p>
<ul>
<li>Sur <a href="https://github.com/InseeFrLab/funathon2023_sujet5"><code>Github</code></a></li>
<li>Sur le <a href="https://www.sspcloud.fr/formation?search=funat&amp;path=%5B%22Funathon%202023%22%5D"><code>SSPCloud</code></a></li>
</ul>
<p>Le contenu de la section NLP du cours pourra vous être utile pour la seconde partie du sujet !</p>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@book{galiana2023,
  author = {Galiana, Lino},
  title = {Python Pour La Data Science},
  date = {2023},
  url = {https://pythonds.linogaliana.fr/},
  doi = {10.5281/zenodo.8229676},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-galiana2023" class="csl-entry quarto-appendix-citeas" role="listitem">
Galiana, Lino. 2023. <em>Python Pour La Data Science</em>. <a href="https://doi.org/10.5281/zenodo.8229676">https://doi.org/10.5281/zenodo.8229676</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="linogaliana/python-datascientist" data-repo-id="MDEwOlJlcG9zaXRvcnkyODAxNjE2Nzc=" data-category="General" data-category-id="DIC_kwDOELLtjc4B-5TX" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../content/manipulation/03_geopandas_TP.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Pratique de geopandas avec les données vélib</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../content/manipulation/04c_API_TP.html" class="pagination-link">
        <span class="nav-page-text">Récupérer des données avec des API depuis Python</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Python pour la <em>data science</em>, Lino Galiana.<br>
Licence <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i><br>
Code source disponible sur <a href="https://github.com/linogaliana/python-datascientist"><code>Github</code></a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Site construit avec <i class="fa-brands fa-python" aria-label="python"></i> et <a href="https://quarto.org/"><code>Quarto</code></a><br>
Inspiration pour la mise en forme du site <a href="https://www.andreashandel.com">ici</a><br>
<a href="https://github.com/linogaliana/python-datascientist">Code source disponible sur <i class="fa-brands fa-github" aria-label="github"></i> <code>GitHub</code></a></div>
  </div>
</footer>



</body></html>