<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lino Galiana">
<meta name="dcterms.date" content="2023-07-10">
<meta name="description" content="Pandas est l’élément central de l’écosystème Python pour la data science. Le succès récent de Python dans l’analyse de données tient beaucoup à Pandas qui a permis d’importer la logique SQL dans le langage Python. Pandas embarque énormément de fonctionalités qui permettent d’avoir des chaînes de traitement efficaces pour traiter des données de volumétrie moyenne (jusqu’à quelques Gigas). Au-delà de cette volumétrie, il faudra se tourner vers d’autres solutions (DuckDB, Dask, Polars, Spark…).">

<title>Python pour la data science - Introduction à Pandas</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../content/manipulation/02b_pandas_TP.html" rel="next">
<link href="../../content/manipulation/01_numpy.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #e9f3fa;
      }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="Python pour la data science - Introduction à Pandas">
<meta name="twitter:description" content="Pandas est l’élément central de l’écosystème Python pour la data science.
Le succès récent de Python dans l’analyse de données tient beaucoup à Pandas qui a permis d’importer la
logique SQL dans le langage Python. Pandas embarque énormément de
fonctionalités qui permettent d’avoir des chaînes de traitement efficaces pour
traiter des données de volumétrie moyenne (jusqu’à quelques Gigas). Au-delà
de cette volumétrie, il faudra se tourner vers d’autres solutions
(DuckDB, Dask, Polars, Spark…).">
<meta name="twitter:image" content="https://pythonds.linogaliana.fr/content/manipulation/featured.png">
<meta name="twitter:image-height" content="362">
<meta name="twitter:image-width" content="700">
<meta name="twitter:card" content="summary_large_image">
<meta name="citation_title" content="Python pour la data science">
<meta name="citation_author" content="Lino Galiana">
<meta name="citation_publication_date" content="2023">
<meta name="citation_cover_date" content="2023">
<meta name="citation_year" content="2023">
<meta name="citation_online_date" content="2023-07-10">
<meta name="citation_fulltext_html_url" content="https://pythonds.linogaliana.fr/">
<meta name="citation_doi" content="10.5281/zenodo.8229676">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=Coding for economists;,citation_author=undefined Turrell;,citation_author=undefined contributors;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://aeturrell.github.io/coding-for-economists;">
<meta name="citation_reference" content="citation_title=Random forests;,citation_author=Leo Breiman;,citation_publication_date=2001;,citation_cover_date=2001;,citation_year=2001;,citation_volume=45;,citation_journal_title=Machine learning;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Bagging predictors;,citation_author=Leo Breiman;,citation_publication_date=1996;,citation_cover_date=1996;,citation_year=1996;,citation_volume=24;,citation_journal_title=Machine learning;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=R for data science;,citation_author=Hadley Wickham;,citation_author=Mine Çetinkaya-Rundel;,citation_author=Garrett Grolemund;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;">
<meta name="citation_reference" content="citation_title=Computational reproducibility of jupyter notebooks from biomedical publications;,citation_author=Sheeba Samuel;,citation_author=Daniel Mietchen;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://arxiv.org/abs/2308.07333;">
<meta name="citation_reference" content="citation_title=Python data science handbook: Essential tools for working with data;,citation_author=Jake VanderPlas;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;">
<meta name="citation_reference" content="citation_title=Machine learning methods that economists should know about;,citation_author=Susan Athey;,citation_author=Guido W Imbens;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_volume=11;,citation_journal_title=Annual Review of Economics;,citation_publisher=Annual Reviews;">
<meta name="citation_reference" content="citation_title=Fuzzy matching on big-data an illustration with scanner data and crowd-sourced nutritional data;,citation_author=Lino Galiana;,citation_author=Milena Suarez Castillo;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_publisher=Proceedings of the 2022 &amp;amp;amp;quot;Journées de Méthodologie Statistiques&amp;quot;;">
<meta name="citation_reference" content="citation_title=Data visualization with python and JavaScript;,citation_author=Kyran Dale;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;">
<meta name="citation_reference" content="citation_title=Sémiologie graphique;,citation_author=Jacques Bertin;,citation_publication_date=1967;,citation_cover_date=1967;,citation_year=1967;">
<meta name="citation_reference" content="citation_title=La sémiologie graphique de jacques bertin a cinquante ans;,citation_author=Gilles Palsky;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_journal_title=Visions carto (en ligne);">
<meta name="citation_reference" content="citation_title=Fundamentals of data visualization: A primer on making informative and compelling figures;,citation_author=Claus O Wilke;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;">
<meta name="citation_reference" content="citation_title=How to train BERT with an academic budget;,citation_author=Peter Izsak;,citation_author=Moshe Berchansky;,citation_author=Omer Levy;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://arxiv.org/abs/2104.07705;">
<meta name="citation_reference" content="citation_title=Python for data analysis: Data wrangling with pandas, NumPy, and IPython;,citation_author=Wes McKinney;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;">
<meta name="citation_reference" content="citation_title=Residential segregation, daytime segregation and spatial frictions: An analysis from mobile phone data;,citation_author=Lino Galiana;,citation_author=François Sémécurbe;,citation_author=Benjamin Sakarovitch;,citation_author=Zbigniew Smoreda;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_publisher=Insee Working Paper;">
<meta name="citation_reference" content="citation_title=Fuzzy matching on big-data: An illustration with scanner and crowd-sourced nutritional datasets;,citation_abstract=Food retailers’ scanner data provide unprecedented details on local consumption, provided that product identifiers allow a linkage with features of interest, such as nutritional information. In this paper, we enrich a large retailer dataset with nutritional information extracted from crowd-sourced and administrative nutritional datasets. To compensate for imperfect matching through the barcode, we develop a methodology to efficiently match short textual descriptions. After a preprocessing step to normalize short labels, we resort to fuzzy matching based on several tokenizers (including n-grams) by querying an ElasticSearch customized index and validate candidates echos as matches with a Levensthein edit-distance and an embedding-based similarity measure created from a siamese neural network model. The pipeline is composed of several steps successively relaxing constraints to find relevant matching candidates.;,citation_author=Lino Galiana;,citation_author=Milena Suarez Castillo;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://doi.org/10.1145/3524458.3547244;,citation_doi=10.1145/3524458.3547244;,citation_isbn=9781450392846;,citation_conference_title=Proceedings of the 2022 ACM conference on information technology for social good;,citation_conference=Association for Computing Machinery;,citation_series_title=GoodIT ’22;">
<meta name="citation_reference" content="citation_title=Guide de sémiologie cartographique;,citation_author=undefined Insee;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_publisher=Insee Working Paper;">
<meta name="citation_reference" content="citation_title=Energy and policy considerations for deep learning in NLP;,citation_author=Emma Strubell;,citation_author=Ananya Ganesh;,citation_author=Andrew McCallum;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://arxiv.org/abs/1906.02243;">
<meta name="citation_reference" content="citation_title=High-resolution image synthesis with latent diffusion models;,citation_author=Robin Rombach;,citation_author=Andreas Blattmann;,citation_author=Dominik Lorenz;,citation_author=Patrick Esser;,citation_author=Björn Ommer;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_conference_title=Proceedings of the IEEE/CVF conference on computer vision and pattern recognition (CVPR);">
<meta name="citation_reference" content="citation_title=Apache arrow and the&amp;amp;amp;quot; 10 things i hate about pandas;,citation_author=Wes McKinney;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_volume=21;,citation_journal_title=Blog, September;">
<meta name="citation_reference" content="citation_title=Many researchers were not compliant with their published data sharing statement: Mixed-methods study;,citation_author=Mirko Gabelica;,citation_author=Ružica Bojčić;,citation_author=Livia Puljak;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_journal_title=Journal of Clinical Epidemiology;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Credit scoring in the era of big data;,citation_author=Mikella Hurley;,citation_author=Julius Adebayo;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;,citation_volume=18;,citation_journal_title=Yale JL &amp;amp;amp; Tech.;,citation_publisher=HeinOnline;">
<meta name="citation_reference" content="citation_title=Econometrics and machine learning;,citation_author=Arthur Charpentier;,citation_author=Emmanuel Flachaire;,citation_author=Antoine Ly;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=1;,citation_volume=505;,citation_journal_title=Economie et Statistique;,citation_publisher=Persée-Portail des revues scientifiques en SHS;">
<meta name="citation_reference" content="citation_title=Machine learning: An applied econometric approach;,citation_author=Sendhil Mullainathan;,citation_author=Jann Spiess;,citation_publication_date=2017-05;,citation_cover_date=2017-05;,citation_year=2017;,citation_fulltext_html_url=https://www.aeaweb.org/articles?id=10.1257/jep.31.2.87;,citation_issue=2;,citation_doi=10.1257/jep.31.2.87;,citation_volume=31;,citation_journal_title=Journal of Economic Perspectives;">
<meta name="citation_reference" content="citation_title=Le problème du réalisme des hypothèses en économie politique;,citation_author=Pierre Salmon;,citation_publication_date=2010;,citation_cover_date=2010;,citation_year=2010;">
<meta name="citation_reference" content="citation_title=The methodology of positive economics;,citation_author=Milton Friedman;,citation_publication_date=1953;,citation_cover_date=1953;,citation_year=1953;,citation_inbook_title=Essays in positive economics;">
<meta name="citation_reference" content="citation_title=L’empreinte carbone du numérique;,citation_author=undefined Arcep;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;">
<meta name="citation_reference" content="citation_title=Leakage and the reproducibility crisis in ML-based science;,citation_author=Sayash Kapoor;,citation_author=Arvind Narayanan;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2207.07048;,citation_doi=10.48550/ARXIV.2207.07048;,citation_publisher=arXiv;">
<meta name="citation_reference" content="citation_title=Data scientist, the sexiest job of the 21st century;,citation_author=Thomas H Davenport;,citation_author=DJ Patil;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;,citation_fulltext_html_url=https://hbr.org/2012/10/data-scientist-the-sexiest-job-of-the-21st-century;,citation_issue=5;,citation_volume=90;,citation_journal_title=Harvard business review;">
<meta name="citation_reference" content="citation_title=Is data scientist still the sexiest job of the 21st century?;,citation_author=Thomas H Davenport;,citation_author=DJ Patil;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;,citation_fulltext_html_url=https://hbr.org/2012/10/data-scientist-the-sexiest-job-of-the-21st-century;,citation_issue=5;,citation_volume=90;,citation_journal_title=Harvard business review;">
</head>

<body class="nav-sidebar floating nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Python pour la data science</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-introduction" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Introduction</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-introduction">    
        <li>
    <a class="dropdown-item" href="../../content/getting-started/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/01_installation.html" rel="" target="">
 <span class="dropdown-text">Configuration de Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/02_DS_environment.html" rel="" target="">
 <span class="dropdown-text">L’environnement Python pour la data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/03_data_analysis.html" rel="" target="">
 <span class="dropdown-text">Comment aborder un jeu de données</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/04_python_practice.html" rel="" target="">
 <span class="dropdown-text">Bonne pratique de Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/05_rappels_types.html" rel="" target="">
 <span class="dropdown-text">Quelques rappels sur les principes de base de Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/06_rappels_fonctions.html" rel="" target="">
 <span class="dropdown-text">Modules, tests, boucles, fonctions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/07_rappels_classes.html" rel="" target="">
 <span class="dropdown-text">Les classes en Python</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-manipuler" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Manipuler</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-manipuler">    
        <li>
    <a class="dropdown-item" href="../../content/manipulation/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/01_numpy.html" rel="" target="">
 <span class="dropdown-text">Numpy, la brique de base de la data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/02a_pandas_tutorial.html" rel="" target="">
 <span class="dropdown-text">Introduction à Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/02b_pandas_TP.html" rel="" target="">
 <span class="dropdown-text">Pratique de pandas : un exemple complet</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/03_geopandas_tutorial.html" rel="" target="">
 <span class="dropdown-text">Données spatiales : découverte de geopandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/03_geopandas_TP.html" rel="" target="">
 <span class="dropdown-text">Pratique de geopandas avec les données vélib</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04a_webscraping_TP.html" rel="" target="">
 <span class="dropdown-text">Web scraping avec Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04c_API_TP.html" rel="" target="">
 <span class="dropdown-text">Récupérer des données avec des API depuis Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04b_regex_TP.html" rel="" target="">
 <span class="dropdown-text">Maîtriser les expressions régulières</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/07_dask.html" rel="" target="">
 <span class="dropdown-text">Introduction à dask grâce aux données DVF</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-communiquer" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Communiquer</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-communiquer">    
        <li>
    <a class="dropdown-item" href="../../content/visualisation/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/visualisation/matplotlib.html" rel="" target="">
 <span class="dropdown-text">De beaux graphiques avec python : mise en pratique</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/visualisation/maps.html" rel="" target="">
 <span class="dropdown-text">De belles cartes avec python : mise en pratique</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-modéliser" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Modéliser</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-modéliser">    
        <li>
    <a class="dropdown-item" href="../../content/modelisation/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/0_preprocessing.html" rel="" target="">
 <span class="dropdown-text">Préparation des données pour construire un modèle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/1_modelevaluation.html" rel="" target="">
 <span class="dropdown-text">Evaluer la qualité d’un modèle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/2_SVM.html" rel="" target="">
 <span class="dropdown-text">Classification: premier modèle avec les SVM</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/3_regression.html" rel="" target="">
 <span class="dropdown-text">Régression : une introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/4_featureselection.html" rel="" target="">
 <span class="dropdown-text">Sélection de variables : une introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/5_clustering.html" rel="" target="">
 <span class="dropdown-text">Clustering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/6_pipeline.html" rel="" target="">
 <span class="dropdown-text">Premier pas vers l’industrialisation avec les pipelines scikit</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/7_mlapi.html" rel="" target="">
 <span class="dropdown-text">Mettre à disposition un modèle par le biais d’une API</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-nlp" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">NLP</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-nlp">    
        <li>
    <a class="dropdown-item" href="../../content/NLP/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/01_intro.html" rel="" target="">
 <span class="dropdown-text">Quelques éléments pour comprendre les enjeux du NLP</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/02_exoclean.html" rel="" target="">
 <span class="dropdown-text">Nettoyer un texte: des exercices pour découvrir l’approche bag-of-words</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/03_lda.html" rel="" target="">
 <span class="dropdown-text">Latent Dirichlet Allocation (LDA)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/04_word2vec.html" rel="" target="">
 <span class="dropdown-text">Méthodes de vectorisation : comptages et word embeddings</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/05_exo_supp.html" rel="" target="">
 <span class="dropdown-text">Exercices supplémentaires</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-approfondissements" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Approfondissements</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-approfondissements">    
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/continuous_integration.html" rel="" target="">
 <span class="dropdown-text">Intégration continue avec Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/dallE.html" rel="" target="">
 <span class="dropdown-text">Génération d’images avec Python, DALL-E et StableDiffusion</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/s3.html" rel="" target="">
 <span class="dropdown-text">Les nouveaux modes d’accès aux données : le format parquet et les données sur le cloud</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/elastic_approfondissement.html" rel="" target="">
 <span class="dropdown-text">Approfondissement ElasticSearch pour des recherches de proximité géographique</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/elastic_intro.html" rel="" target="">
 <span class="dropdown-text">Introduction à ElasticSearch pour la recherche textuelle</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-git" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Git</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-git">    
        <li>
    <a class="dropdown-item" href="../../content/git/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/git/introgit.html" rel="" target="">
 <span class="dropdown-text">Git : un élément essentiel au quotidien</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/git/exogit.html" rel="" target="">
 <span class="dropdown-text">Un cadavre exquis pour découvrir Git</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-annexes" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Annexes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-annexes">    
        <li>
    <a class="dropdown-item" href="../../content/annexes/evaluation.html" rel="" target="">
 <span class="dropdown-text">Evaluation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/annexes/corrections.html" rel="" target="">
 <span class="dropdown-text">Corrections</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://linogaliana.github.io/python-datascientist-slides/#/title-slide" rel="" target="">
 <span class="dropdown-text">Slides de présentation</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="https://github.com/linogaliana/python-datascientist">
            Code source
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../content/manipulation/02a_pandas_tutorial.html">Introduction à Pandas</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns">
                <div id="title-block-header-title" class="quarto-title page-columns page-full page-layout-full featured-image p-4" style="background-image: url(featured.png);">
                <h1 class="title">Introduction à Pandas</h1>
                                    <div class="quarto-categories">
                        <div class="quarto-category">Tutoriel</div>
                        <div class="quarto-category">Manipulation</div>
                      </div>
                          </div>
        
                <div>
          <div id="title-block-title-desc" class="description pt-4">
            <p><code>Pandas</code> est l’élément central de l’écosystème <code>Python</code> pour la <em>data science</em>.
            Le succès récent de <code>Python</code> dans l’analyse de données tient beaucoup à <code>Pandas</code> qui a permis d’importer la
            logique <code>SQL</code> dans le langage <code>Python</code>. <code>Pandas</code> embarque énormément de
            fonctionalités qui permettent d’avoir des chaînes de traitement efficaces pour
            traiter des données de volumétrie moyenne (jusqu’à quelques Gigas). Au-delà
            de cette volumétrie, il faudra se tourner vers d’autres solutions
            (<code>DuckDB</code>, <code>Dask</code>, <code>Polars</code>, <code>Spark</code>…).</p>
          </div>
        </div>
                
        
        <div class="quarto-title-meta">

            <div>
            <div class="quarto-title-meta-heading">Author</div>
            <div class="quarto-title-meta-contents">
                     <p>Lino Galiana </p>
                  </div>
          </div>
            
            <div>
            <div class="quarto-title-meta-heading">Published</div>
            <div class="quarto-title-meta-contents">
              <p class="date">July 10, 2023</p>
            </div>
          </div>
          
            
          </div>
          
        
                <div class="mt-4 d-flex flex-row flex-wrap gap-1 justify-content-left justify-content-sm-start" role="group" aria-label="Links">
                <a href="https://pandas.pydata.org/docs/" class="btn btn-secondary text-capitalize"><i class="bi bi-journal-text me-1"></i> Documentation Pandas</a>
                </div>
        
        

        </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/01_numpy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Numpy, la brique de base de la data science</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/02a_pandas_tutorial.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Introduction à Pandas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/02b_pandas_TP.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pratique de pandas : un exemple complet</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/03_geopandas_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Données spatiales : découverte de geopandas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/03_geopandas_TP.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pratique de geopandas avec les données vélib</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/04a_webscraping_TP.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Web scraping avec Python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/04c_API_TP.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Récupérer des données avec des API depuis Python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/04b_regex_TP.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Maîtriser les expressions régulières</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/manipulation/07_dask.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction à dask grâce aux données DVF</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#logique-de-pandas" id="toc-logique-de-pandas" class="nav-link active" data-scroll-target="#logique-de-pandas">Logique de <code>Pandas</code></a></li>
  <li><a href="#les-series" id="toc-les-series" class="nav-link" data-scroll-target="#les-series">Les <code>Series</code></a>
  <ul class="collapse">
  <li><a href="#indexation" id="toc-indexation" class="nav-link" data-scroll-target="#indexation">Indexation</a></li>
  <li><a href="#valeurs-manquantes" id="toc-valeurs-manquantes" class="nav-link" data-scroll-target="#valeurs-manquantes">Valeurs manquantes</a></li>
  </ul></li>
  <li><a href="#le-dataframe-pandas" id="toc-le-dataframe-pandas" class="nav-link" data-scroll-target="#le-dataframe-pandas">Le DataFrame <code>Pandas</code></a>
  <ul class="collapse">
  <li><a href="#les-attributs-et-méthodes-utiles" id="toc-les-attributs-et-méthodes-utiles" class="nav-link" data-scroll-target="#les-attributs-et-méthodes-utiles">Les attributs et méthodes utiles</a></li>
  <li><a href="#dimensions-et-structure-du-dataframe" id="toc-dimensions-et-structure-du-dataframe" class="nav-link" data-scroll-target="#dimensions-et-structure-du-dataframe">Dimensions et structure du DataFrame</a></li>
  <li><a href="#statistiques-agrégées" id="toc-statistiques-agrégées" class="nav-link" data-scroll-target="#statistiques-agrégées">Statistiques agrégées</a></li>
  <li><a href="#méthodes-relatives-aux-valeurs-manquantes" id="toc-méthodes-relatives-aux-valeurs-manquantes" class="nav-link" data-scroll-target="#méthodes-relatives-aux-valeurs-manquantes">Méthodes relatives aux valeurs manquantes</a></li>
  </ul></li>
  <li><a href="#graphiques-rapides" id="toc-graphiques-rapides" class="nav-link" data-scroll-target="#graphiques-rapides">Graphiques rapides</a></li>
  <li><a href="#accéder-à-des-éléments-dun-dataframe" id="toc-accéder-à-des-éléments-dun-dataframe" class="nav-link" data-scroll-target="#accéder-à-des-éléments-dun-dataframe">Accéder à des éléments d’un DataFrame</a>
  <ul class="collapse">
  <li><a href="#sélectionner-des-colonnes" id="toc-sélectionner-des-colonnes" class="nav-link" data-scroll-target="#sélectionner-des-colonnes">Sélectionner des colonnes</a></li>
  <li><a href="#accéder-à-des-lignes" id="toc-accéder-à-des-lignes" class="nav-link" data-scroll-target="#accéder-à-des-lignes">Accéder à des lignes</a></li>
  </ul></li>
  <li><a href="#principales-manipulation-de-données" id="toc-principales-manipulation-de-données" class="nav-link" data-scroll-target="#principales-manipulation-de-données">Principales manipulation de données</a>
  <ul class="collapse">
  <li><a href="#opérations-sur-les-colonnes-select-mutate-drop" id="toc-opérations-sur-les-colonnes-select-mutate-drop" class="nav-link" data-scroll-target="#opérations-sur-les-colonnes-select-mutate-drop">Opérations sur les colonnes : <code>select</code>, <code>mutate</code>, <code>drop</code></a></li>
  <li><a href="#réordonner" id="toc-réordonner" class="nav-link" data-scroll-target="#réordonner">Réordonner</a></li>
  <li><a href="#filtrer" id="toc-filtrer" class="nav-link" data-scroll-target="#filtrer">Filtrer</a></li>
  <li><a href="#opérations-par-groupe" id="toc-opérations-par-groupe" class="nav-link" data-scroll-target="#opérations-par-groupe">Opérations par groupe</a></li>
  <li><a href="#appliquer-des-fonctions" id="toc-appliquer-des-fonctions" class="nav-link" data-scroll-target="#appliquer-des-fonctions">Appliquer des fonctions</a></li>
  <li><a href="#joindre-des-données" id="toc-joindre-des-données" class="nav-link" data-scroll-target="#joindre-des-données">Joindre des données</a></li>
  <li><a href="#restructurer-des-données-reshape" id="toc-restructurer-des-données-reshape" class="nav-link" data-scroll-target="#restructurer-des-données-reshape">Restructurer des données (<em>reshape</em>)</a></li>
  <li><a href="#les-pipe" id="toc-les-pipe" class="nav-link" data-scroll-target="#les-pipe">Les pipe</a></li>
  </ul></li>
  <li><a href="#quelques-enjeux-de-performance" id="toc-quelques-enjeux-de-performance" class="nav-link" data-scroll-target="#quelques-enjeux-de-performance">Quelques enjeux de performance</a></li>
  <li><a href="#références" id="toc-références" class="nav-link" data-scroll-target="#références">Références</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/linogaliana/python-datascientist/edit/master/content/manipulation/02a_pandas_tutorial.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/linogaliana/python-datascientist/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">

<!-- source: https://github.com/gadenbuie/garrickadenbuie-com/blob/main/_partials/title-block-link-buttons/title-block.html -->
<!-- source: https://raw.githubusercontent.com/spcanelon/silvia/32853dd0e70a71514b0922ee306f80ed5897f776/_partials/title-block-link-buttons/title-block.html -->
<!-- 
<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title"> 
-->
<!-- <header id="title-block-header" class="quarto-title-block default page-columns"> -->
<!-- <div class="quarto-title page-columns page-full featured-image p-4" style="background-image: url(featured.png), url(featured.jpg), url(../featured.jpg);"> -->
    

<p>Pour essayer les exemples présents dans ce tutoriel :</p>
<div class="cell markdown">
<p class="badges">
<a href="https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/02a_pandas_tutorial.ipynb" class="github"><i class="fab fa-github"></i></a>
<a href="https://downgit.github.io/#/home?url=https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/02a_pandas_tutorial.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Download-Notebook-important?logo=Jupyter" alt="Download"></a>
<a href="https://nbviewer.jupyter.org/github/linogaliana/python-datascientist-notebooksblob/main/notebooks/manipulation/02a_pandas_tutorial.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Visualize-nbviewer-blue?logo=Jupyter" alt="nbviewer"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/jupyter-python?autoLaunch=true&amp;onyxia.friendlyName=%C2%ABpython-datascience%C2%BB&amp;init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmaster%2Fsspcloud%2Finit-jupyter.sh%C2%BB&amp;init.personalInitArgs=%C2%ABmanipulation%2002a_pandas_tutorial%C2%BB&amp;security.allowlist.enabled=false" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Tester_avec_Jupyter-orange?logo=Jupyter&amp;logoColor=orange" alt="Onyxia"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/vscode-python?autoLaunch=true&amp;onyxia.friendlyName=%C2%ABpython-datascience%C2%BB&amp;init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmaster%2Fsspcloud%2Finit-vscode.sh%C2%BB&amp;init.personalInitArgs=%C2%ABmanipulation%2002a_pandas_tutorial%C2%BB&amp;security.allowlist.enabled=false" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Tester_avec_VSCode-blue?logo=visualstudiocode&amp;logoColor=blue" alt="Onyxia"></a><br>
<a href="https://mybinder.org/v2/gh/linogaliana/python-datascientist-notebooks/main?filepath={binder_path}" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Launch-Binder-E66581.svg?logo=data:image/png;base64,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" alt="Binder"></a>
<a href="https://colab.research.google.com/github/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/02a_pandas_tutorial.ipynb" target="_blank" rel="noopener"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a>
<a href="https://github.dev/linogaliana/python-datascientist-notebooks/notebooks/manipulation/02a_pandas_tutorial.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/static/v1?logo=visualstudiocode&amp;label=&amp;message=Open%20in%20Visual%20Studio%20Code&amp;labelColor=2c2c32&amp;color=007acc&amp;logoColor=007acc" alt="githubdev"></a>
</p>
<p></p>
</div>
<p>Le <em>package</em> <code>Pandas</code> est l’une des briques centrales de l’écosystème de
la <em>data science</em>. Le <em>DataFrame</em>,
objet central dans des langages comme <code>R</code>
ou <code>Stata</code>, a longtemps était un grand absent dans l’écosystème <code>Python</code>.
Pourtant, grâce à <code>Numpy</code>, toutes les briques de base étaient présentes.
Wes McKinney, lorsqu’il a créé <code>Pandas</code> en s’appuyant sur <code>Numpy</code>
a ainsi introduit cet objet devenu banal qu’est le <em>DataFrame</em>.
<code>Pandas</code> est rapidement
devenu un incontournable de la <em>data-science</em>. L’ouvrage
de référence de <span class="citation" data-cites="mckinney2012python">McKinney (<a href="#ref-mckinney2012python" role="doc-biblioref">2012</a>)</span> présente de manière plus
ample ce <em>package</em>.</p>
<p>Ce tutoriel vise à introduire aux concepts
de base de ce package par l’exemple et à introduire à certaines
des tâches les plus fréquentes de (re)structuration
des données du <em>data scientist</em>. Il ne s’agit pas d’un ensemble
exhaustif de commandes : <code>Pandas</code> est un package tentaculaire
qui permet de réaliser la même opération de nombreuses manières.
Nous nous concentrerons ainsi sur les éléments les plus pertinents
dans le cadre d’une introduction à la <em>data science</em> et laisserons
les utilisateurs intéressés approfondir leurs connaissances
dans les ressources foisonnantes qu’il existe sur le sujet.</p>
<p>Dans ce tutoriel <code>Pandas</code>, nous allons utiliser :</p>
<ul>
<li>Les émissions de gaz à effet de serre estimées au niveau communal par l’ADEME. Le jeu de données est
disponible sur <a href="https://www.data.gouv.fr/fr/datasets/inventaire-de-gaz-a-effet-de-serre-territorialise/#_">data.gouv</a>
et requêtable directement dans <code>Python</code> avec
<a href="https://koumoul.com/s/data-fair/api/v1/datasets/igt-pouvoir-de-rechauffement-global/convert">cet url</a>.</li>
</ul>
<p>Le <a href="02b_pandas_TP">chapitre suivant</a> permettra de mettre en application des éléments présents dans ce chapitre avec
les données ci-dessus associées à des données de contexte au niveau communal.</p>
<p>Nous suivrons les conventions habituelles dans l’import des packages :</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install pynsee</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Requirement already satisfied: pynsee in /opt/mamba/lib/python3.9/site-packages (0.1.4)
Requirement already satisfied: pandas&gt;=0.24.2 in /opt/mamba/lib/python3.9/site-packages (from pynsee) (2.1.1)
Requirement already satisfied: tqdm&gt;=4.56.0 in /opt/mamba/lib/python3.9/site-packages (from pynsee) (4.66.1)
Requirement already satisfied: requests&gt;=2.23 in /opt/mamba/lib/python3.9/site-packages (from pynsee) (2.31.0)
Requirement already satisfied: appdirs&gt;=1.4.4 in /opt/mamba/lib/python3.9/site-packages (from pynsee) (1.4.4)
Requirement already satisfied: unidecode&gt;=1.1.0 in /opt/mamba/lib/python3.9/site-packages (from pynsee) (1.3.6)
Requirement already satisfied: shapely&gt;=2.0.0 in /opt/mamba/lib/python3.9/site-packages (from pynsee) (2.0.1)
Requirement already satisfied: urllib3 in /opt/mamba/lib/python3.9/site-packages (from pynsee) (1.26.11)
Requirement already satisfied: numpy&gt;=1.22.4 in /opt/mamba/lib/python3.9/site-packages (from pandas&gt;=0.24.2-&gt;pynsee) (1.26.0)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /opt/mamba/lib/python3.9/site-packages (from pandas&gt;=0.24.2-&gt;pynsee) (2.8.2)
Requirement already satisfied: pytz&gt;=2020.1 in /opt/mamba/lib/python3.9/site-packages (from pandas&gt;=0.24.2-&gt;pynsee) (2022.5)
Requirement already satisfied: tzdata&gt;=2022.1 in /opt/mamba/lib/python3.9/site-packages (from pandas&gt;=0.24.2-&gt;pynsee) (2023.3)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /opt/mamba/lib/python3.9/site-packages (from requests&gt;=2.23-&gt;pynsee) (2.1.1)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /opt/mamba/lib/python3.9/site-packages (from requests&gt;=2.23-&gt;pynsee) (3.3)
Requirement already satisfied: certifi&gt;=2017.4.17 in /opt/mamba/lib/python3.9/site-packages (from requests&gt;=2.23-&gt;pynsee) (2022.9.24)
Requirement already satisfied: six&gt;=1.5 in /opt/mamba/lib/python3.9/site-packages (from python-dateutil&gt;=2.8.2-&gt;pandas&gt;=0.24.2-&gt;pynsee) (1.16.0)
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pynsee.download</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour obtenir des résultats reproductibles, on peut fixer la racine du générateur
pseudo-aléatoire.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Au cours de cette démonstration des principales fonctionalités de <code>Pandas</code>, et
lors du chapitre suivant,
je recommande de se référer régulièrement aux ressources suivantes :</p>
<ul>
<li>L’<a href="https://pandas.pydata.org/docs/user_guide/index.html">aide officielle de <code>Pandas</code></a>.
Notamment, la
<a href="https://pandas.pydata.org/pandas-docs/stable/getting_started/comparison/index.html">page de comparaison des langages</a>
qui est très utile ;</li>
<li><a href="https://observablehq.com/@observablehq/data-wrangling-translations">Ce tutoriel</a>,
pensé certes pour les utilisateurs d’<a href="https://observablehq.com"><code>Observable Javascript</code></a>,
mais qui offre de nombreux exemples intéressants pour les afficionados de <code>Pandas</code> ;</li>
<li>La <em>cheatsheet suivante</em>, <a href="https://becominghuman.ai/cheat-sheets-for-ai-neural-networks-machine-learning-deep-learning-big-data-678c51b4b463">issue de ce post</a></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://cdn-images-1.medium.com/max/2000/1*YhTbz8b8Svi22wNVvqzneg.jpeg" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Cheasheet Pandas"><img src="https://cdn-images-1.medium.com/max/2000/1*YhTbz8b8Svi22wNVvqzneg.jpeg" class="img-fluid figure-img" style="width:70.0%"></a></p>
<figcaption class="figure-caption">Cheasheet <code>Pandas</code></figcaption>
</figure>
</div>
<section id="logique-de-pandas" class="level2">
<h2 class="anchored" data-anchor-id="logique-de-pandas">Logique de <code>Pandas</code></h2>
<p>L’objet central dans la logique <code>Pandas</code> est le <code>DataFrame</code>.
Il s’agit d’une structure particulière de données
à deux dimensions, structurées en alignant des lignes et colonnes.
Contrairement à une matrice, les colonnes
peuvent être de types différents.</p>
<p>Un <code>DataFrame</code> est composé des éléments suivants :</p>
<ul>
<li>l’indice de la ligne ;</li>
<li>le nom de la colonne ;</li>
<li>la valeur de la donnée ;</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="featured.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Structuration d’un DataFrame Pandas, empruntée à https://medium.com/epfl-extension-school/selecting-data-from-a-pandas-dataframe-53917dc39953"><img src="featured.png" class="img-fluid figure-img"></a></p>
<figcaption class="figure-caption">Structuration d’un <em>DataFrame</em> <code>Pandas</code>,
empruntée à <a href="https://medium.com/epfl-extension-school/selecting-data-from-a-pandas-dataframe-53917dc39953" class="uri">https://medium.com/epfl-extension-school/selecting-data-from-a-pandas-dataframe-53917dc39953</a></figcaption>
</figure>
</div>
<p>Le concept de <strong><em>tidy</em></strong> data, popularisé par Hadley Wickham via ses packages <code>R</code>,
est parfaitement pertinent pour décrire la structure d’un <code>DataFrame pandas</code>.
Les trois règles sont les suivantes :</p>
<ul>
<li>Chaque variable possède sa propre colonne ;</li>
<li>Chaque observation possède sa propre ligne ;</li>
<li>Une valeur, matérialisant une observation d’une variable,
se trouve sur une unique cellule.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://d33wubrfki0l68.cloudfront.net/6f1ddb544fc5c69a2478e444ab8112fb0eea23f8/91adc/images/tidy-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Concept de tidy data (emprunté à H. Wickham)"><img src="https://d33wubrfki0l68.cloudfront.net/6f1ddb544fc5c69a2478e444ab8112fb0eea23f8/91adc/images/tidy-1.png" class="img-fluid figure-img"></a></p>
<figcaption class="figure-caption">Concept de tidy data (emprunté à H. Wickham)</figcaption>
</figure>
</div>
<p>Concernant la syntaxe, une partie des commandes <code>Python</code> est inspirée par la logique <code>SQL</code>.
On retrouvera ainsi une philosophie proche de celle du SQL où on fait des opérations
de sélection de ligne ou de colonne. Voici une illustration de quelques manipulations de données
que nous mettrons en oeuvre par la suite :</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><a href="select_pandas.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Sélectionner des colonnes"><img src="select_pandas.png" class="img-fluid" alt="Sélectionner des colonnes"></a>
<a href="rename_pandas.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Renommer des colonnes"><img src="rename_pandas.png" class="img-fluid" alt="Renommer des colonnes"></a></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><a href="mutate_pandas.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Créer de nouvelles colonnes"><img src="mutate_pandas.png" class="img-fluid" alt="Créer de nouvelles colonnes"></a>
<a href="filter_pandas.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Sélectionner des lignes"><img src="filter_pandas.png" class="img-fluid" alt="Sélectionner des lignes"></a></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-figure quarto-figure-center" style="flex-basis: 50.0%;justify-content: center;">
<figure class="figure">
<p><a href="arrange_pandas.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Réordonner le DataFrame"><img src="arrange_pandas.png" class="img-fluid figure-img"></a></p>
<figcaption class="figure-caption">Réordonner le <em>DataFrame</em></figcaption>
</figure>
</div>
</div>
</div>
<p><code>Pandas</code> propose énormément de fonctionnalités pré-implémentées.
Il est vivement recommandé, avant de se lancer dans l’écriture d’une
fonction, de se poser la question de son implémentation native dans <code>Numpy</code>, <code>Pandas</code>, etc.
La plupart du temps, s’il existe une solution implémentée dans une librairie, il convient
de l’utiliser car elle sera plus efficace que celle que vous mettrez en oeuvre.</p>
</section>
<section id="les-series" class="level2">
<h2 class="anchored" data-anchor-id="les-series">Les <code>Series</code></h2>
<p>En fait, un <em>DataFrame</em> est une collection d’objets appelés <code>pandas.Series</code>.
Ces <code>Series</code> sont des objets d’une dimension qui sont des extensions des
array-unidimensionnels <code>numpy</code>. En particulier, pour faciliter le traitement
de données catégorielles ou temporelles, des types de variables
supplémentaires sont disponibles dans <code>pandas</code> par rapport à
<code>numpy</code> (<code>categorical</code>, <code>datetime64</code> et <code>timedelta64</code>). Ces
types sont associés à des méthodes optimisées pour faciliter le traitement
de ces données.</p>
<p>Il ne faut pas négliger l’attribut <code>dtype</code> d’un objet
<code>pandas.Series</code> car cela a une influence déterminante sur les méthodes
et fonctions pouvant être utilisées (on ne fait pas les mêmes opérations
sur une donnée temporelle et une donnée catégorielle) et le volume en
mémoire d’une variable (le type de la variable détermine le volume
d’information stockée pour chaque élément ; être trop précis est parfois
néfaste).</p>
<p>Il existe plusieurs types possibles pour un <code>pandas.Series</code>.
Le type <code>object</code> correspond aux types Python <code>str</code> ou <code>mixed</code>.
Il existe un type particulier pour les variables dont le nombre de valeurs
est une liste finie et relativement courte, le type <code>category</code>.
Il faut bien examiner les types de son DataFrame, et convertir éventuellement
les types lors de l’étape de <code>data cleaning</code>.</p>
<section id="indexation" class="level3">
<h3 class="anchored" data-anchor-id="indexation">Indexation</h3>
<p>La différence essentielle entre une <code>Series</code> et un objet <code>numpy</code> est l’indexation.
Dans <code>numpy</code>,
l’indexation est implicite ; elle permet d’accéder à une donnée (celle à
l’index situé à la position <em>i</em>).
Avec une <code>Series</code>, on peut bien sûr utiliser un indice de position mais on peut
surtout faire appel à des indices plus explicites.
Par exemple,</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>taille <span class="op">=</span> pd.Series(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.</span>,<span class="fl">1.5</span>,<span class="dv">1</span>],</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> [<span class="st">'chat'</span>, <span class="st">'chien'</span>, <span class="st">'koala'</span>]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>taille.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>chat     1.0
chien    1.5
koala    1.0
dtype: float64</code></pre>
</div>
</div>
<p>Cette indexation permet d’accéder à des valeurs de la <code>Series</code>
via une valeur de l’indice. Par
exemple, <code>taille['koala']</code>:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>taille[<span class="st">'koala'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>1.0</code></pre>
</div>
</div>
<p>L’existence d’indice rend le <em>subsetting</em> particulièrement aisé, ce que vous
pouvez expérimenter dans les TP :</p>
<div class="cell markdown">
<p class="badges">
<a href="https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/02b_pandas_TP.ipynb" class="github"><i class="fab fa-github"></i></a>
<a href="https://downgit.github.io/#/home?url=https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Download-Notebook-important?logo=Jupyter" alt="Download"></a>
<a href="https://nbviewer.jupyter.org/github/linogaliana/python-datascientist-notebooksblob/main/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Visualize-nbviewer-blue?logo=Jupyter" alt="nbviewer"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/jupyter-python?autoLaunch=true&amp;onyxia.friendlyName=%C2%ABpython-datascience%C2%BB&amp;init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmaster%2Fsspcloud%2Finit-jupyter.sh%C2%BB&amp;init.personalInitArgs=%C2%ABmanipulation%2002b_pandas_TP%C2%BB&amp;security.allowlist.enabled=false" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Tester_avec_Jupyter-orange?logo=Jupyter&amp;logoColor=orange" alt="Onyxia"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/vscode-python?autoLaunch=true&amp;onyxia.friendlyName=%C2%ABpython-datascience%C2%BB&amp;init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmaster%2Fsspcloud%2Finit-vscode.sh%C2%BB&amp;init.personalInitArgs=%C2%ABmanipulation%2002b_pandas_TP%C2%BB&amp;security.allowlist.enabled=false" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Tester_avec_VSCode-blue?logo=visualstudiocode&amp;logoColor=blue" alt="Onyxia"></a><br>
<a href="https://mybinder.org/v2/gh/linogaliana/python-datascientist-notebooks/main?filepath={binder_path}" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Launch-Binder-E66581.svg?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFkAAABZCAMAAABi1XidAAAB8lBMVEX///9XmsrmZYH1olJXmsr1olJXmsrmZYH1olJXmsr1olJXmsrmZYH1olL1olJXmsr1olJXmsrmZYH1olL1olJXmsrmZYH1olJXmsr1olL1olJXmsrmZYH1olL1olJXmsrmZYH1olL1olL0nFf1olJXmsrmZYH1olJXmsq8dZb1olJXmsrmZYH1olJXmspXmspXmsr1olL1olJXmsrmZYH1olJXmsr1olL1olJXmsrmZYH1olL1olLeaIVXmsrmZYH1olL1olL1olJXmsrmZYH1olLna31Xmsr1olJXmsr1olJXmsrmZYH1olLqoVr1olJXmsr1olJXmsrmZYH1olL1olKkfaPobXvviGabgadXmsqThKuofKHmZ4Dobnr1olJXmsr1olJXmspXmsr1olJXmsrfZ4TuhWn1olL1olJXmsqBi7X1olJXmspZmslbmMhbmsdemsVfl8ZgmsNim8Jpk8F0m7R4m7F5nLB6jbh7jbiDirOEibOGnKaMhq+PnaCVg6qWg6qegKaff6WhnpKofKGtnomxeZy3noG6dZi+n3vCcpPDcpPGn3bLb4/Mb47UbIrVa4rYoGjdaIbeaIXhoWHmZYHobXvpcHjqdHXreHLroVrsfG/uhGnuh2bwj2Hxk17yl1vzmljzm1j0nlX1olL3AJXWAAAAbXRSTlMAEBAQHx8gICAuLjAwMDw9PUBAQEpQUFBXV1hgYGBkcHBwcXl8gICAgoiIkJCQlJicnJ2goKCmqK+wsLC4usDAwMjP0NDQ1NbW3Nzg4ODi5+3v8PDw8/T09PX29vb39/f5+fr7+/z8/Pz9/v7+zczCxgAABC5JREFUeAHN1ul3k0UUBvCb1CTVpmpaitAGSLSpSuKCLWpbTKNJFGlcSMAFF63iUmRccNG6gLbuxkXU66JAUef/9LSpmXnyLr3T5AO/rzl5zj137p136BISy44fKJXuGN/d19PUfYeO67Znqtf2KH33Id1psXoFdW30sPZ1sMvs2D060AHqws4FHeJojLZqnw53cmfvg+XR8mC0OEjuxrXEkX5ydeVJLVIlV0e10PXk5k7dYeHu7Cj1j+49uKg7uLU61tGLw1lq27ugQYlclHC4bgv7VQ+TAyj5Zc/UjsPvs1sd5cWryWObtvWT2EPa4rtnWW3JkpjggEpbOsPr7F7EyNewtpBIslA7p43HCsnwooXTEc3UmPmCNn5lrqTJxy6nRmcavGZVt/3Da2pD5NHvsOHJCrdc1G2r3DITpU7yic7w/7Rxnjc0kt5GC4djiv2Sz3Fb2iEZg41/ddsFDoyuYrIkmFehz0HR2thPgQqMyQYb2OtB0WxsZ3BeG3+wpRb1vzl2UYBog8FfGhttFKjtAclnZYrRo9ryG9uG/FZQU4AEg8ZE9LjGMzTmqKXPLnlWVnIlQQTvxJf8ip7VgjZjyVPrjw1te5otM7RmP7xm+sK2Gv9I8Gi++BRbEkR9EBw8zRUcKxwp73xkaLiqQb+kGduJTNHG72zcW9LoJgqQxpP3/Tj//c3yB0tqzaml05/+orHLksVO+95kX7/7qgJvnjlrfr2Ggsyx0eoy9uPzN5SPd86aXggOsEKW2Prz7du3VID3/tzs/sSRs2w7ovVHKtjrX2pd7ZMlTxAYfBAL9jiDwfLkq55Tm7ifhMlTGPyCAs7RFRhn47JnlcB9RM5T97ASuZXIcVNuUDIndpDbdsfrqsOppeXl5Y+XVKdjFCTh+zGaVuj0d9zy05PPK3QzBamxdwtTCrzyg/2Rvf2EstUjordGwa/kx9mSJLr8mLLtCW8HHGJc2R5hS219IiF6PnTusOqcMl57gm0Z8kanKMAQg0qSyuZfn7zItsbGyO9QlnxY0eCuD1XL2ys/MsrQhltE7Ug0uFOzufJFE2PxBo/YAx8XPPdDwWN0MrDRYIZF0mSMKCNHgaIVFoBbNoLJ7tEQDKxGF0kcLQimojCZopv0OkNOyWCCg9XMVAi7ARJzQdM2QUh0gmBozjc3Skg6dSBRqDGYSUOu66Zg+I2fNZs/M3/f/Grl/XnyF1Gw3VKCez0PN5IUfFLqvgUN4C0qNqYs5YhPL+aVZYDE4IpUk57oSFnJm4FyCqqOE0jhY2SMyLFoo56zyo6becOS5UVDdj7Vih0zp+tcMhwRpBeLyqtIjlJKAIZSbI8SGSF3k0pA3mR5tHuwPFoa7N7reoq2bqCsAk1HqCu5uvI1n6JuRXI+S1Mco54YmYTwcn6Aeic+kssXi8XpXC4V3t7/ADuTNKaQJdScAAAAAElFTkSuQmCC" alt="Binder"></a>
<a href="https://colab.research.google.com/github/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a>
<a href="https://github.dev/linogaliana/python-datascientist-notebooks/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/static/v1?logo=visualstudiocode&amp;label=&amp;message=Open%20in%20Visual%20Studio%20Code&amp;labelColor=2c2c32&amp;color=007acc&amp;logoColor=007acc" alt="githubdev"></a>
</p>
<p></p>
</div>
<p>Pour transformer un objet <code>pandas.Series</code> en array <code>numpy</code>,
on utilise la méthode <code>values</code>. Par exemple, <code>taille.values</code>:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>taille.values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>array([1. , 1.5, 1. ])</code></pre>
</div>
</div>
<p>Un avantage des <code>Series</code> par rapport à un <em>array</em> <code>numpy</code> est que
les opérations sur les <code>Series</code> alignent
automatiquement les données à partir des labels.
Avec des <code>Series</code> labélisées, il n’est ainsi pas nécessaire
de se poser la question de l’ordre des lignes.
L’exemple dans la partie suivante permettra de s’en assurer.</p>
</section>
<section id="valeurs-manquantes" class="level3">
<h3 class="anchored" data-anchor-id="valeurs-manquantes">Valeurs manquantes</h3>
<p>Par défaut, les valeurs manquantes sont affichées <code>NaN</code> et sont de type <code>np.nan</code> (pour
les valeurs temporelles, i.e.&nbsp;de type <code>datatime64</code>, les valeurs manquantes sont
<code>NaT</code>).</p>
<p>On a un comportement cohérent d’agrégation lorsqu’on combine deux <code>DataFrames</code> (ou deux colonnes).
Par exemple,</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> pd.DataFrame(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'prix'</span>: np.random.uniform(size <span class="op">=</span> <span class="dv">5</span>),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>     <span class="st">'quantite'</span>: [i<span class="op">+</span><span class="dv">1</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> [<span class="st">'yaourt'</span>,<span class="st">'pates'</span>,<span class="st">'riz'</span>,<span class="st">'tomates'</span>,<span class="st">'gateaux'</span>]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">prix</th>
<th data-quarto-table-cell-role="th">quantite</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">yaourt</td>
<td>0.696469</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">pates</td>
<td>0.286139</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">riz</td>
<td>0.226851</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">tomates</td>
<td>0.551315</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">gateaux</td>
<td>0.719469</td>
<td>5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> pd.DataFrame(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'prix'</span>: [np.nan, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>],</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>     <span class="st">'quantite'</span>: [i<span class="op">+</span><span class="dv">1</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> [<span class="st">'tomates'</span>,<span class="st">'yaourt'</span>,<span class="st">'gateaux'</span>,<span class="st">'pates'</span>,<span class="st">'riz'</span>]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">prix</th>
<th data-quarto-table-cell-role="th">quantite</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">tomates</td>
<td>NaN</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">yaourt</td>
<td>0.0</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">gateaux</td>
<td>1.0</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">pates</td>
<td>2.0</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">riz</td>
<td>3.0</td>
<td>5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">+</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">prix</th>
<th data-quarto-table-cell-role="th">quantite</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">gateaux</td>
<td>1.719469</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">pates</td>
<td>2.286139</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">riz</td>
<td>3.226851</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">tomates</td>
<td>NaN</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">yaourt</td>
<td>0.696469</td>
<td>3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>donne bien une valeur manquante pour la ligne <code>tomates</code>. Au passage, on peut remarquer que l’agrégation
a tenu compte des index.</p>
<p>Il est possible de supprimer les valeurs manquantes grâce à <code>dropna()</code>.
Cette méthode va supprimer toutes les lignes où il y a au moins une valeur manquante.
Il est aussi possible de supprimer seulement les colonnes où il y a des valeurs manquantes
dans un DataFrame avec <code>dropna()</code> avec le paramètre <code>axis=1</code> (par défaut égal à 0).</p>
<p>Il est également possible de remplir les valeurs manquantes grâce à la méthode <code>fillna()</code>.</p>
</section>
</section>
<section id="le-dataframe-pandas" class="level2">
<h2 class="anchored" data-anchor-id="le-dataframe-pandas">Le DataFrame <code>Pandas</code></h2>
<p>Le <code>DataFrame</code> est l’objet central de la librairie <code>pandas</code>.
Il s’agit d’une collection de <code>pandas.Series</code> (colonnes) alignées par les index.
Les types des variables peuvent différer.</p>
<p>Un <code>DataFrame</code> non-indexé a la structure suivante :</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'taille'</span>: [<span class="fl">1.</span>,<span class="fl">1.5</span>,<span class="dv">1</span>],</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'poids'</span> : [<span class="dv">3</span>, <span class="dv">5</span>, <span class="fl">2.5</span>]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> [<span class="st">'chat'</span>, <span class="st">'chien'</span>, <span class="st">'koala'</span>]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>df.reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">taille</th>
<th data-quarto-table-cell-role="th">poids</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>chat</td>
<td>1.0</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>chien</td>
<td>1.5</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>koala</td>
<td>1.0</td>
<td>2.5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Alors que le même <code>DataFrame</code> indexé aura la structure suivante :</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'taille'</span>: [<span class="fl">1.</span>,<span class="fl">1.5</span>,<span class="dv">1</span>],</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'poids'</span> : [<span class="dv">3</span>, <span class="dv">5</span>, <span class="fl">2.5</span>]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> [<span class="st">'chat'</span>, <span class="st">'chien'</span>, <span class="st">'koala'</span>]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">taille</th>
<th data-quarto-table-cell-role="th">poids</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">chat</td>
<td>1.0</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">chien</td>
<td>1.5</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">koala</td>
<td>1.0</td>
<td>2.5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="les-attributs-et-méthodes-utiles" class="level3">
<h3 class="anchored" data-anchor-id="les-attributs-et-méthodes-utiles">Les attributs et méthodes utiles</h3>
<p>Pour présenter les méthodes les plus pratiques pour l’analyse de données,
on peut partir de l’exemple des consommations de CO2 communales issues
des données de l’Ademe. Cette base de données est exploitée plus intensément
dans le TP.</p>
<div class="cell markdown">
<p class="badges">
<a href="https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/02b_pandas_TP.ipynb" class="github"><i class="fab fa-github"></i></a>
<a href="https://downgit.github.io/#/home?url=https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Download-Notebook-important?logo=Jupyter" alt="Download"></a>
<a href="https://nbviewer.jupyter.org/github/linogaliana/python-datascientist-notebooksblob/main/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Visualize-nbviewer-blue?logo=Jupyter" alt="nbviewer"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/jupyter-python?autoLaunch=true&amp;onyxia.friendlyName=%C2%ABpython-datascience%C2%BB&amp;init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmaster%2Fsspcloud%2Finit-jupyter.sh%C2%BB&amp;init.personalInitArgs=%C2%ABmanipulation%2002b_pandas_TP%C2%BB&amp;security.allowlist.enabled=false" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Tester_avec_Jupyter-orange?logo=Jupyter&amp;logoColor=orange" alt="Onyxia"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/vscode-python?autoLaunch=true&amp;onyxia.friendlyName=%C2%ABpython-datascience%C2%BB&amp;init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmaster%2Fsspcloud%2Finit-vscode.sh%C2%BB&amp;init.personalInitArgs=%C2%ABmanipulation%2002b_pandas_TP%C2%BB&amp;security.allowlist.enabled=false" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Tester_avec_VSCode-blue?logo=visualstudiocode&amp;logoColor=blue" alt="Onyxia"></a><br>
<a href="https://mybinder.org/v2/gh/linogaliana/python-datascientist-notebooks/main?filepath={binder_path}" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Launch-Binder-E66581.svg?logo=data:image/png;base64,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" alt="Binder"></a>
<a href="https://colab.research.google.com/github/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a>
<a href="https://github.dev/linogaliana/python-datascientist-notebooks/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/static/v1?logo=visualstudiocode&amp;label=&amp;message=Open%20in%20Visual%20Studio%20Code&amp;labelColor=2c2c32&amp;color=007acc&amp;logoColor=007acc" alt="githubdev"></a>
</p>
<p></p>
</div>
<p>L’import de données depuis un fichier plat se fait avec la fonction <a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html"><code>read_csv</code></a>:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"https://koumoul.com/s/data-fair/api/v1/datasets/igt-pouvoir-de-rechauffement-global/convert"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">INSEE commune</th>
<th data-quarto-table-cell-role="th">Commune</th>
<th data-quarto-table-cell-role="th">Agriculture</th>
<th data-quarto-table-cell-role="th">Autres transports</th>
<th data-quarto-table-cell-role="th">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">Déchets</th>
<th data-quarto-table-cell-role="th">Energie</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th data-quarto-table-cell-role="th">Résidentiel</th>
<th data-quarto-table-cell-role="th">Routier</th>
<th data-quarto-table-cell-role="th">Tertiaire</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01001</td>
<td>L'ABERGEMENT-CLEMENCIAT</td>
<td>3711.425991</td>
<td>NaN</td>
<td>NaN</td>
<td>432.751835</td>
<td>101.430476</td>
<td>2.354558</td>
<td>6.911213</td>
<td>309.358195</td>
<td>793.156501</td>
<td>367.036172</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01002</td>
<td>L'ABERGEMENT-DE-VAREY</td>
<td>475.330205</td>
<td>NaN</td>
<td>NaN</td>
<td>140.741660</td>
<td>140.675439</td>
<td>2.354558</td>
<td>6.911213</td>
<td>104.866444</td>
<td>348.997893</td>
<td>112.934207</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01004</td>
<td>AMBERIEU-EN-BUGEY</td>
<td>499.043526</td>
<td>212.577908</td>
<td>NaN</td>
<td>10313.446515</td>
<td>5314.314445</td>
<td>998.332482</td>
<td>2930.354461</td>
<td>16616.822534</td>
<td>15642.420313</td>
<td>10732.376934</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01005</td>
<td>AMBERIEUX-EN-DOMBES</td>
<td>1859.160954</td>
<td>NaN</td>
<td>NaN</td>
<td>1144.429311</td>
<td>216.217508</td>
<td>94.182310</td>
<td>276.448534</td>
<td>663.683146</td>
<td>1756.341319</td>
<td>782.404357</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01006</td>
<td>AMBLEON</td>
<td>448.966808</td>
<td>NaN</td>
<td>NaN</td>
<td>77.033834</td>
<td>48.401549</td>
<td>NaN</td>
<td>NaN</td>
<td>43.714019</td>
<td>398.786800</td>
<td>51.681756</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35793</td>
<td>95676</td>
<td>VILLERS-EN-ARTHIES</td>
<td>1628.065094</td>
<td>NaN</td>
<td>NaN</td>
<td>165.045396</td>
<td>65.063617</td>
<td>11.772789</td>
<td>34.556067</td>
<td>176.098160</td>
<td>309.627908</td>
<td>235.439109</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35794</td>
<td>95678</td>
<td>VILLIERS-ADAM</td>
<td>698.630772</td>
<td>NaN</td>
<td>NaN</td>
<td>1331.126598</td>
<td>111.480954</td>
<td>2.354558</td>
<td>6.911213</td>
<td>1395.529811</td>
<td>18759.370071</td>
<td>403.404815</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35795</td>
<td>95680</td>
<td>VILLIERS-LE-BEL</td>
<td>107.564967</td>
<td>NaN</td>
<td>NaN</td>
<td>8367.174532</td>
<td>225.622903</td>
<td>534.484607</td>
<td>1568.845431</td>
<td>22613.830247</td>
<td>12217.122402</td>
<td>13849.512001</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35796</td>
<td>95682</td>
<td>VILLIERS-LE-SEC</td>
<td>1090.890170</td>
<td>NaN</td>
<td>NaN</td>
<td>326.748418</td>
<td>108.969749</td>
<td>2.354558</td>
<td>6.911213</td>
<td>67.235487</td>
<td>4663.232127</td>
<td>85.657725</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35797</td>
<td>95690</td>
<td>WY-DIT-JOLI-VILLAGE</td>
<td>1495.103542</td>
<td>NaN</td>
<td>NaN</td>
<td>125.236417</td>
<td>97.728612</td>
<td>4.709115</td>
<td>13.822427</td>
<td>117.450851</td>
<td>504.400972</td>
<td>147.867245</td>
</tr>
</tbody>
</table>

<p>35798 rows × 12 columns</p>
</div>
</div>
</div>
<div class="cell markdown">
<div class="alert alert-info" role="alert">
<h3 class="alert-heading anchored"><i class="fa-solid fa-comment"></i> Note</h3>
<p>Dans un processus de production, où normalement on connait les types des variables du <code>DataFrame</code> qu’on va importer,
il convient de préciser les types avec lesquels on souhaite importer les données
(argument <code>dtype</code>, sous la forme d’un dictionnaire).
Cela est particulièrement important lorsqu’on désire utiliser une colonne
comme une variable textuelle mais qu’elle comporte des attributs proches d’un nombre
qui vont inciter <code>pandas</code> à l’importer sous forme de variable numérique.</p>
<p>Par exemple, une colonne <code>[00001,00002,...]</code> risque d’être importée comme une variable numérique, ignorant l’information des premiers 0 (qui peuvent pourtant la distinguer de la séquence 1, 2, etc.). Pour s’assurer que <code>pandas</code> importe sous forme textuelle la variable, on peut utiliser <code>dtype = {"code": "str"}</code>
Sinon, on peut importer le csv, et modifier les types avec <code>astype()</code>.
Avec <code>astype</code>, on peut gérer les erreurs de conversion avec le paramètre <code>errors</code>.</p>
</div>
</div>
<p>L’affichage des DataFrames est très ergonomique. On obtiendrait le même <em>output</em>
avec <code>display(df)</code>. Les premières et dernières lignes s’affichent
automatiquement. Autrement, on peut aussi faire:</p>
<ul>
<li><code>head</code> qui permet, comme son
nom l’indique, de n’afficher que les premières lignes ;</li>
<li><code>tail</code> qui permet, comme son
nom l’indique, de n’afficher que les dernières lignes</li>
<li><code>sample</code> qui permet d’afficher un échantillon aléatoire de <em>n</em> lignes.
Cette méthode propose de nombreuses options.</li>
</ul>
<div class="cell markdown">
<div class="alert alert-danger" role="alert">
<i class="fa-solid fa-triangle-exclamation"></i> Warning
<p>Il faut faire attention au <code>display</code> et aux
commandes qui révèlent des données (<code>head</code>, <code>tail</code>, etc.)
dans un <code>Notebook</code> ou un <code>Markdown</code> qui exploite
des données confidentielles lorsqu’on utilise <code>Git</code>.</p>
<p>En effet, on peut se
retrouver à partager des données, involontairement, dans l’historique
<code>Git</code>. Avec un <code>R Markdown</code>, il suffit d’ajouter les sorties au fichier
<code>.gitignore</code> (par exemple avec une balise de type <code>*.html</code>). Avec un
<code>Notebook Jupyter</code>, la démarche est plus compliquée car les fichiers
<code>.ipynb</code> intègrent dans le même document, texte, sorties et mise en forme.</p>
<p>Techniquement, il est possible d’appliquer des filtres avec <code>Git</code>
(voir
<a href="http://timstaley.co.uk/posts/making-git-and-jupyter-notebooks-play-nice/">ici</a>)
mais c’est une démarche très complexe.
Ce post de l’équipe à l’origine de <a href="https://www.fast.ai/posts/2022-08-25-jupyter-git.html">nbdev2</a>
résume bien le problème du contrôle de version avec <code>Git</code> et des solutions qui
peuvent y être apportées.</p>
<p>Une solution est d’utiliser <a href="https://quarto.org/"><code>Quarto</code></a> qui permet de générer les
<code>.ipynb</code> en <em>output</em> d’un document texte, ce qui facilite le contrôle sur les
éléments présents dans le document.</p>
</div>
</div>
</section>
<section id="dimensions-et-structure-du-dataframe" class="level3">
<h3 class="anchored" data-anchor-id="dimensions-et-structure-du-dataframe">Dimensions et structure du DataFrame</h3>
<p>Les premières méthodes utiles permettent d’afficher quelques
attributs d’un <code>DataFrame</code>.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df.axes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>[RangeIndex(start=0, stop=35798, step=1),
 Index(['INSEE commune', 'Commune', 'Agriculture', 'Autres transports',
        'Autres transports international', 'CO2 biomasse hors-total', 'Déchets',
        'Energie', 'Industrie hors-énergie', 'Résidentiel', 'Routier',
        'Tertiaire'],
       dtype='object')]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>Index(['INSEE commune', 'Commune', 'Agriculture', 'Autres transports',
       'Autres transports international', 'CO2 biomasse hors-total', 'Déchets',
       'Energie', 'Industrie hors-énergie', 'Résidentiel', 'Routier',
       'Tertiaire'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>RangeIndex(start=0, stop=35798, step=1)</code></pre>
</div>
</div>
<p>Pour connaître les dimensions d’un DataFrame, on peut utiliser quelques méthodes
pratiques :</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df.ndim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>2</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>(35798, 12)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df.size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>429576</code></pre>
</div>
</div>
<p>Pour déterminer le nombre de valeurs uniques d’une variable, plutôt que chercher à écrire soi-même une fonction,
on utilise la
méthode <code>nunique</code>. Par exemple,</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Commune'</span>].nunique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>33338</code></pre>
</div>
</div>
<p><code>pandas</code> propose énormément de méthodes utiles.
Voici un premier résumé, accompagné d’un comparatif avec <code>R</code> :</p>
<table class="table">
<colgroup>
<col style="width: 34%">
<col style="width: 15%">
<col style="width: 17%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Opération</th>
<th>pandas</th>
<th>dplyr (<code>R</code>)</th>
<th>data.table (<code>R</code>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Récupérer le nom des colonnes</td>
<td><code>df.columns</code></td>
<td><code>colnames(df)</code></td>
<td><code>colnames(df)</code></td>
</tr>
<tr class="even">
<td>Récupérer les indices</td>
<td><code>df.index</code></td>
<td></td>
<td><code>unique(df[,get(key(df))])</code></td>
</tr>
<tr class="odd">
<td>Récupérer les dimensions</td>
<td><code>df.shape</code></td>
<td><code>dim(df)</code></td>
<td><code>dim(df)</code></td>
</tr>
<tr class="even">
<td>Récupérer le nombre de valeurs uniques d’une variable</td>
<td><code>df['myvar'].nunique()</code></td>
<td><code>df %&gt;%  summarise(distinct(myvar))</code></td>
<td><code>df[,uniqueN(myvar)]</code></td>
</tr>
</tbody>
</table>
</section>
<section id="statistiques-agrégées" class="level3">
<h3 class="anchored" data-anchor-id="statistiques-agrégées">Statistiques agrégées</h3>
<p><code>pandas</code> propose une série de méthodes pour faire des statistiques
agrégées de manière efficace.</p>
<p>On peut, par exemple, appliquer des méthodes pour compter le nombre de lignes,
faire une moyenne ou une somme de l’ensemble des lignes</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df.count()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>INSEE commune                      35798
Commune                            35798
Agriculture                        35736
Autres transports                   9979
Autres transports international     2891
CO2 biomasse hors-total            35798
Déchets                            35792
Energie                            34490
Industrie hors-énergie             34490
Résidentiel                        35792
Routier                            35778
Tertiaire                          35798
dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df.mean(numeric_only <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>Agriculture                        2459.975760
Autres transports                   654.919940
Autres transports international    7692.344960
CO2 biomasse hors-total            1774.381550
Déchets                             410.806329
Energie                             662.569846
Industrie hors-énergie             2423.127789
Résidentiel                        1783.677872
Routier                            3535.501245
Tertiaire                          1105.165915
dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">sum</span>(numeric_only <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>Agriculture                        8.790969e+07
Autres transports                  6.535446e+06
Autres transports international    2.223857e+07
CO2 biomasse hors-total            6.351931e+07
Déchets                            1.470358e+07
Energie                            2.285203e+07
Industrie hors-énergie             8.357368e+07
Résidentiel                        6.384140e+07
Routier                            1.264932e+08
Tertiaire                          3.956273e+07
dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df.nunique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>INSEE commune                      35798
Commune                            33338
Agriculture                        35576
Autres transports                   9963
Autres transports international     2883
CO2 biomasse hors-total            35798
Déchets                            11016
Energie                             1453
Industrie hors-énergie              1889
Résidentiel                        35791
Routier                            35749
Tertiaire                           8663
dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df.quantile(q <span class="op">=</span> [<span class="fl">0.1</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.9</span>], numeric_only <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Agriculture</th>
<th data-quarto-table-cell-role="th">Autres transports</th>
<th data-quarto-table-cell-role="th">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">Déchets</th>
<th data-quarto-table-cell-role="th">Energie</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th data-quarto-table-cell-role="th">Résidentiel</th>
<th data-quarto-table-cell-role="th">Routier</th>
<th data-quarto-table-cell-role="th">Tertiaire</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.10</td>
<td>382.620882</td>
<td>25.034578</td>
<td>4.430792</td>
<td>109.152816</td>
<td>14.811230</td>
<td>2.354558</td>
<td>6.911213</td>
<td>50.180933</td>
<td>199.765410</td>
<td>49.289082</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0.25</td>
<td>797.682631</td>
<td>52.560412</td>
<td>10.050967</td>
<td>197.951108</td>
<td>25.655166</td>
<td>2.354558</td>
<td>6.911213</td>
<td>96.052911</td>
<td>419.700460</td>
<td>94.749885</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.50</td>
<td>1559.381285</td>
<td>106.795928</td>
<td>19.924343</td>
<td>424.849988</td>
<td>54.748653</td>
<td>4.709115</td>
<td>13.822427</td>
<td>227.091193</td>
<td>1070.895593</td>
<td>216.297718</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0.75</td>
<td>3007.883903</td>
<td>237.341501</td>
<td>32.983111</td>
<td>1094.749825</td>
<td>110.820941</td>
<td>51.800270</td>
<td>152.046694</td>
<td>749.469293</td>
<td>3098.612157</td>
<td>576.155869</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0.90</td>
<td>5442.727470</td>
<td>528.349529</td>
<td>59.999169</td>
<td>3143.759029</td>
<td>190.695774</td>
<td>367.311008</td>
<td>1154.172630</td>
<td>2937.699671</td>
<td>8151.047248</td>
<td>1897.732565</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell markdown">
<div class="alert alert-danger" role="alert">
<i class="fa-solid fa-triangle-exclamation"></i> Warning
<p>La version 2.0 de <code>Pandas</code> a introduit un changement
de comportement dans les méthodes d’agrégation.</p>
<p>Il est dorénavant nécessaire de préciser quand on désire
effectuer des opérations si on désire ou non le faire
exclusivement sur les colonnes numériques. C’est pour cette
raison qu’on exlicite ici l’argument <code>numeric_only = True</code>.
Ce comportement
était par le passé implicite.</p>
</div>
</div>
<p>Il faut toujours regarder les options de ces fonctions en termes de valeurs manquantes, car
ces options sont déterminantes dans le résultat obtenu.</p>
<p>Les exercices de TD visent à démontrer l’intérêt de ces méthodes dans quelques cas précis.</p>
<div class="cell markdown">
<p class="badges">
<a href="https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/02b_pandas_TP.ipynb" class="github"><i class="fab fa-github"></i></a>
<a href="https://downgit.github.io/#/home?url=https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Download-Notebook-important?logo=Jupyter" alt="Download"></a>
<a href="https://nbviewer.jupyter.org/github/linogaliana/python-datascientist-notebooksblob/main/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Visualize-nbviewer-blue?logo=Jupyter" alt="nbviewer"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/jupyter-python?autoLaunch=true&amp;onyxia.friendlyName=%C2%ABpython-datascience%C2%BB&amp;init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmaster%2Fsspcloud%2Finit-jupyter.sh%C2%BB&amp;init.personalInitArgs=%C2%ABmanipulation%2002b_pandas_TP%C2%BB&amp;security.allowlist.enabled=false" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Tester_avec_Jupyter-orange?logo=Jupyter&amp;logoColor=orange" alt="Onyxia"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/vscode-python?autoLaunch=true&amp;onyxia.friendlyName=%C2%ABpython-datascience%C2%BB&amp;init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmaster%2Fsspcloud%2Finit-vscode.sh%C2%BB&amp;init.personalInitArgs=%C2%ABmanipulation%2002b_pandas_TP%C2%BB&amp;security.allowlist.enabled=false" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Tester_avec_VSCode-blue?logo=visualstudiocode&amp;logoColor=blue" alt="Onyxia"></a><br>
<a href="https://mybinder.org/v2/gh/linogaliana/python-datascientist-notebooks/main?filepath={binder_path}" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Launch-Binder-E66581.svg?logo=data:image/png;base64,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" alt="Binder"></a>
<a href="https://colab.research.google.com/github/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a>
<a href="https://github.dev/linogaliana/python-datascientist-notebooks/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/static/v1?logo=visualstudiocode&amp;label=&amp;message=Open%20in%20Visual%20Studio%20Code&amp;labelColor=2c2c32&amp;color=007acc&amp;logoColor=007acc" alt="githubdev"></a>
</p>
<p></p>
</div>
<p>Le tableau suivant récapitule le code équivalent pour avoir des
statistiques sur toutes les colonnes d’un dataframe en <code>R</code>.</p>
<table class="table">
<colgroup>
<col style="width: 34%">
<col style="width: 15%">
<col style="width: 17%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Opération</th>
<th>pandas</th>
<th>dplyr (<code>R</code>)</th>
<th>data.table (<code>R</code>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Nombre de valeurs non manquantes</td>
<td><code>df.count()</code></td>
<td><code>df %&gt;% summarise_each(funs(sum(!is.na(.))))</code></td>
<td><code>df[, lapply(.SD, function(x) sum(!is.na(x)))]</code></td>
</tr>
<tr class="even">
<td>Moyenne de toutes les variables</td>
<td><code>df.mean()</code></td>
<td><code>df %&gt;% summarise_each(funs(mean((., na.rm = TRUE))))</code></td>
<td><code>df[,lapply(.SD, function(x) mean(x, na.rm = TRUE))]</code></td>
</tr>
</tbody>
</table>
<p>La méthode <code>describe</code> permet de sortir un tableau de statistiques
agrégées :</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Agriculture</th>
<th data-quarto-table-cell-role="th">Autres transports</th>
<th data-quarto-table-cell-role="th">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">Déchets</th>
<th data-quarto-table-cell-role="th">Energie</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th data-quarto-table-cell-role="th">Résidentiel</th>
<th data-quarto-table-cell-role="th">Routier</th>
<th data-quarto-table-cell-role="th">Tertiaire</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>35736.000000</td>
<td>9979.000000</td>
<td>2.891000e+03</td>
<td>35798.000000</td>
<td>35792.000000</td>
<td>3.449000e+04</td>
<td>3.449000e+04</td>
<td>35792.000000</td>
<td>35778.000000</td>
<td>35798.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>2459.975760</td>
<td>654.919940</td>
<td>7.692345e+03</td>
<td>1774.381550</td>
<td>410.806329</td>
<td>6.625698e+02</td>
<td>2.423128e+03</td>
<td>1783.677872</td>
<td>3535.501245</td>
<td>1105.165915</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>2926.957701</td>
<td>9232.816833</td>
<td>1.137643e+05</td>
<td>7871.341922</td>
<td>4122.472608</td>
<td>2.645571e+04</td>
<td>5.670374e+04</td>
<td>8915.902379</td>
<td>9663.156628</td>
<td>5164.182507</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.003432</td>
<td>0.000204</td>
<td>3.972950e-04</td>
<td>3.758088</td>
<td>0.132243</td>
<td>2.354558e+00</td>
<td>1.052998e+00</td>
<td>1.027266</td>
<td>0.555092</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>797.682631</td>
<td>52.560412</td>
<td>1.005097e+01</td>
<td>197.951108</td>
<td>25.655166</td>
<td>2.354558e+00</td>
<td>6.911213e+00</td>
<td>96.052911</td>
<td>419.700460</td>
<td>94.749885</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>1559.381285</td>
<td>106.795928</td>
<td>1.992434e+01</td>
<td>424.849988</td>
<td>54.748653</td>
<td>4.709115e+00</td>
<td>1.382243e+01</td>
<td>227.091193</td>
<td>1070.895593</td>
<td>216.297718</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>3007.883903</td>
<td>237.341501</td>
<td>3.298311e+01</td>
<td>1094.749825</td>
<td>110.820941</td>
<td>5.180027e+01</td>
<td>1.520467e+02</td>
<td>749.469293</td>
<td>3098.612157</td>
<td>576.155869</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>98949.317760</td>
<td>513140.971691</td>
<td>3.303394e+06</td>
<td>576394.181208</td>
<td>275500.374439</td>
<td>2.535858e+06</td>
<td>6.765119e+06</td>
<td>410675.902028</td>
<td>586054.672836</td>
<td>288175.400126</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="méthodes-relatives-aux-valeurs-manquantes" class="level3">
<h3 class="anchored" data-anchor-id="méthodes-relatives-aux-valeurs-manquantes">Méthodes relatives aux valeurs manquantes</h3>
<p>Les méthodes relatives aux valeurs manquantes peuvent être mobilisées
en conjonction des méthodes de statistiques agrégées. C’est utile lorsqu’on
désire obtenir une idée de la part de valeurs manquantes dans un jeu de
données</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>INSEE commune                          0
Commune                                0
Agriculture                           62
Autres transports                  25819
Autres transports international    32907
CO2 biomasse hors-total                0
Déchets                                6
Energie                             1308
Industrie hors-énergie              1308
Résidentiel                            6
Routier                               20
Tertiaire                              0
dtype: int64</code></pre>
</div>
</div>
<p>On trouvera aussi la référence à <code>isna()</code> qui est la même méthode que <code>isnull()</code>.</p>
</section>
</section>
<section id="graphiques-rapides" class="level2">
<h2 class="anchored" data-anchor-id="graphiques-rapides">Graphiques rapides</h2>
<p>Les méthodes par défaut de graphiques
(approfondies dans la <a href="#visualisation">partie visualisation</a>)
sont pratiques pour
produire rapidement un graphique, notamment après des opérations
complexes de maniement de données.</p>
<p>En effet, on peut appliquer la méthode <code>plot()</code> directement à une <code>pandas.Series</code> :</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Déchets'</span>].plot()</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Déchets'</span>].hist()</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Déchets'</span>].plot(kind <span class="op">=</span> <span class="st">'hist'</span>, logy <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> df[<span class="st">'Déchets'</span>].plot()</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig('plot_base.png', bbox_inches='tight')</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> df[<span class="st">'Déchets'</span>].hist()</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig('plot_hist.png', bbox_inches='tight')</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> df[<span class="st">'Déchets'</span>].plot(kind <span class="op">=</span> <span class="st">'hist'</span>, logy <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>fig</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.show()</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig('plot_hist_log.png', bbox_inches='tight')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>&lt;Axes: ylabel='Frequency'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02a_pandas_tutorial_files/figure-html/cell-34-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="02a_pandas_tutorial_files/figure-html/cell-34-output-2.png" width="600" height="411" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02a_pandas_tutorial_files/figure-html/cell-34-output-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="02a_pandas_tutorial_files/figure-html/cell-34-output-3.png" width="592" height="411" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="02a_pandas_tutorial_files/figure-html/cell-34-output-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="02a_pandas_tutorial_files/figure-html/cell-34-output-4.png" width="591" height="411" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>La sortie est un objet <code>matplotlib</code>. La <em>customisation</em> de ces
figures est ainsi
possible (et même désirable car les graphiques <code>matplotlib</code>
sont, par défaut, assez rudimentaires), nous en verrons quelques exemples.</p>
</section>
<section id="accéder-à-des-éléments-dun-dataframe" class="level2">
<h2 class="anchored" data-anchor-id="accéder-à-des-éléments-dun-dataframe">Accéder à des éléments d’un DataFrame</h2>
<section id="sélectionner-des-colonnes" class="level3">
<h3 class="anchored" data-anchor-id="sélectionner-des-colonnes">Sélectionner des colonnes</h3>
<p>En SQL, effectuer des opérations sur les colonnes se fait avec la commande
<code>SELECT</code>. Avec <code>pandas</code>,
pour accéder à une colonne dans son ensemble on peut
utiliser plusieurs approches :</p>
<ul>
<li><code>dataframe.variable</code>, par exemple <code>df.Energie</code>.
Cette méthode requiert néanmoins d’avoir des
noms de colonnes sans espace.</li>
<li><code>dataframe[['variable']]</code> pour renvoyer la variable sous
forme de <code>DataFrame</code> ou <code>dataframe['variable']</code> pour
la renvoyer sous forme de <code>Series</code>. Par exemple, <code>df[['Autres transports']]</code>
ou <code>df['Autres transports']</code>. C’est une manière préférable de procéder.</li>
</ul>
</section>
<section id="accéder-à-des-lignes" class="level3">
<h3 class="anchored" data-anchor-id="accéder-à-des-lignes">Accéder à des lignes</h3>
<p>Pour accéder à une ou plusieurs valeurs d’un <code>DataFrame</code>,
il existe deux manières conseillées de procéder, selon la
forme des indices de lignes ou colonnes utilisées :</p>
<ul>
<li><code>df.loc</code> : utilise les labels</li>
<li><code>df.iloc</code> : utilise les indices</li>
</ul>
<div class="cell markdown">
<div class="alert alert-danger" role="alert">
<i class="fa-solid fa-triangle-exclamation"></i> Warning
<p>Les bouts de code utilisant la structure <code>df.ix</code>
sont à bannir car la fonction est <em>deprecated</em> et peut
ainsi disparaître à tout moment.</p>
</div>
</div>
<p><code>iloc</code> va se référer à l’indexation de 0 à <em>N</em> où <em>N</em> est égal à <code>df.shape[0]</code> d’un
<code>pandas.DataFrame</code>. <code>loc</code> va se référer aux valeurs de l’index
de <code>df</code>.</p>
<p>Par exemple, avec le <code>pandas.DataFrame</code> <code>df_example</code>:</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df_example <span class="op">=</span> pd.DataFrame(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'month'</span>: [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>], <span class="st">'year'</span>: [<span class="dv">2012</span>, <span class="dv">2014</span>, <span class="dv">2013</span>, <span class="dv">2014</span>], <span class="st">'sale'</span>: [<span class="dv">55</span>, <span class="dv">40</span>, <span class="dv">84</span>, <span class="dv">31</span>]})</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>df_example <span class="op">=</span> df_example.set_index(<span class="st">'month'</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>df_example</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">sale</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012</td>
<td>55</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>2014</td>
<td>40</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>2013</td>
<td>84</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>2014</td>
<td>31</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<ul>
<li><code>df_example.loc[1, :]</code> donnera la première ligne de <code>df</code> (ligne où l’indice <code>month</code> est égal à 1) ;</li>
<li><code>df_example.iloc[1, :]</code> donnera la deuxième ligne (puisque l’indexation en <code>Python</code> commence à 0) ;</li>
<li><code>df_example.iloc[:, 1]</code> donnera la deuxième colonne, suivant le même principe.</li>
</ul>
</section>
</section>
<section id="principales-manipulation-de-données" class="level2">
<h2 class="anchored" data-anchor-id="principales-manipulation-de-données">Principales manipulation de données</h2>
<p>L’objectif du <a href="#pandasTP">TP pandas</a> est de se familiariser plus avec ces
commandes à travers l’exemple des données des émissions de C02.</p>
<p>Les opérations les plus fréquentes en <code>SQL</code> sont résumées par le tableau suivant.
Il est utile de les connaître (beaucoup de syntaxes de maniement de données
reprennent ces termes) car, d’une
manière ou d’une autre, elles couvrent la plupart
des usages de manipulation des données</p>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 20%">
<col style="width: 14%">
<col style="width: 23%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>Opération</th>
<th>SQL</th>
<th>pandas</th>
<th>dplyr (<code>R</code>)</th>
<th>data.table (<code>R</code>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Sélectionner des variables par leur nom</td>
<td><code>SELECT</code></td>
<td><code>df[['Autres transports','Energie']]</code></td>
<td><code>df %&gt;% select(Autres transports, Energie)</code></td>
<td><code>df[, c('Autres transports','Energie')]</code></td>
</tr>
<tr class="even">
<td>Sélectionner des observations selon une ou plusieurs conditions;</td>
<td><code>FILTER</code></td>
<td><code>df[df['Agriculture']&gt;2000]</code></td>
<td><code>df %&gt;% filter(Agriculture&gt;2000)</code></td>
<td><code>df[Agriculture&gt;2000]</code></td>
</tr>
<tr class="odd">
<td>Trier la table selon une ou plusieurs variables</td>
<td><code>SORT BY</code></td>
<td><code>df.sort_values(['Commune','Agriculture'])</code></td>
<td><code>df %&gt;% arrange(Commune, Agriculture)</code></td>
<td><code>df[order(Commune, Agriculture)]</code></td>
</tr>
<tr class="even">
<td>Ajouter des variables qui sont fonction d’autres variables;</td>
<td><code>SELECT *, LOG(Agriculture) AS x FROM df</code></td>
<td><code>df['x'] = np.log(df['Agriculture'])</code></td>
<td><code>df %&gt;% mutate(x = log(Agriculture))</code></td>
<td><code>df[,x := log(Agriculture)]</code></td>
</tr>
<tr class="odd">
<td>Effectuer une opération par groupe</td>
<td><code>GROUP BY</code></td>
<td><code>df.groupby('Commune').mean()</code></td>
<td><code>df %&gt;% group_by(Commune) %&gt;% summarise(m = mean)</code></td>
<td><code>df[,mean(Commune), by = Commune]</code></td>
</tr>
<tr class="even">
<td>Joindre deux bases de données (<em>inner join</em>)</td>
<td><code>SELECT * FROM table1 INNER JOIN table2 ON table1.id = table2.x</code></td>
<td><code>table1.merge(table2, left_on = 'id', right_on = 'x')</code></td>
<td><code>table1 %&gt;% inner_join(table2, by = c('id'='x'))</code></td>
<td><code>merge(table1, table2, by.x = 'id', by.y = 'x')</code></td>
</tr>
</tbody>
</table>
<section id="opérations-sur-les-colonnes-select-mutate-drop" class="level3">
<h3 class="anchored" data-anchor-id="opérations-sur-les-colonnes-select-mutate-drop">Opérations sur les colonnes : <code>select</code>, <code>mutate</code>, <code>drop</code></h3>
<p>Les <code>DataFrames</code> pandas sont des objets <em>mutables</em> en langage <code>Python</code>,
c’est-à-dire qu’il est possible de faire évoluer le <code>DataFrame</code> au grès
des opérations. L’opération la plus classique consiste à ajouter ou retirer
des variables à la table de données.</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df_new <span class="op">=</span> df.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<div class="alert alert-danger" role="alert">
<i class="fa-solid fa-triangle-exclamation"></i> Warning
<p>Attention au comportement de <code>pandas</code> lorsqu’on crée une duplication
d’un <code>DataFrame</code>.</p>
<p>Par défaut, <code>pandas</code> effectue une copie par référence. Dans ce
cas, les deux objets (la copie et l’objet copié) restent reliés. Les colonnes
créées sur l’un vont être répercutées sur l’autre. Ce comportement permet de
limiter l’inflation en mémoire de <code>Python</code>. En faisant ça, le deuxième
objet prend le même espace mémoire que le premier. Le package <code>data.table</code>
en <code>R</code> adopte le même comportement, contrairement à <code>dplyr</code>.</p>
<p>Cela peut amener à quelques surprises si ce comportement d’optimisation
n’est pas anticipé. Si vous voulez, par sécurité, conserver intact le
premier DataFrame, faites appel à une copie profonde (<em>deep copy</em>) en
utilisant la méthode <code>copy</code>, comme ci-dessus.</p>
<p>Attention toutefois, cela a un coût mémoire.
Avec des données volumineuses, c’est une pratique à utiliser avec précaution.</p>
</div>
</div>
<p>La manière la plus simple d’opérer pour ajouter des colonnes est
d’utiliser la réassignation. Par exemple, pour créer une variable
<code>x</code> qui est le <code>log</code> de la
variable <code>Agriculture</code>:</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df_new[<span class="st">'x'</span>] <span class="op">=</span> np.log(df_new[<span class="st">'Agriculture'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Il est possible d’appliquer cette approche sur plusieurs colonnes. Un des
intérêts de cette approche est qu’elle permet de recycler le nom de colonnes.</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="bu">vars</span> <span class="op">=</span> [<span class="st">'Agriculture'</span>, <span class="st">'Déchets'</span>, <span class="st">'Energie'</span>]</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>df_new[[v <span class="op">+</span> <span class="st">"_log"</span> <span class="cf">for</span> v <span class="kw">in</span> <span class="bu">vars</span>]] <span class="op">=</span> np.log(df_new[<span class="bu">vars</span>])</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>df_new</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">INSEE commune</th>
<th data-quarto-table-cell-role="th">Commune</th>
<th data-quarto-table-cell-role="th">Agriculture</th>
<th data-quarto-table-cell-role="th">Autres transports</th>
<th data-quarto-table-cell-role="th">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">Déchets</th>
<th data-quarto-table-cell-role="th">Energie</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th data-quarto-table-cell-role="th">Résidentiel</th>
<th data-quarto-table-cell-role="th">Routier</th>
<th data-quarto-table-cell-role="th">Tertiaire</th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">Agriculture_log</th>
<th data-quarto-table-cell-role="th">Déchets_log</th>
<th data-quarto-table-cell-role="th">Energie_log</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01001</td>
<td>L'ABERGEMENT-CLEMENCIAT</td>
<td>3711.425991</td>
<td>NaN</td>
<td>NaN</td>
<td>432.751835</td>
<td>101.430476</td>
<td>2.354558</td>
<td>6.911213</td>
<td>309.358195</td>
<td>793.156501</td>
<td>367.036172</td>
<td>8.219171</td>
<td>8.219171</td>
<td>4.619374</td>
<td>0.856353</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01002</td>
<td>L'ABERGEMENT-DE-VAREY</td>
<td>475.330205</td>
<td>NaN</td>
<td>NaN</td>
<td>140.741660</td>
<td>140.675439</td>
<td>2.354558</td>
<td>6.911213</td>
<td>104.866444</td>
<td>348.997893</td>
<td>112.934207</td>
<td>6.164010</td>
<td>6.164010</td>
<td>4.946455</td>
<td>0.856353</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01004</td>
<td>AMBERIEU-EN-BUGEY</td>
<td>499.043526</td>
<td>212.577908</td>
<td>NaN</td>
<td>10313.446515</td>
<td>5314.314445</td>
<td>998.332482</td>
<td>2930.354461</td>
<td>16616.822534</td>
<td>15642.420313</td>
<td>10732.376934</td>
<td>6.212693</td>
<td>6.212693</td>
<td>8.578159</td>
<td>6.906086</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01005</td>
<td>AMBERIEUX-EN-DOMBES</td>
<td>1859.160954</td>
<td>NaN</td>
<td>NaN</td>
<td>1144.429311</td>
<td>216.217508</td>
<td>94.182310</td>
<td>276.448534</td>
<td>663.683146</td>
<td>1756.341319</td>
<td>782.404357</td>
<td>7.527881</td>
<td>7.527881</td>
<td>5.376285</td>
<td>4.545232</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01006</td>
<td>AMBLEON</td>
<td>448.966808</td>
<td>NaN</td>
<td>NaN</td>
<td>77.033834</td>
<td>48.401549</td>
<td>NaN</td>
<td>NaN</td>
<td>43.714019</td>
<td>398.786800</td>
<td>51.681756</td>
<td>6.106949</td>
<td>6.106949</td>
<td>3.879532</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35793</td>
<td>95676</td>
<td>VILLERS-EN-ARTHIES</td>
<td>1628.065094</td>
<td>NaN</td>
<td>NaN</td>
<td>165.045396</td>
<td>65.063617</td>
<td>11.772789</td>
<td>34.556067</td>
<td>176.098160</td>
<td>309.627908</td>
<td>235.439109</td>
<td>7.395148</td>
<td>7.395148</td>
<td>4.175366</td>
<td>2.465791</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35794</td>
<td>95678</td>
<td>VILLIERS-ADAM</td>
<td>698.630772</td>
<td>NaN</td>
<td>NaN</td>
<td>1331.126598</td>
<td>111.480954</td>
<td>2.354558</td>
<td>6.911213</td>
<td>1395.529811</td>
<td>18759.370071</td>
<td>403.404815</td>
<td>6.549122</td>
<td>6.549122</td>
<td>4.713854</td>
<td>0.856353</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35795</td>
<td>95680</td>
<td>VILLIERS-LE-BEL</td>
<td>107.564967</td>
<td>NaN</td>
<td>NaN</td>
<td>8367.174532</td>
<td>225.622903</td>
<td>534.484607</td>
<td>1568.845431</td>
<td>22613.830247</td>
<td>12217.122402</td>
<td>13849.512001</td>
<td>4.678095</td>
<td>4.678095</td>
<td>5.418865</td>
<td>6.281303</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35796</td>
<td>95682</td>
<td>VILLIERS-LE-SEC</td>
<td>1090.890170</td>
<td>NaN</td>
<td>NaN</td>
<td>326.748418</td>
<td>108.969749</td>
<td>2.354558</td>
<td>6.911213</td>
<td>67.235487</td>
<td>4663.232127</td>
<td>85.657725</td>
<td>6.994749</td>
<td>6.994749</td>
<td>4.691070</td>
<td>0.856353</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35797</td>
<td>95690</td>
<td>WY-DIT-JOLI-VILLAGE</td>
<td>1495.103542</td>
<td>NaN</td>
<td>NaN</td>
<td>125.236417</td>
<td>97.728612</td>
<td>4.709115</td>
<td>13.822427</td>
<td>117.450851</td>
<td>504.400972</td>
<td>147.867245</td>
<td>7.309951</td>
<td>7.309951</td>
<td>4.582194</td>
<td>1.549500</td>
</tr>
</tbody>
</table>

<p>35798 rows × 16 columns</p>
</div>
</div>
</div>
<p>Il est également possible d’utiliser la méthode <code>assign</code>. Pour des opérations
vectorisées, comme le sont les opérateurs de <code>numpy</code>, cela n’a pas d’intérêt.</p>
<p>Cela permet notamment d’enchainer les opérations sur un même <code>DataFrame</code> (notamment grâce au <code>pipe</code> que
nous verrons plus loin).
Cette approche utilise généralement
des <em>lambda functions</em>. Par exemple le code précédent (celui concernant une
seule variable) prendrait la forme:</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df_new.assign(Energie_log <span class="op">=</span> <span class="kw">lambda</span> x: np.log(x[<span class="st">'Energie'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">INSEE commune</th>
<th data-quarto-table-cell-role="th">Commune</th>
<th data-quarto-table-cell-role="th">Agriculture</th>
<th data-quarto-table-cell-role="th">Autres transports</th>
<th data-quarto-table-cell-role="th">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">Déchets</th>
<th data-quarto-table-cell-role="th">Energie</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th data-quarto-table-cell-role="th">Résidentiel</th>
<th data-quarto-table-cell-role="th">Routier</th>
<th data-quarto-table-cell-role="th">Tertiaire</th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">Agriculture_log</th>
<th data-quarto-table-cell-role="th">Déchets_log</th>
<th data-quarto-table-cell-role="th">Energie_log</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01001</td>
<td>L'ABERGEMENT-CLEMENCIAT</td>
<td>3711.425991</td>
<td>NaN</td>
<td>NaN</td>
<td>432.751835</td>
<td>101.430476</td>
<td>2.354558</td>
<td>6.911213</td>
<td>309.358195</td>
<td>793.156501</td>
<td>367.036172</td>
<td>8.219171</td>
<td>8.219171</td>
<td>4.619374</td>
<td>0.856353</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01002</td>
<td>L'ABERGEMENT-DE-VAREY</td>
<td>475.330205</td>
<td>NaN</td>
<td>NaN</td>
<td>140.741660</td>
<td>140.675439</td>
<td>2.354558</td>
<td>6.911213</td>
<td>104.866444</td>
<td>348.997893</td>
<td>112.934207</td>
<td>6.164010</td>
<td>6.164010</td>
<td>4.946455</td>
<td>0.856353</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01004</td>
<td>AMBERIEU-EN-BUGEY</td>
<td>499.043526</td>
<td>212.577908</td>
<td>NaN</td>
<td>10313.446515</td>
<td>5314.314445</td>
<td>998.332482</td>
<td>2930.354461</td>
<td>16616.822534</td>
<td>15642.420313</td>
<td>10732.376934</td>
<td>6.212693</td>
<td>6.212693</td>
<td>8.578159</td>
<td>6.906086</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01005</td>
<td>AMBERIEUX-EN-DOMBES</td>
<td>1859.160954</td>
<td>NaN</td>
<td>NaN</td>
<td>1144.429311</td>
<td>216.217508</td>
<td>94.182310</td>
<td>276.448534</td>
<td>663.683146</td>
<td>1756.341319</td>
<td>782.404357</td>
<td>7.527881</td>
<td>7.527881</td>
<td>5.376285</td>
<td>4.545232</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01006</td>
<td>AMBLEON</td>
<td>448.966808</td>
<td>NaN</td>
<td>NaN</td>
<td>77.033834</td>
<td>48.401549</td>
<td>NaN</td>
<td>NaN</td>
<td>43.714019</td>
<td>398.786800</td>
<td>51.681756</td>
<td>6.106949</td>
<td>6.106949</td>
<td>3.879532</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35793</td>
<td>95676</td>
<td>VILLERS-EN-ARTHIES</td>
<td>1628.065094</td>
<td>NaN</td>
<td>NaN</td>
<td>165.045396</td>
<td>65.063617</td>
<td>11.772789</td>
<td>34.556067</td>
<td>176.098160</td>
<td>309.627908</td>
<td>235.439109</td>
<td>7.395148</td>
<td>7.395148</td>
<td>4.175366</td>
<td>2.465791</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35794</td>
<td>95678</td>
<td>VILLIERS-ADAM</td>
<td>698.630772</td>
<td>NaN</td>
<td>NaN</td>
<td>1331.126598</td>
<td>111.480954</td>
<td>2.354558</td>
<td>6.911213</td>
<td>1395.529811</td>
<td>18759.370071</td>
<td>403.404815</td>
<td>6.549122</td>
<td>6.549122</td>
<td>4.713854</td>
<td>0.856353</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35795</td>
<td>95680</td>
<td>VILLIERS-LE-BEL</td>
<td>107.564967</td>
<td>NaN</td>
<td>NaN</td>
<td>8367.174532</td>
<td>225.622903</td>
<td>534.484607</td>
<td>1568.845431</td>
<td>22613.830247</td>
<td>12217.122402</td>
<td>13849.512001</td>
<td>4.678095</td>
<td>4.678095</td>
<td>5.418865</td>
<td>6.281303</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35796</td>
<td>95682</td>
<td>VILLIERS-LE-SEC</td>
<td>1090.890170</td>
<td>NaN</td>
<td>NaN</td>
<td>326.748418</td>
<td>108.969749</td>
<td>2.354558</td>
<td>6.911213</td>
<td>67.235487</td>
<td>4663.232127</td>
<td>85.657725</td>
<td>6.994749</td>
<td>6.994749</td>
<td>4.691070</td>
<td>0.856353</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35797</td>
<td>95690</td>
<td>WY-DIT-JOLI-VILLAGE</td>
<td>1495.103542</td>
<td>NaN</td>
<td>NaN</td>
<td>125.236417</td>
<td>97.728612</td>
<td>4.709115</td>
<td>13.822427</td>
<td>117.450851</td>
<td>504.400972</td>
<td>147.867245</td>
<td>7.309951</td>
<td>7.309951</td>
<td>4.582194</td>
<td>1.549500</td>
</tr>
</tbody>
</table>

<p>35798 rows × 16 columns</p>
</div>
</div>
</div>
<p>Dans les méthodes suivantes, il est possible de modifier le <code>pandas.DataFrame</code>
<em>en place</em>, c’est à dire en ne le réassignant pas, avec le paramètre <code>inplace = True</code>.
Par défaut, <code>inplace</code> est égal à <code>False</code> et pour modifier le <code>pandas.DataFrame</code>,
il convient de le réassigner.</p>
<p>On peut facilement renommer des variables avec la méthode <code>rename</code> qui
fonctionne bien avec des dictionnaires (pour renommer des colonnes il faut
préciser le paramètre <code>axis = 1</code>):</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df_new <span class="op">=</span> df_new.rename({<span class="st">"Energie"</span>: <span class="st">"eneg"</span>, <span class="st">"Agriculture"</span>: <span class="st">"agr"</span>}, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Enfin, pour effacer des colonnes, on utilise la méthode <code>drop</code> avec l’argument
<code>columns</code>:</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df_new <span class="op">=</span> df_new.drop(columns <span class="op">=</span> [<span class="st">"eneg"</span>, <span class="st">"agr"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="réordonner" class="level3">
<h3 class="anchored" data-anchor-id="réordonner">Réordonner</h3>
<p>La méthode <code>sort_values</code> permet de réordonner un <code>DataFrame</code>. Par exemple,
si on désire classer par ordre décroissant de consommation de CO2 du secteur
résidentiel, on fera</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sort_values(<span class="st">"Résidentiel"</span>, ascending <span class="op">=</span> <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ainsi, en une ligne de code, on identifie les villes où le secteur
résidentiel consomme le plus.</p>
</section>
<section id="filtrer" class="level3">
<h3 class="anchored" data-anchor-id="filtrer">Filtrer</h3>
<p>L’opération de sélection de lignes s’appelle <code>FILTER</code> en SQL. Elle s’utilise
en fonction d’une condition logique (clause <code>WHERE</code>). On sélectionne les
données sur une condition logique. Il existe plusieurs méthodes en <code>pandas</code>.</p>
<p>La plus simple est d’utiliser les <em>boolean mask</em>, déjà vus dans le chapitre
<a href="#numpy"><code>numpy</code></a>.</p>
<p>Par exemple, pour sélectionner les communes dans les Hauts-de-Seine, on
peut utiliser le résultat de la méthode <code>str.startswith</code> (qui renvoie
<code>True</code> ou <code>False</code>) directement dans les crochets:</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">'INSEE commune'</span>].<span class="bu">str</span>.startswith(<span class="st">"92"</span>)].head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">INSEE commune</th>
<th data-quarto-table-cell-role="th">Commune</th>
<th data-quarto-table-cell-role="th">Agriculture</th>
<th data-quarto-table-cell-role="th">Autres transports</th>
<th data-quarto-table-cell-role="th">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">Déchets</th>
<th data-quarto-table-cell-role="th">Energie</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th data-quarto-table-cell-role="th">Résidentiel</th>
<th data-quarto-table-cell-role="th">Routier</th>
<th data-quarto-table-cell-role="th">Tertiaire</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">35494</td>
<td>92012</td>
<td>BOULOGNE-BILLANCOURT</td>
<td>NaN</td>
<td>1250.483441</td>
<td>34.234669</td>
<td>51730.704250</td>
<td>964.828694</td>
<td>8817.818741</td>
<td>25882.493998</td>
<td>92216.971456</td>
<td>64985.280901</td>
<td>60349.109482</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35501</td>
<td>92025</td>
<td>COLOMBES</td>
<td>NaN</td>
<td>411.371588</td>
<td>14.220061</td>
<td>53923.847088</td>
<td>698.685861</td>
<td>12855.885267</td>
<td>50244.664227</td>
<td>87469.549463</td>
<td>52070.927943</td>
<td>41526.600867</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Pour remplacer des valeurs spécifiques, on utilise la méthode <code>where</code> ou une
réassignation couplée à la méthode précédente.</p>
<p>Par exemple, pour assigner des valeurs manquantes aux départements du 92,
on peut faire cela</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>df_copy <span class="op">=</span> df.copy()</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>df_copy <span class="op">=</span> df_copy.where(<span class="op">~</span>df[<span class="st">'INSEE commune'</span>].<span class="bu">str</span>.startswith(<span class="st">"92"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>et vérifier les résultats:</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>df_copy[df[<span class="st">'INSEE commune'</span>].<span class="bu">str</span>.startswith(<span class="st">"92"</span>)].head(<span class="dv">2</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>df_copy[<span class="op">~</span>df[<span class="st">'INSEE commune'</span>].<span class="bu">str</span>.startswith(<span class="st">"92"</span>)].head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">INSEE commune</th>
<th data-quarto-table-cell-role="th">Commune</th>
<th data-quarto-table-cell-role="th">Agriculture</th>
<th data-quarto-table-cell-role="th">Autres transports</th>
<th data-quarto-table-cell-role="th">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">Déchets</th>
<th data-quarto-table-cell-role="th">Energie</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th data-quarto-table-cell-role="th">Résidentiel</th>
<th data-quarto-table-cell-role="th">Routier</th>
<th data-quarto-table-cell-role="th">Tertiaire</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">12167</td>
<td>31555</td>
<td>TOULOUSE</td>
<td>1434.045233</td>
<td>4482.980062</td>
<td>130.792683</td>
<td>576394.181208</td>
<td>88863.732538</td>
<td>91549.914092</td>
<td>277062.573234</td>
<td>410675.902028</td>
<td>586054.672836</td>
<td>288175.400126</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16774</td>
<td>44109</td>
<td>NANTES</td>
<td>248.019465</td>
<td>138738.544337</td>
<td>250814.701179</td>
<td>193478.248177</td>
<td>18162.261628</td>
<td>17461.400209</td>
<td>77897.138554</td>
<td>354259.013785</td>
<td>221068.632724</td>
<td>173447.582779</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>ou alors utiliser une réassignation plus classique:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>df_copy <span class="op">=</span> df.copy()</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>df_copy[df_copy[<span class="st">'INSEE commune'</span>].<span class="bu">str</span>.startswith(<span class="st">"92"</span>)] <span class="op">=</span> np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Il est conseillé de filtrer avec <code>loc</code> en utilisant un masque.
En effet, contrairement à <code>df[mask]</code>, <code>df.loc[mask, :]</code> permet d’indiquer clairement
à Python que l’on souhaite appliquer le masque aux labels de l’index.
Ce n’est pas le cas avec <code>df[mask]</code>.
D’ailleurs, lorsqu’on utilise la syntaxe <code>df[mask]</code>, <code>pandas</code> renvoie généralement un <em>warning</em></p>
</section>
<section id="opérations-par-groupe" class="level3">
<h3 class="anchored" data-anchor-id="opérations-par-groupe">Opérations par groupe</h3>
<p>En <code>SQL</code>, il est très simple de découper des données pour
effectuer des opérations sur des blocs cohérents et recollecter des résultats
dans la dimension appropriée.
La logique sous-jacente est celle du <em>split-apply-combine</em> qui est repris
par les langages de manipulation de données, auxquels <code>pandas</code>
<a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html">ne fait pas exception</a>.</p>
<p>L’image suivante, issue de
<a href="https://unlhcc.github.io/r-novice-gapminder/16-plyr/">ce site</a>
représente bien la manière dont fonctionne l’approche
<code>split</code>-<code>apply</code>-<code>combine</code></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://unlhcc.github.io/r-novice-gapminder/fig/12-plyr-fig1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12" title="Split-apply-combine"><img src="https://unlhcc.github.io/r-novice-gapminder/fig/12-plyr-fig1.png" class="img-fluid figure-img"></a></p>
<figcaption class="figure-caption">Split-apply-combine</figcaption>
</figure>
</div>
<p>Ce <a href="https://realpython.com/pandas-groupby/">tutoriel</a> sur le sujet
est particulièrement utile.</p>
<p>Pour donner quelques exemples, on peut créer une variable départementale qui
servira de critère de groupe.</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'dep'</span>] <span class="op">=</span> df[<span class="st">'INSEE commune'</span>].<span class="bu">str</span>[:<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En <code>pandas</code>, on utilise <code>groupby</code> pour découper les données selon un ou
plusieurs axes. Techniquement, cette opération consiste à créer une association
entre des labels (valeurs des variables de groupe) et des
observations.</p>
<p>Par exemple, pour compter le nombre de communes par département en SQL, on
utiliserait la requête suivante :</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> dep, <span class="fu">count</span>(INSEE commune)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> df</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> dep;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Ce qui, en <code>pandas</code>, donne:</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'dep'</span>)[<span class="st">"INSEE commune"</span>].count()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>dep
01    410
02    805
03    318
04    199
05    168
     ... 
91    196
92     36
93     40
94     47
95    185
Name: INSEE commune, Length: 96, dtype: int64</code></pre>
</div>
</div>
<p>La syntaxe est quasiment transparente. On peut bien sûr effectuer des opérations
par groupe sur plusieurs colonnes. Par exemple,</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'dep'</span>).mean(numeric_only <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Agriculture</th>
<th data-quarto-table-cell-role="th">Autres transports</th>
<th data-quarto-table-cell-role="th">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">Déchets</th>
<th data-quarto-table-cell-role="th">Energie</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th data-quarto-table-cell-role="th">Résidentiel</th>
<th data-quarto-table-cell-role="th">Routier</th>
<th data-quarto-table-cell-role="th">Tertiaire</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">dep</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">01</td>
<td>1974.535382</td>
<td>100.307344</td>
<td>8.900375</td>
<td>1736.353087</td>
<td>671.743966</td>
<td>280.485435</td>
<td>1744.567552</td>
<td>1346.982227</td>
<td>3988.658995</td>
<td>1021.089078</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">02</td>
<td>1585.417729</td>
<td>202.878748</td>
<td>17.390638</td>
<td>767.072924</td>
<td>223.907551</td>
<td>76.316247</td>
<td>932.135611</td>
<td>793.615867</td>
<td>1722.240298</td>
<td>403.744266</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">03</td>
<td>6132.029417</td>
<td>240.076499</td>
<td>45.429978</td>
<td>1779.630883</td>
<td>349.746819</td>
<td>326.904841</td>
<td>1452.423506</td>
<td>1401.650215</td>
<td>3662.773062</td>
<td>705.937016</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">04</td>
<td>1825.455590</td>
<td>177.321816</td>
<td>NaN</td>
<td>583.198128</td>
<td>253.975910</td>
<td>62.808435</td>
<td>313.913553</td>
<td>587.116013</td>
<td>1962.654370</td>
<td>493.609329</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">05</td>
<td>1847.508592</td>
<td>141.272766</td>
<td>NaN</td>
<td>502.012857</td>
<td>132.548068</td>
<td>34.971220</td>
<td>102.649239</td>
<td>728.734494</td>
<td>2071.010178</td>
<td>463.604908</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">91</td>
<td>802.793163</td>
<td>10114.998156</td>
<td>73976.107892</td>
<td>3716.906101</td>
<td>1496.516194</td>
<td>538.761253</td>
<td>1880.810170</td>
<td>6532.123033</td>
<td>10578.452789</td>
<td>3866.757200</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">92</td>
<td>8.309835</td>
<td>362.964554</td>
<td>13.132461</td>
<td>29663.579634</td>
<td>7347.163353</td>
<td>6745.611611</td>
<td>19627.706224</td>
<td>40744.279029</td>
<td>33289.456629</td>
<td>23222.587595</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">93</td>
<td>50.461775</td>
<td>1753.443710</td>
<td>61188.896632</td>
<td>18148.789684</td>
<td>6304.173594</td>
<td>2570.941598</td>
<td>10830.409025</td>
<td>32911.305703</td>
<td>35818.236459</td>
<td>21575.444794</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">94</td>
<td>48.072971</td>
<td>5474.808839</td>
<td>16559.384091</td>
<td>14710.744314</td>
<td>4545.099181</td>
<td>1624.281505</td>
<td>9940.192318</td>
<td>28444.561597</td>
<td>24881.531613</td>
<td>16247.876321</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>609.172047</td>
<td>682.143912</td>
<td>37984.576873</td>
<td>3408.871963</td>
<td>1334.032970</td>
<td>463.860672</td>
<td>1729.692179</td>
<td>6684.181989</td>
<td>8325.948748</td>
<td>4014.985843</td>
</tr>
</tbody>
</table>

<p>96 rows × 10 columns</p>
</div>
</div>
</div>
<p>A noter que la variable de groupe, ici <code>dep</code>, devient, par défaut, l’index
du DataFrame de sortie. Si on avait utilisé plusieurs variables de groupe,
on obtiendrait un objet multi-indexé. Sur la gestion des <code>multi-index</code>, on
pourra se référer à l’ouvrage <code>Modern Pandas</code> dont la référence est
donnée en fin de cours.</p>
<p>Tant qu’on n’appelle pas une action sur un <code>DataFrame</code> par groupe, du type
<code>head</code> ou <code>display</code>, <code>pandas</code> n’effectue aucune opération. On parle de
<em>lazy evaluation</em>. Par exemple, le résultat de <code>df.groupby('dep')</code> est
une transformation qui n’est pas encore évaluée :</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'dep'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x7f44a22cd8b0&gt;</code></pre>
</div>
</div>
<p>Il est possible d’appliquer plus d’une opération à la fois grâce à la méthode
<code>agg</code>. Par exemple, pour obtenir à la fois le minimum, la médiane et le maximum
de chaque département, on peut faire:</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>numeric_columns <span class="op">=</span> df.select_dtypes([<span class="st">'number'</span>]).columns</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>df.loc[:, numeric_columns.tolist() <span class="op">+</span> [<span class="st">"dep"</span>] ].groupby(<span class="st">'dep'</span>).agg([<span class="st">'min'</span>,<span class="st">"median"</span>,<span class="st">"max"</span>], numeric_only <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">Agriculture</th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">Autres transports</th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">Résidentiel</th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">Routier</th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">Tertiaire</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">dep</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">01</td>
<td>0.003432</td>
<td>1304.519570</td>
<td>14402.057335</td>
<td>3.307596</td>
<td>75.686090</td>
<td>617.281080</td>
<td>0.297256</td>
<td>6.985161</td>
<td>2.209492e+01</td>
<td>30.571400</td>
<td>...</td>
<td>175185.892467</td>
<td>9.607822</td>
<td>351.182294</td>
<td>57689.832901</td>
<td>20.848982</td>
<td>1598.934149</td>
<td>45258.256406</td>
<td>10.049230</td>
<td>401.490676</td>
<td>30847.366865</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">02</td>
<td>0.391926</td>
<td>1205.725078</td>
<td>13257.716591</td>
<td>0.326963</td>
<td>130.054615</td>
<td>1126.961565</td>
<td>0.517437</td>
<td>15.492120</td>
<td>5.799402e+01</td>
<td>28.294993</td>
<td>...</td>
<td>220963.067245</td>
<td>7.849347</td>
<td>138.819865</td>
<td>99038.124236</td>
<td>22.936184</td>
<td>700.826152</td>
<td>49245.101730</td>
<td>6.220952</td>
<td>130.639994</td>
<td>34159.345750</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">03</td>
<td>5.041238</td>
<td>5382.194339</td>
<td>24912.249269</td>
<td>24.158870</td>
<td>144.403590</td>
<td>1433.217868</td>
<td>29.958027</td>
<td>42.762328</td>
<td>8.269019e+01</td>
<td>44.825515</td>
<td>...</td>
<td>154061.446374</td>
<td>19.441088</td>
<td>217.959697</td>
<td>75793.882483</td>
<td>120.667614</td>
<td>1426.905646</td>
<td>40957.845304</td>
<td>17.705787</td>
<td>191.892445</td>
<td>31099.772884</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">04</td>
<td>30.985972</td>
<td>1404.752852</td>
<td>11423.535554</td>
<td>33.513854</td>
<td>158.780500</td>
<td>362.637639</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>7.162928</td>
<td>...</td>
<td>16889.531061</td>
<td>1.708652</td>
<td>133.130946</td>
<td>18088.189529</td>
<td>30.206298</td>
<td>687.390045</td>
<td>31438.078325</td>
<td>0.957070</td>
<td>122.504902</td>
<td>16478.024806</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">05</td>
<td>38.651727</td>
<td>1520.896526</td>
<td>13143.465812</td>
<td>0.299734</td>
<td>139.754980</td>
<td>456.042002</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>20.931602</td>
<td>...</td>
<td>4271.129851</td>
<td>6.871678</td>
<td>211.945147</td>
<td>46486.555748</td>
<td>57.132270</td>
<td>958.506314</td>
<td>37846.651181</td>
<td>4.785348</td>
<td>151.695524</td>
<td>23666.235898</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">91</td>
<td>0.400740</td>
<td>516.908303</td>
<td>5965.349174</td>
<td>25.785594</td>
<td>177.177127</td>
<td>513140.971691</td>
<td>1.651873</td>
<td>14.762210</td>
<td>7.858782e+05</td>
<td>41.661474</td>
<td>...</td>
<td>50288.560827</td>
<td>15.886514</td>
<td>2580.902085</td>
<td>48464.979708</td>
<td>20.260110</td>
<td>3610.009634</td>
<td>72288.020125</td>
<td>36.368643</td>
<td>1428.426303</td>
<td>38296.204729</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">92</td>
<td>0.073468</td>
<td>6.505185</td>
<td>32.986132</td>
<td>7.468879</td>
<td>297.529178</td>
<td>1250.483441</td>
<td>1.104401</td>
<td>11.482381</td>
<td>3.423467e+01</td>
<td>2173.614704</td>
<td>...</td>
<td>95840.512400</td>
<td>4122.277198</td>
<td>33667.904692</td>
<td>92216.971456</td>
<td>4968.382962</td>
<td>23516.458236</td>
<td>113716.853033</td>
<td>800.588678</td>
<td>18086.633085</td>
<td>65043.364499</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">93</td>
<td>3.308495</td>
<td>3.308495</td>
<td>1362.351634</td>
<td>24.188172</td>
<td>320.755486</td>
<td>45251.869710</td>
<td>0.171075</td>
<td>12.449476</td>
<td>1.101146e+06</td>
<td>899.762120</td>
<td>...</td>
<td>89135.302368</td>
<td>4364.038661</td>
<td>31428.227282</td>
<td>87927.730552</td>
<td>1632.496185</td>
<td>22506.758771</td>
<td>193039.792609</td>
<td>2257.370945</td>
<td>20864.923339</td>
<td>71918.163984</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">94</td>
<td>1.781885</td>
<td>1.781885</td>
<td>556.939161</td>
<td>6.249609</td>
<td>294.204166</td>
<td>103252.271268</td>
<td>0.390223</td>
<td>14.944807</td>
<td>1.571965e+05</td>
<td>928.232154</td>
<td>...</td>
<td>96716.055178</td>
<td>2668.358896</td>
<td>24372.900300</td>
<td>100948.169898</td>
<td>1266.101605</td>
<td>19088.651049</td>
<td>97625.957714</td>
<td>1190.115985</td>
<td>14054.223449</td>
<td>58528.623477</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>8.779506</td>
<td>445.279844</td>
<td>2987.287417</td>
<td>1.749091</td>
<td>80.838639</td>
<td>44883.982753</td>
<td>0.201508</td>
<td>13.149987</td>
<td>1.101131e+06</td>
<td>13.490977</td>
<td>...</td>
<td>66216.914749</td>
<td>11.585833</td>
<td>1434.343631</td>
<td>104543.465908</td>
<td>2.619451</td>
<td>3417.197938</td>
<td>147040.904455</td>
<td>11.484835</td>
<td>725.467969</td>
<td>61497.821477</td>
</tr>
</tbody>
</table>

<p>96 rows × 30 columns</p>
</div>
</div>
</div>
<p>La première ligne est présente pour nous faciliter la récupération des noms de colonnes des variables
numériques</p>
</section>
<section id="appliquer-des-fonctions" class="level3">
<h3 class="anchored" data-anchor-id="appliquer-des-fonctions">Appliquer des fonctions</h3>
<p><code>pandas</code> est, comme on a pu le voir, un package très flexible, qui
propose une grande variété de méthodes optimisées. Cependant, il est fréquent
d’avoir besoin de méthodes non implémentées.</p>
<p>Dans ce cas, on recourt souvent aux <code>lambda</code> functions. Par exemple, si
on désire connaître les communes dont le nom fait plus de 40 caractères,
on peut appliquer la fonction <code>len</code> de manière itérative:</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Noms de communes superieurs à 40 caracteres</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">'Commune'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> s: <span class="bu">len</span>(s)<span class="op">&gt;</span><span class="dv">40</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">INSEE commune</th>
<th data-quarto-table-cell-role="th">Commune</th>
<th data-quarto-table-cell-role="th">Agriculture</th>
<th data-quarto-table-cell-role="th">Autres transports</th>
<th data-quarto-table-cell-role="th">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">Déchets</th>
<th data-quarto-table-cell-role="th">Energie</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th data-quarto-table-cell-role="th">Résidentiel</th>
<th data-quarto-table-cell-role="th">Routier</th>
<th data-quarto-table-cell-role="th">Tertiaire</th>
<th data-quarto-table-cell-role="th">dep</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">28082</td>
<td>70058</td>
<td>BEAUJEU-SAINT-VALLIER-PIERREJUX-ET-QUITTEUR</td>
<td>4024.909815</td>
<td>736.948351</td>
<td>41.943384</td>
<td>1253.135313</td>
<td>125.101996</td>
<td>2.354558</td>
<td>6.911213</td>
<td>549.734302</td>
<td>1288.215480</td>
<td>452.693897</td>
<td>70</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4984</td>
<td>14621</td>
<td>SAINT-MARTIN-DE-BIENFAITE-LA-CRESSONNIERE</td>
<td>1213.333523</td>
<td>NaN</td>
<td>NaN</td>
<td>677.571743</td>
<td>72.072503</td>
<td>63.573059</td>
<td>186.602760</td>
<td>298.261044</td>
<td>1396.353375</td>
<td>260.801452</td>
<td>14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19276</td>
<td>51513</td>
<td>SAINT-REMY-EN-BOUZEMONT-SAINT-GENEST-ET-ISSON</td>
<td>1927.401921</td>
<td>NaN</td>
<td>NaN</td>
<td>595.583152</td>
<td>71.675773</td>
<td>4.709115</td>
<td>13.822427</td>
<td>273.826687</td>
<td>521.864748</td>
<td>259.365848</td>
<td>51</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5402</td>
<td>16053</td>
<td>BORS (CANTON DE BAIGNES-SAINTE-RADEGONDE)</td>
<td>1919.249545</td>
<td>NaN</td>
<td>NaN</td>
<td>165.443226</td>
<td>16.265904</td>
<td>2.354558</td>
<td>6.911213</td>
<td>54.561623</td>
<td>719.293151</td>
<td>58.859777</td>
<td>16</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Cependant, toutes les <code>lambda</code> functions ne se justifient pas.
Par exemple, prenons
le résultat d’agrégation précédent. Imaginons qu’on désire avoir les résultats
en milliers de tonnes. Dans ce cas, le premier réflexe est d’utiliser
la <code>lambda</code> function suivante :</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>numeric_columns <span class="op">=</span> df.select_dtypes([<span class="st">'number'</span>]).columns</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>(df</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    .loc[:, numeric_columns.tolist() <span class="op">+</span> [<span class="st">"dep"</span>] ]</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'dep'</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    .agg([<span class="st">'min'</span>,<span class="st">"median"</span>,<span class="st">"max"</span>])</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(<span class="kw">lambda</span> s: s<span class="op">/</span><span class="dv">1000</span>)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">Agriculture</th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">Autres transports</th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">Autres transports international</th>
<th data-quarto-table-cell-role="th">CO2 biomasse hors-total</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Industrie hors-énergie</th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">Résidentiel</th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">Routier</th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">Tertiaire</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">dep</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">01</td>
<td>0.000003</td>
<td>1.304520</td>
<td>14.402057</td>
<td>0.003308</td>
<td>0.075686</td>
<td>0.617281</td>
<td>0.000297</td>
<td>0.006985</td>
<td>0.022095</td>
<td>0.030571</td>
<td>...</td>
<td>175.185892</td>
<td>0.009608</td>
<td>0.351182</td>
<td>57.689833</td>
<td>0.020849</td>
<td>1.598934</td>
<td>45.258256</td>
<td>0.010049</td>
<td>0.401491</td>
<td>30.847367</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">02</td>
<td>0.000392</td>
<td>1.205725</td>
<td>13.257717</td>
<td>0.000327</td>
<td>0.130055</td>
<td>1.126962</td>
<td>0.000517</td>
<td>0.015492</td>
<td>0.057994</td>
<td>0.028295</td>
<td>...</td>
<td>220.963067</td>
<td>0.007849</td>
<td>0.138820</td>
<td>99.038124</td>
<td>0.022936</td>
<td>0.700826</td>
<td>49.245102</td>
<td>0.006221</td>
<td>0.130640</td>
<td>34.159346</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">03</td>
<td>0.005041</td>
<td>5.382194</td>
<td>24.912249</td>
<td>0.024159</td>
<td>0.144404</td>
<td>1.433218</td>
<td>0.029958</td>
<td>0.042762</td>
<td>0.082690</td>
<td>0.044826</td>
<td>...</td>
<td>154.061446</td>
<td>0.019441</td>
<td>0.217960</td>
<td>75.793882</td>
<td>0.120668</td>
<td>1.426906</td>
<td>40.957845</td>
<td>0.017706</td>
<td>0.191892</td>
<td>31.099773</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">04</td>
<td>0.030986</td>
<td>1.404753</td>
<td>11.423536</td>
<td>0.033514</td>
<td>0.158781</td>
<td>0.362638</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.007163</td>
<td>...</td>
<td>16.889531</td>
<td>0.001709</td>
<td>0.133131</td>
<td>18.088190</td>
<td>0.030206</td>
<td>0.687390</td>
<td>31.438078</td>
<td>0.000957</td>
<td>0.122505</td>
<td>16.478025</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">05</td>
<td>0.038652</td>
<td>1.520897</td>
<td>13.143466</td>
<td>0.000300</td>
<td>0.139755</td>
<td>0.456042</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.020932</td>
<td>...</td>
<td>4.271130</td>
<td>0.006872</td>
<td>0.211945</td>
<td>46.486556</td>
<td>0.057132</td>
<td>0.958506</td>
<td>37.846651</td>
<td>0.004785</td>
<td>0.151696</td>
<td>23.666236</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">91</td>
<td>0.000401</td>
<td>0.516908</td>
<td>5.965349</td>
<td>0.025786</td>
<td>0.177177</td>
<td>513.140972</td>
<td>0.001652</td>
<td>0.014762</td>
<td>785.878155</td>
<td>0.041661</td>
<td>...</td>
<td>50.288561</td>
<td>0.015887</td>
<td>2.580902</td>
<td>48.464980</td>
<td>0.020260</td>
<td>3.610010</td>
<td>72.288020</td>
<td>0.036369</td>
<td>1.428426</td>
<td>38.296205</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">92</td>
<td>0.000073</td>
<td>0.006505</td>
<td>0.032986</td>
<td>0.007469</td>
<td>0.297529</td>
<td>1.250483</td>
<td>0.001104</td>
<td>0.011482</td>
<td>0.034235</td>
<td>2.173615</td>
<td>...</td>
<td>95.840512</td>
<td>4.122277</td>
<td>33.667905</td>
<td>92.216971</td>
<td>4.968383</td>
<td>23.516458</td>
<td>113.716853</td>
<td>0.800589</td>
<td>18.086633</td>
<td>65.043364</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">93</td>
<td>0.003308</td>
<td>0.003308</td>
<td>1.362352</td>
<td>0.024188</td>
<td>0.320755</td>
<td>45.251870</td>
<td>0.000171</td>
<td>0.012449</td>
<td>1101.145545</td>
<td>0.899762</td>
<td>...</td>
<td>89.135302</td>
<td>4.364039</td>
<td>31.428227</td>
<td>87.927731</td>
<td>1.632496</td>
<td>22.506759</td>
<td>193.039793</td>
<td>2.257371</td>
<td>20.864923</td>
<td>71.918164</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">94</td>
<td>0.001782</td>
<td>0.001782</td>
<td>0.556939</td>
<td>0.006250</td>
<td>0.294204</td>
<td>103.252271</td>
<td>0.000390</td>
<td>0.014945</td>
<td>157.196520</td>
<td>0.928232</td>
<td>...</td>
<td>96.716055</td>
<td>2.668359</td>
<td>24.372900</td>
<td>100.948170</td>
<td>1.266102</td>
<td>19.088651</td>
<td>97.625958</td>
<td>1.190116</td>
<td>14.054223</td>
<td>58.528623</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>0.008780</td>
<td>0.445280</td>
<td>2.987287</td>
<td>0.001749</td>
<td>0.080839</td>
<td>44.883983</td>
<td>0.000202</td>
<td>0.013150</td>
<td>1101.131222</td>
<td>0.013491</td>
<td>...</td>
<td>66.216915</td>
<td>0.011586</td>
<td>1.434344</td>
<td>104.543466</td>
<td>0.002619</td>
<td>3.417198</td>
<td>147.040904</td>
<td>0.011485</td>
<td>0.725468</td>
<td>61.497821</td>
</tr>
</tbody>
</table>

<p>96 rows × 30 columns</p>
</div>
</div>
</div>
<p>En effet, cela effectue le résultat désiré. Cependant, il y a mieux : utiliser
la méthode <code>div</code>:</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> timeit</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>df_numeric <span class="op">=</span> df.loc[:, numeric_columns.tolist() <span class="op">+</span> [<span class="st">"dep"</span>] ]</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit df_numeric.groupby(<span class="st">'dep'</span>).agg([<span class="st">'min'</span>,<span class="st">"median"</span>,<span class="st">"max"</span>]).div(<span class="dv">1000</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit df_numeric.groupby(<span class="st">'dep'</span>).agg([<span class="st">'min'</span>,<span class="st">"median"</span>,<span class="st">"max"</span>]).<span class="bu">apply</span>(<span class="kw">lambda</span> s: s<span class="op">/</span><span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La méthode <code>div</code> est en moyenne plus rapide et a un temps d’exécution
moins variable. Dans ce cas, on pourrait même utiliser le principe
du <em>broadcasting</em> de numpy (cf.&nbsp;<a href="numpy">chapitre numpy</a>) qui offre
des performances équivalentes:</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit df_numeric.groupby(<span class="st">'dep'</span>).agg([<span class="st">'min'</span>,<span class="st">"median"</span>,<span class="st">"max"</span>])<span class="op">/</span><span class="dv">1000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>apply</code> est plus rapide qu’une boucle (en interne, <code>apply</code> utilise <code>Cython</code>
pour itérer) mais reste moins rapide qu’une solution vectorisée quand
elle existe. Ce <a href="https://realpython.com/fast-flexible-pandas/#pandas-apply">site</a>
propose des solutions, par exemple les méthodes <code>isin</code> ou <code>digitize</code>, pour
éviter de manuellement créer des boucles lentes.</p>
<p>En particulier, il faut noter que <code>apply</code> avec le paramètre <code>axis=1</code> est en générale lente.</p>
</section>
<section id="joindre-des-données" class="level3">
<h3 class="anchored" data-anchor-id="joindre-des-données">Joindre des données</h3>
<p>Il est commun de devoir combiner des données issues de sources différentes.
Nous allons ici nous focaliser sur le cas le plus favorable qui est la situation
où une information permet d’apparier de manière exacte deux bases de données (autrement nous
serions dans une situation, beaucoup plus complexe, d’appariement flou<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>).</p>
<p>La situation typique est l’appariement entre deux sources de données selon un identifiant
individuel. Ici, il s’agit d’un identifiant de code commune.</p>
<p>Il est recommandé de lire <a href="https://www.book.utilitr.org/03_fiches_thematiques/fiche_joindre_donnees">ce guide assez complet sur la question des jointures avec <code>R</code></a>
qui donne des recommandations également utiles pour un utilisateur de <code>Python</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://external-preview.redd.it/yOLzCR0qSzul2WpjQorxINB0xpU3_N9twmFVsgbGJwQ.jpg?auto=webp&amp;s=4feedc91302ba635b3028a21b98d047def5cdc2b" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="https://external-preview.redd.it/yOLzCR0qSzul2WpjQorxINB0xpU3_N9twmFVsgbGJwQ.jpg?auto=webp&amp;s=4feedc91302ba635b3028a21b98d047def5cdc2b" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>On utilise de manière indifférente les termes <em>merge</em> ou <em>join</em>.
Le deuxième terme provient de la syntaxe SQL.
En <code>Pandas</code>, dans la plupart des cas, on peut utiliser indifféremment <code>df.join</code> et <code>df.merge</code></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="pandas_join.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="pandas_join.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>Il est aussi possible de réaliser un merge en utilisant la fonction <code>pandas.concat()</code> avec <code>axis=1</code>.
Se référer à la documentation de <code>concat</code> pour voir les options possibles.</p>
</section>
<section id="restructurer-des-données-reshape" class="level3">
<h3 class="anchored" data-anchor-id="restructurer-des-données-reshape">Restructurer des données (<em>reshape</em>)</h3>
<p>On présente généralement deux types de données :</p>
<ul>
<li>format <strong>wide</strong> : les données comportent des observations répétées, pour un même individu (ou groupe), dans des colonnes différentes</li>
<li>format <strong>long</strong> : les données comportent des observations répétées, pour un même individu, dans des lignes différentes avec une colonne permettant de distinguer les niveaux d’observations</li>
</ul>
<p>Un exemple de la distinction entre les deux peut être emprunté à l’ouvrage de référence d’Hadley Wickham, <em>R for Data Science</em>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://d33wubrfki0l68.cloudfront.net/3aea19108d39606bbe49981acda07696c0c7fcd8/2de65/images/tidy-9.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="https://d33wubrfki0l68.cloudfront.net/3aea19108d39606bbe49981acda07696c0c7fcd8/2de65/images/tidy-9.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>L’aide mémoire suivante aidera à se rappeler les fonctions à appliquer si besoin :</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="reshape.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="reshape.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>Le fait de passer d’un format <em>wide</em> au format <em>long</em> (ou vice-versa) peut être extrêmement pratique car
certaines fonctions sont plus adéquates sur une forme de données ou sur l’autre.
En règle générale, avec <code>Python</code> comme avec <code>R</code>, les formats <em>long</em> sont souvent préférables.</p>
<p>Le chapitre suivant, qui fait office de TP, proposera des applications de ces principes :</p>
<div class="cell markdown">
<p class="badges">
<a href="https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/02b_pandas_TP.ipynb" class="github"><i class="fab fa-github"></i></a>
<a href="https://downgit.github.io/#/home?url=https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Download-Notebook-important?logo=Jupyter" alt="Download"></a>
<a href="https://nbviewer.jupyter.org/github/linogaliana/python-datascientist-notebooksblob/main/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Visualize-nbviewer-blue?logo=Jupyter" alt="nbviewer"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/jupyter-python?autoLaunch=true&amp;onyxia.friendlyName=%C2%ABpython-datascience%C2%BB&amp;init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmaster%2Fsspcloud%2Finit-jupyter.sh%C2%BB&amp;init.personalInitArgs=%C2%ABmanipulation%2002b_pandas_TP%C2%BB&amp;security.allowlist.enabled=false" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Tester_avec_Jupyter-orange?logo=Jupyter&amp;logoColor=orange" alt="Onyxia"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/vscode-python?autoLaunch=true&amp;onyxia.friendlyName=%C2%ABpython-datascience%C2%BB&amp;init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmaster%2Fsspcloud%2Finit-vscode.sh%C2%BB&amp;init.personalInitArgs=%C2%ABmanipulation%2002b_pandas_TP%C2%BB&amp;security.allowlist.enabled=false" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Tester_avec_VSCode-blue?logo=visualstudiocode&amp;logoColor=blue" alt="Onyxia"></a><br>
<a href="https://mybinder.org/v2/gh/linogaliana/python-datascientist-notebooks/main?filepath={binder_path}" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Launch-Binder-E66581.svg?logo=data:image/png;base64,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" alt="Binder"></a>
<a href="https://colab.research.google.com/github/linogaliana/python-datascientist-notebooks/blob/main/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a>
<a href="https://github.dev/linogaliana/python-datascientist-notebooks/notebooks/manipulation/02b_pandas_TP.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/static/v1?logo=visualstudiocode&amp;label=&amp;message=Open%20in%20Visual%20Studio%20Code&amp;labelColor=2c2c32&amp;color=007acc&amp;logoColor=007acc" alt="githubdev"></a>
</p>
<p></p>
</div>
</section>
<section id="les-pipe" class="level3">
<h3 class="anchored" data-anchor-id="les-pipe">Les pipe</h3>
<p>En général, dans un projet, le nettoyage de données va consister en un ensemble de
méthodes appliquées à un <code>pandas.DataFrame</code>.
On a vu que <code>assign</code> permettait de créer une variable dans un <code>DataFrame</code>.
Il est également possible d’appliquer une fonction, appelée par exemple <code>my_udf</code> au
DataFrame grâce à <code>pipe</code>:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> (pd.read_csv(path2data)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>            .pipe(my_udf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>L’utilisation des <code>pipe</code> rend le code très lisible et peut être très
pratique lorsqu’on enchaine des opérations sur le même
<em>dataset</em>.</p>
</section>
</section>
<section id="quelques-enjeux-de-performance" class="level2">
<h2 class="anchored" data-anchor-id="quelques-enjeux-de-performance">Quelques enjeux de performance</h2>
<p>La librairie <code>Dask</code> intègre la structure de <code>numpy</code>, <code>pandas</code> et <code>sklearn</code>.
Elle a vocation à traiter de données en grande dimension, ainsi elle ne sera pas
optimale pour des données qui tiennent très bien en RAM.
Il s’agit d’une librairie construite sur la parallélisation.
<a href="../../dask.html">Un chapitre dans ce cours</a> lui est consacré.
Pour aller plus loin, se référer à la <a href="https://docs.dask.org/en/latest/">documentation de <code>Dask</code></a>.</p>
</section>
<section id="références" class="level2">
<h2 class="anchored" data-anchor-id="références">Références</h2>
<ul>
<li><p>Le site
<a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/basics.html">pandas.pydata</a>
fait office de référence</p></li>
<li><p>Le livre <code>Modern Pandas</code> de Tom Augspurger : https://tomaugspurger.github.io/modern-1-intro.html</p></li>
</ul>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-mckinney2012python" class="csl-entry" role="listitem">
McKinney, Wes. 2012. <em>Python for Data Analysis: Data Wrangling with Pandas, NumPy, and IPython</em>. " O’Reilly Media, Inc.".
</div>
</div>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Sur l’appariement flou, se reporter aux chapitres présentant <code>ElasticSearch</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@book{galiana2023,
  author = {Galiana, Lino},
  title = {Python Pour La Data Science},
  date = {2023},
  url = {https://pythonds.linogaliana.fr/},
  doi = {10.5281/zenodo.8229676},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-galiana2023" class="csl-entry quarto-appendix-citeas" role="listitem">
Galiana, Lino. 2023. <em>Python Pour La Data Science</em>. <a href="https://doi.org/10.5281/zenodo.8229676">https://doi.org/10.5281/zenodo.8229676</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="linogaliana/python-datascientist" data-repo-id="MDEwOlJlcG9zaXRvcnkyODAxNjE2Nzc=" data-category="General" data-category-id="DIC_kwDOELLtjc4B-5TX" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../content/manipulation/01_numpy.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Numpy, la brique de base de la data science</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../content/manipulation/02b_pandas_TP.html" class="pagination-link">
        <span class="nav-page-text">Pratique de pandas : un exemple complet</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Python pour la <em>data science</em>, Lino Galiana.<br>
Licence <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i><br>
Code source disponible sur <a href="https://github.com/linogaliana/python-datascientist"><code>Github</code></a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Site construit avec <i class="fa-brands fa-python" aria-label="python"></i> et <a href="https://quarto.org/"><code>Quarto</code></a><br>
Inspiration pour la mise en forme du site <a href="https://www.andreashandel.com">ici</a><br>
<a href="https://github.com/linogaliana/python-datascientist">Code source disponible sur <i class="fa-brands fa-github" aria-label="github"></i> <code>GitHub</code></a></div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"selector":".lightbox","openEffect":"zoom","loop":true,"descPosition":"bottom","closeEffect":"zoom"});</script>



</body></html>