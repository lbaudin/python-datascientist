<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lino Galiana">
<meta name="dcterms.date" content="2020-10-20">
<meta name="description" content="Les pipelines scikit permettent d’intégrer de manière très flexible un ensemble d’opérations de pre-processing et d’entraînement de modèles dans une chaîne d’opérations. Il s’agit d’une approche particulièrement appropriée pour réduire la difficulté à changer d’algorithme ou pour faciliter la ré-application d’un code à de nouvelles données">

<title>Python pour la data science - Premier pas vers l’industrialisation avec les pipelines scikit</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../content/modelisation/5_clustering.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #e9f3fa;
      }
</style>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="Python pour la data science - Premier pas vers l’industrialisation avec les pipelines scikit">
<meta name="twitter:description" content="Les pipelines scikit permettent d’intégrer de manière très flexible
un ensemble d’opérations de pre-processing et d’entraînement de modèles
dans une chaîne d’opérations. Il s’agit d’une approche particulièrement
appropriée pour réduire la difficulté à changer d’algorithme ou pour
faciliter la ré-application d’un code à de nouvelles données">
<meta name="twitter:image" content="https://pythonds.linogaliana.fr/content/modelisation/featured.png">
<meta name="twitter:image-height" content="293">
<meta name="twitter:image-width" content="293">
<meta name="twitter:card" content="summary_large_image">
<meta name="citation_title" content="Python pour la data science">
<meta name="citation_author" content="Lino Galiana">
<meta name="citation_publication_date" content="2023">
<meta name="citation_cover_date" content="2023">
<meta name="citation_year" content="2023">
<meta name="citation_online_date" content="2020-10-20">
<meta name="citation_fulltext_html_url" content="https://pythonds.linogaliana.fr/">
<meta name="citation_doi" content="10.5281/zenodo.8229676">
<meta name="citation_language" content="en">
</head>

<body class="nav-sidebar floating nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Python pour la data science</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-introduction" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Introduction</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-introduction">    
        <li>
    <a class="dropdown-item" href="../../content/getting-started/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/01_installation.html" rel="" target="">
 <span class="dropdown-text">Configuration de Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/02_DS_environment.html" rel="" target="">
 <span class="dropdown-text">L’environnement Python pour la data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/03_data_analysis.html" rel="" target="">
 <span class="dropdown-text">Comment aborder un jeu de données</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/04_python_practice.html" rel="" target="">
 <span class="dropdown-text">Bonne pratique de Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/05_rappels_types.html" rel="" target="">
 <span class="dropdown-text">Quelques rappels sur les principes de base de Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/06_rappels_fonctions.html" rel="" target="">
 <span class="dropdown-text">Modules, tests, boucles, fonctions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/07_rappels_classes.html" rel="" target="">
 <span class="dropdown-text">Les classes en Python</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-manipuler" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Manipuler</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-manipuler">    
        <li>
    <a class="dropdown-item" href="../../content/manipulation/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/01_numpy.html" rel="" target="">
 <span class="dropdown-text">Numpy, la brique de base de la data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/02a_pandas_tutorial.html" rel="" target="">
 <span class="dropdown-text">Introduction à Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/02b_pandas_TP.html" rel="" target="">
 <span class="dropdown-text">Pratique de pandas : un exemple complet</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/03_geopandas_tutorial.html" rel="" target="">
 <span class="dropdown-text">Données spatiales : découverte de geopandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/03_geopandas_TP.html" rel="" target="">
 <span class="dropdown-text">Pratique de geopandas avec les données vélib</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04a_webscraping_TP.html" rel="" target="">
 <span class="dropdown-text">Web scraping avec Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04c_API_TP.html" rel="" target="">
 <span class="dropdown-text">Récupérer des données avec des API depuis Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04b_regex_TP.html" rel="" target="">
 <span class="dropdown-text">Maîtriser les expressions régulières</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/07_dask.html" rel="" target="">
 <span class="dropdown-text">Introduction à dask grâce aux données DVF</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-communiquer" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Communiquer</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-communiquer">    
        <li>
    <a class="dropdown-item" href="../../content/visualisation/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/visualisation/matplotlib.html" rel="" target="">
 <span class="dropdown-text">De beaux graphiques avec python: mise en pratique</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/visualisation/maps.html" rel="" target="">
 <span class="dropdown-text">De belles cartes avec python: mise en pratique</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-modéliser" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Modéliser</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-modéliser">    
        <li>
    <a class="dropdown-item" href="../../content/modelisation/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/0_preprocessing.html" rel="" target="">
 <span class="dropdown-text">Préparation des données pour construire un modèle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/1_modelevaluation.html" rel="" target="">
 <span class="dropdown-text">Evaluer la qualité d’un modèle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/2_SVM.html" rel="" target="">
 <span class="dropdown-text">Classification: premier modèle avec les SVM</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/3_regression.html" rel="" target="">
 <span class="dropdown-text">Régression : une introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/4_featureselection.html" rel="" target="">
 <span class="dropdown-text">Sélection de variables : une introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/5_clustering.html" rel="" target="">
 <span class="dropdown-text">Clustering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/6_pipeline.html" rel="" target="">
 <span class="dropdown-text">Premier pas vers l’industrialisation avec les pipelines scikit</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-approfondissements" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Approfondissements</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-approfondissements">    
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/continuous_integration.html" rel="" target="">
 <span class="dropdown-text">Intégration continue avec Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/dallE.html" rel="" target="">
 <span class="dropdown-text">Génération d’images avec Python, DALL-E et StableDiffusion</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/s3.html" rel="" target="">
 <span class="dropdown-text">Les nouveaux modes d’accès aux données : le format parquet et les données sur le cloud</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/elastic_approfondissement.html" rel="" target="">
 <span class="dropdown-text">Approfondissement ElasticSearch pour des recherches de proximité géographique</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/elastic_intro.html" rel="" target="">
 <span class="dropdown-text">Introduction à ElasticSearch pour la recherche textuelle</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-git" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Git</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-git">    
        <li>
    <a class="dropdown-item" href="../../content/git/index.html" rel="" target="">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/git/introgit.html" rel="" target="">
 <span class="dropdown-text">Git : un élément essentiel au quotidien</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/git/exogit.html" rel="" target="">
 <span class="dropdown-text">Un cadavre exquis pour découvrir Git</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-annexes" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Annexes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-annexes">    
        <li>
    <a class="dropdown-item" href="../../content/annexes/evaluation.html" rel="" target="">
 <span class="dropdown-text">Evaluation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/annexes/corrections.html" rel="" target="">
 <span class="dropdown-text">Corrections</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://linogaliana.github.io/python-datascientist-slides/#/title-slide" rel="" target="">
 <span class="dropdown-text">Slides de présentation</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="https://github.com/linogaliana/python-datascientist">
            Code source
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../content/modelisation/6_pipeline.html">Premier pas vers l’industrialisation avec les pipelines scikit</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns">
                <div id="title-block-header-title" class="quarto-title page-columns page-full page-layout-full featured-image p-4" style="background-image: url(featured.png);">
                <h1 class="title">Premier pas vers l’industrialisation avec les pipelines scikit</h1>
                                    <div class="quarto-categories">
                        <div class="quarto-category">Modélisation</div>
                        <div class="quarto-category">Tutoriel</div>
                      </div>
                          </div>
        
                <div>
          <div id="title-block-title-desc" class="description pt-4">
            <p>Les <em>pipelines</em> <code>scikit</code> permettent d’intégrer de manière très flexible
            un ensemble d’opérations de pre-processing et d’entraînement de modèles
            dans une chaîne d’opérations. Il s’agit d’une approche particulièrement
            appropriée pour réduire la difficulté à changer d’algorithme ou pour
            faciliter la ré-application d’un code à de nouvelles données</p>
          </div>
        </div>
                
        
        <div class="quarto-title-meta">

            <div>
            <div class="quarto-title-meta-heading">Author</div>
            <div class="quarto-title-meta-contents">
                     <p>Lino Galiana </p>
                  </div>
          </div>
            
            <div>
            <div class="quarto-title-meta-heading">Published</div>
            <div class="quarto-title-meta-contents">
              <p class="date">October 20, 2020</p>
            </div>
          </div>
          
            
          </div>
          
        
        
        

        </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/0_preprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Préparation des données pour construire un modèle</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/1_modelevaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Evaluer la qualité d’un modèle</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/2_SVM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Classification: premier modèle avec les SVM</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/3_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Régression : une introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/4_featureselection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sélection de variables : une introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/5_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Clustering</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/6_pipeline.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Premier pas vers l’industrialisation avec les pipelines scikit</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#pourquoi-utiliser-les-pipelines" id="toc-pourquoi-utiliser-les-pipelines" class="nav-link active" data-scroll-target="#pourquoi-utiliser-les-pipelines">Pourquoi utiliser les pipelines ?</a></li>
  <li><a href="#comment-créer-un-pipeline" id="toc-comment-créer-un-pipeline" class="nav-link" data-scroll-target="#comment-créer-un-pipeline">Comment créer un <em>pipeline</em></a>
  <ul class="collapse">
  <li><a href="#données-utilisées" id="toc-données-utilisées" class="nav-link" data-scroll-target="#données-utilisées">Données utilisées</a></li>
  </ul></li>
  <li><a href="#un-premier-pipeline-random-forest-sur-des-variables-standardisées" id="toc-un-premier-pipeline-random-forest-sur-des-variables-standardisées" class="nav-link" data-scroll-target="#un-premier-pipeline-random-forest-sur-des-variables-standardisées">Un premier pipeline: <em>random forest</em> sur des variables standardisées</a>
  <ul class="collapse">
  <li><a href="#définition-des-ensembles-traintest" id="toc-définition-des-ensembles-traintest" class="nav-link" data-scroll-target="#définition-des-ensembles-traintest">Définition des ensembles train/test</a></li>
  <li><a href="#définition-du-premier-pipeline" id="toc-définition-du-premier-pipeline" class="nav-link" data-scroll-target="#définition-du-premier-pipeline">Définition du premier pipeline</a></li>
  <li><a href="#variable-importance" id="toc-variable-importance" class="nav-link" data-scroll-target="#variable-importance"><em>Variable importance</em></a></li>
  <li><a href="#prédiction" id="toc-prédiction" class="nav-link" data-scroll-target="#prédiction">Prédiction</a></li>
  </ul></li>
  <li><a href="#recherche-des-hyperparamètres-optimaux-avec-une-validation-croisée" id="toc-recherche-des-hyperparamètres-optimaux-avec-une-validation-croisée" class="nav-link" data-scroll-target="#recherche-des-hyperparamètres-optimaux-avec-une-validation-croisée">Recherche des hyperparamètres optimaux avec une validation croisée</a>
  <ul class="collapse">
  <li><a href="#remarque-sur-la-performance" id="toc-remarque-sur-la-performance" class="nav-link" data-scroll-target="#remarque-sur-la-performance">Remarque sur la performance</a></li>
  <li><a href="#remarque-sur-léchantillonnage" id="toc-remarque-sur-léchantillonnage" class="nav-link" data-scroll-target="#remarque-sur-léchantillonnage">Remarque sur l’échantillonnage</a></li>
  </ul></li>
  <li><a href="#eléments-supplémentaires-à-venir" id="toc-eléments-supplémentaires-à-venir" class="nav-link" data-scroll-target="#eléments-supplémentaires-à-venir">Eléments supplémentaires à venir</a></li>
  <li><a href="#annexes-pipelines-alternatifs" id="toc-annexes-pipelines-alternatifs" class="nav-link" data-scroll-target="#annexes-pipelines-alternatifs">Annexes : pipelines alternatifs</a>
  <ul class="collapse">
  <li><a href="#préalable-quelques-méthodes-pour-gagner-en-flexibilité-dans-le-preprocessing" id="toc-préalable-quelques-méthodes-pour-gagner-en-flexibilité-dans-le-preprocessing" class="nav-link" data-scroll-target="#préalable-quelques-méthodes-pour-gagner-en-flexibilité-dans-le-preprocessing">Préalable : quelques méthodes pour gagner en flexibilité dans le preprocessing</a></li>
  </ul></li>
  <li><a href="#références" id="toc-références" class="nav-link" data-scroll-target="#références">Références</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/linogaliana/python-datascientist/edit/master/content/modelisation/6_pipeline.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/linogaliana/python-datascientist/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">

<!-- source: https://github.com/gadenbuie/garrickadenbuie-com/blob/main/_partials/title-block-link-buttons/title-block.html -->
<!-- source: https://raw.githubusercontent.com/spcanelon/silvia/32853dd0e70a71514b0922ee306f80ed5897f776/_partials/title-block-link-buttons/title-block.html -->
<!-- 
<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title"> 
-->
<!-- <header id="title-block-header" class="quarto-title-block default page-columns"> -->
<!-- <div class="quarto-title page-columns page-full featured-image p-4" style="background-image: url(featured.png), url(featured.jpg), url(../featured.jpg);"> -->
    

<div class="cell markdown">
<p class="badges">
<a href="https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/modelisation/6_pipeline.ipynb" class="github"><i class="fab fa-github"></i></a>
<a href="https://downgit.github.io/#/home?url=https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/modelisation/6_pipeline.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Download-Notebook-important?logo=Jupyter" alt="Download"></a>
<a href="https://nbviewer.jupyter.org/github/linogaliana/python-datascientist-notebooksblob/main/notebooks/modelisation/6_pipeline.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Visualize-nbviewer-blue?logo=Jupyter" alt="nbviewer"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/jupyter-python?autoLaunch=true&amp;onyxia.friendlyName=%C2%ABpython-datascience%C2%BB&amp;init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmaster%2Fsspcloud%2Finit-jupyter.sh%C2%BB&amp;init.personalInitArgs=%C2%ABmodelisation%206_pipeline%C2%BB&amp;security.allowlist.enabled=false" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Tester_avec_Jupyter-orange?logo=Jupyter&amp;logoColor=orange" alt="Onyxia"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/vscode-python?autoLaunch=true&amp;onyxia.friendlyName=%C2%ABpython-datascience%C2%BB&amp;init.personalInit=%C2%ABhttps%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmaster%2Fsspcloud%2Finit-vscode.sh%C2%BB&amp;init.personalInitArgs=%C2%ABmodelisation%206_pipeline%C2%BB&amp;security.allowlist.enabled=false" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Tester_avec_VSCode-blue?logo=visualstudiocode&amp;logoColor=blue" alt="Onyxia"></a><br>
<a href="https://mybinder.org/v2/gh/linogaliana/python-datascientist-notebooks/main?filepath={binder_path}" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Launch-Binder-E66581.svg?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFkAAABZCAMAAABi1XidAAAB8lBMVEX///9XmsrmZYH1olJXmsr1olJXmsrmZYH1olJXmsr1olJXmsrmZYH1olL1olJXmsr1olJXmsrmZYH1olL1olJXmsrmZYH1olJXmsr1olL1olJXmsrmZYH1olL1olJXmsrmZYH1olL1olL0nFf1olJXmsrmZYH1olJXmsq8dZb1olJXmsrmZYH1olJXmspXmspXmsr1olL1olJXmsrmZYH1olJXmsr1olL1olJXmsrmZYH1olL1olLeaIVXmsrmZYH1olL1olL1olJXmsrmZYH1olLna31Xmsr1olJXmsr1olJXmsrmZYH1olLqoVr1olJXmsr1olJXmsrmZYH1olL1olKkfaPobXvviGabgadXmsqThKuofKHmZ4Dobnr1olJXmsr1olJXmspXmsr1olJXmsrfZ4TuhWn1olL1olJXmsqBi7X1olJXmspZmslbmMhbmsdemsVfl8ZgmsNim8Jpk8F0m7R4m7F5nLB6jbh7jbiDirOEibOGnKaMhq+PnaCVg6qWg6qegKaff6WhnpKofKGtnomxeZy3noG6dZi+n3vCcpPDcpPGn3bLb4/Mb47UbIrVa4rYoGjdaIbeaIXhoWHmZYHobXvpcHjqdHXreHLroVrsfG/uhGnuh2bwj2Hxk17yl1vzmljzm1j0nlX1olL3AJXWAAAAbXRSTlMAEBAQHx8gICAuLjAwMDw9PUBAQEpQUFBXV1hgYGBkcHBwcXl8gICAgoiIkJCQlJicnJ2goKCmqK+wsLC4usDAwMjP0NDQ1NbW3Nzg4ODi5+3v8PDw8/T09PX29vb39/f5+fr7+/z8/Pz9/v7+zczCxgAABC5JREFUeAHN1ul3k0UUBvCb1CTVpmpaitAGSLSpSuKCLWpbTKNJFGlcSMAFF63iUmRccNG6gLbuxkXU66JAUef/9LSpmXnyLr3T5AO/rzl5zj137p136BISy44fKJXuGN/d19PUfYeO67Znqtf2KH33Id1psXoFdW30sPZ1sMvs2D060AHqws4FHeJojLZqnw53cmfvg+XR8mC0OEjuxrXEkX5ydeVJLVIlV0e10PXk5k7dYeHu7Cj1j+49uKg7uLU61tGLw1lq27ugQYlclHC4bgv7VQ+TAyj5Zc/UjsPvs1sd5cWryWObtvWT2EPa4rtnWW3JkpjggEpbOsPr7F7EyNewtpBIslA7p43HCsnwooXTEc3UmPmCNn5lrqTJxy6nRmcavGZVt/3Da2pD5NHvsOHJCrdc1G2r3DITpU7yic7w/7Rxnjc0kt5GC4djiv2Sz3Fb2iEZg41/ddsFDoyuYrIkmFehz0HR2thPgQqMyQYb2OtB0WxsZ3BeG3+wpRb1vzl2UYBog8FfGhttFKjtAclnZYrRo9ryG9uG/FZQU4AEg8ZE9LjGMzTmqKXPLnlWVnIlQQTvxJf8ip7VgjZjyVPrjw1te5otM7RmP7xm+sK2Gv9I8Gi++BRbEkR9EBw8zRUcKxwp73xkaLiqQb+kGduJTNHG72zcW9LoJgqQxpP3/Tj//c3yB0tqzaml05/+orHLksVO+95kX7/7qgJvnjlrfr2Ggsyx0eoy9uPzN5SPd86aXggOsEKW2Prz7du3VID3/tzs/sSRs2w7ovVHKtjrX2pd7ZMlTxAYfBAL9jiDwfLkq55Tm7ifhMlTGPyCAs7RFRhn47JnlcB9RM5T97ASuZXIcVNuUDIndpDbdsfrqsOppeXl5Y+XVKdjFCTh+zGaVuj0d9zy05PPK3QzBamxdwtTCrzyg/2Rvf2EstUjordGwa/kx9mSJLr8mLLtCW8HHGJc2R5hS219IiF6PnTusOqcMl57gm0Z8kanKMAQg0qSyuZfn7zItsbGyO9QlnxY0eCuD1XL2ys/MsrQhltE7Ug0uFOzufJFE2PxBo/YAx8XPPdDwWN0MrDRYIZF0mSMKCNHgaIVFoBbNoLJ7tEQDKxGF0kcLQimojCZopv0OkNOyWCCg9XMVAi7ARJzQdM2QUh0gmBozjc3Skg6dSBRqDGYSUOu66Zg+I2fNZs/M3/f/Grl/XnyF1Gw3VKCez0PN5IUfFLqvgUN4C0qNqYs5YhPL+aVZYDE4IpUk57oSFnJm4FyCqqOE0jhY2SMyLFoo56zyo6becOS5UVDdj7Vih0zp+tcMhwRpBeLyqtIjlJKAIZSbI8SGSF3k0pA3mR5tHuwPFoa7N7reoq2bqCsAk1HqCu5uvI1n6JuRXI+S1Mco54YmYTwcn6Aeic+kssXi8XpXC4V3t7/ADuTNKaQJdScAAAAAElFTkSuQmCC" alt="Binder"></a>
<a href="https://colab.research.google.com/github/linogaliana/python-datascientist-notebooks/blob/main/notebooks/modelisation/6_pipeline.ipynb" target="_blank" rel="noopener"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a>
<a href="https://github.dev/linogaliana/python-datascientist-notebooks/notebooks/modelisation/6_pipeline.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/static/v1?logo=visualstudiocode&amp;label=&amp;message=Open%20in%20Visual%20Studio%20Code&amp;labelColor=2c2c32&amp;color=007acc&amp;logoColor=007acc" alt="githubdev"></a>
</p>
<p></p>
</div>
<section id="pourquoi-utiliser-les-pipelines" class="level2">
<h2 class="anchored" data-anchor-id="pourquoi-utiliser-les-pipelines">Pourquoi utiliser les pipelines ?</h2>
<p>Les chapitres précédents ont permis de montrer des bouts de code
épars pour entraîner des modèles ou faire du <em>preprocessing</em>.
Cette démarche est intéressante pour tâtonner mais risque d’être coûteuse
ultérieurement s’il est nécessaire d’ajouter une étape de preprocessing
ou de changer d’algorithme.</p>
<p>Heureusement, <code>scikit</code> propose un excellent outil pour proposer un cadre
général pour créer une chaîne de production <em>machine learning</em>. Il
s’agit des
<a href="https://scikit-learn.org/stable/modules/compose.html"><em>pipelines</em></a>.
Ils présentent de nombreux intérêts, parmi lesquels:</p>
<ul>
<li>Ils sont très <strong>pratiques</strong> et <strong>lisibles</strong>. On rentre des données en entrée, on n’appelle qu’une seule fois les méthodes <code>fit</code> et <code>predict</code> ce qui permet de s’assurer une gestion cohérente des transformations de variables, par exemple après l’appel d’un <code>StandardScaler</code></li>
<li>La <strong>modularité</strong> rend aisée la mise à jour d’un pipeline et renforce la capacité à le réutiliser</li>
<li>Ils permettent de facilement chercher les hyperparamètres d’un modèle. Sans <em>pipeline</em>, écrire un code qui fait du <em>tuning</em> d’hyperparamètres peut être pénible. Avec les <em>pipelines</em>, c’est une ligne de code.</li>
<li>La <strong>sécurité</strong> d’être certain que les étapes de preprocessing sont bien appliquées aux jeux de données désirés avant l’estimation.</li>
</ul>
<div class="cell markdown">
<div class="alert alert-warning" role="alert">
<h3 class="alert-heading anchored"><i class="fa-solid fa-lightbulb"></i> Hint</h3>
<p>Un des intérêts des <em>pipelines</em> scikit est qu’ils fonctionnent aussi avec
des méthodes qui ne sont pas issues de <code>scikit</code>.</p>
<p>Il est possible d’introduire un modèle de réseau de neurone <code>Keras</code> dans
un pipeline <code>scikit</code>.
Pour introduire un modèle économétrique <code>statsmodels</code>
c’est un peu plus coûteux mais nous allons proposer des exemples
qui peuvent servir de modèle et qui montrent que c’est faisable
sans trop de difficulté.</p>
</div>
</div>
</section>
<section id="comment-créer-un-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="comment-créer-un-pipeline">Comment créer un <em>pipeline</em></h2>
<p>Un <em>pipeline</em> est un enchaînement d’opérations qu’on code en enchainant
des pairs <em>(clé, valeur)</em>:</p>
<ul>
<li>la clé est le nom du pipeline, cela peut être utile lorsqu’on va
représenter le <em>pipeline</em> sous forme de diagramme acyclique (visualisation DAG)
ou qu’on veut afficher des informations sur une étape</li>
<li>la valeur représente la transformation à mettre en oeuvre dans le <em>pipeline</em>
(c’est-à-dire, à l’exception de la dernière étape,
mettre en oeuvre une méthode <code>transform</code> et éventuellement une
transformation inverse).</li>
</ul>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>estimators <span class="op">=</span> [(<span class="st">'reduce_dim'</span>, PCA()), (<span class="st">'clf'</span>, SVC())]</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline(estimators)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell markdown">
<div class="alert alert-warning" role="alert">
<h3 class="alert-heading anchored"><i class="fa-solid fa-lightbulb"></i> Hint</h3>
<p>Il est pratique de visualiser un <em>pipeline</em> sous forme de DAG.
Pour cela, dans un notebook, on utilise la configuration
suivante:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> set_config</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>set_config(display<span class="op">=</span><span class="st">'diagram'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Au sein d’une étape de <em>pipeline</em>, les paramètres d’un estimateur
sont accessibles avec la notation <code>&lt;estimator&gt;__&lt;parameter&gt;</code>.
Cela permet de fixer des valeurs pour les arguments des fonctions <code>scikit</code>
qui sont appelées au sein d’un <em>pipeline</em>.
C’est cela qui rendra l’approche des pipelines particulièrement utile
pour la <em>grid search</em>:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">"reduce_dim__n_components"</span>:[<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>], <span class="st">"clf__C"</span>:[<span class="fl">0.1</span>, <span class="dv">10</span>, <span class="dv">100</span>]}</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(pipe, param_grid<span class="op">=</span>param_grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="données-utilisées" class="level3">
<h3 class="anchored" data-anchor-id="données-utilisées">Données utilisées</h3>
<p>Nous allons utiliser les données de transactions immobilières DVF pour chercher
la meilleure manière de prédire, sachant les caractéristiques d’un bien, son
prix.</p>
<p>Ces données peuvent être importées directement depuis <a href="https://www.data.gouv.fr/fr/datasets/demandes-de-valeurs-foncieres/"><code>data.gouv</code></a>:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>mutations <span class="op">=</span> pd.read_csv(<span class="st">'https://www.data.gouv.fr/fr/datasets/r/3004168d-bec4-44d9-a781-ef16f41856a2'</span>, sep <span class="op">=</span> <span class="st">"|"</span>, decimal<span class="op">=</span><span class="st">","</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On propose d’enrichir la base de quelques variables qui pourraient servir
ultérieurement:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mutations[<span class="st">'Date mutation'</span>] <span class="op">=</span> pd.to_datetime(mutations[<span class="st">'Date mutation'</span>], <span class="bu">format</span> <span class="op">=</span> <span class="st">"</span><span class="sc">%d</span><span class="st">/%m/%Y"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>mutations[<span class="st">'year'</span>] <span class="op">=</span> mutations[<span class="st">'Date mutation'</span>].dt.year</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>mutations[<span class="st">'month'</span>] <span class="op">=</span> mutations[<span class="st">'Date mutation'</span>].dt.month</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>mutations[<span class="st">'dep'</span>] <span class="op">=</span> mutations[<span class="st">'Code postal'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>[:<span class="dv">2</span>]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>mutations[<span class="st">'lprix'</span>] <span class="op">=</span> np.log(mutations[<span class="st">"Valeur fonciere"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si vous travaillez avec les données de 2020, n’oubliez pas
d’intégrer l’effet
confinement strict dans vos modèles. Pour cela, vous pouvez créer une variable
indicatrice entre les dates en question:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mutations[<span class="st">'confinement'</span>] <span class="op">=</span> mutations[<span class="st">'Date mutation'</span>].between(pd.to_datetime(<span class="st">"2020-03-17"</span>), pd.to_datetime(<span class="st">"2020-05-03"</span>)).astype(<span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Les données DVF proposent une observation par transaction. Ces transactions
peuvent concerner plusieurs lots.
Pour simplifier,
on va créer une variable de surface qui agrège les différentes informations
de surface disponibles dans le jeu de données. En effet, les variables
en question sont très corrélées les unes entre elles :</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>g.figure.get_figure()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Les agréger revient à supposer que le modèle de fixation des prix est le même
entre chaque lot. C’est une hypothèse simplificatrice qu’une personne plus
experte du marché immobilier, ou qu’une approche propre de sélection
de variable pourrait amener à nier</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mutations[<span class="st">'surface'</span>] <span class="op">=</span> mutations.loc[:, mutations.columns[mutations.columns.<span class="bu">str</span>.startswith(<span class="st">'Surface Carrez'</span>)].tolist()].<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="un-premier-pipeline-random-forest-sur-des-variables-standardisées" class="level2">
<h2 class="anchored" data-anchor-id="un-premier-pipeline-random-forest-sur-des-variables-standardisées">Un premier pipeline: <em>random forest</em> sur des variables standardisées</h2>
<p>Notre premier <em>pipeline</em> va nous permettre d’intégrer ensemble:</p>
<ol type="1">
<li>Une étape de <em>preprocessing</em> avec la standardisation de variables</li>
<li>Une étape d’estimation du prix en utilisant un modèle de <em>random forest</em></li>
</ol>
<p>Pour le moment, on va prendre comme acquis un certain nombre de variables
explicatives (les <em>features</em>) et les hyperparamètres du modèle</p>
<section id="définition-des-ensembles-traintest" class="level3">
<h3 class="anchored" data-anchor-id="définition-des-ensembles-traintest">Définition des ensembles train/test</h3>
<p>Nous allons donc nous restreindre à un sous-ensemble de colonnes dans un
premier temps :</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>xvars <span class="op">=</span> [<span class="st">'dep'</span>, <span class="st">'Nombre de lots'</span>, <span class="st">'Code type local'</span>, <span class="st">'surface'</span>, <span class="st">'Nombre pieces principales'</span>]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>xvars2 <span class="op">=</span> pd.Series(xvars).<span class="bu">str</span>.replace(<span class="st">" "</span>,<span class="st">"_"</span>).tolist()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>mutations2 <span class="op">=</span> mutations.loc[:, xvars <span class="op">+</span> [<span class="st">"Valeur fonciere"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous allons également ne conserver que les transactions inférieures à 5 millions
d’euros (on anticipe que celles ayant un montant supérieur sont des transactions
exceptionnelles dont le mécanisme de fixation du prix diffère)</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mutations2  <span class="op">=</span> mutations2.dropna()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>mutations2 <span class="op">=</span> mutations2.loc[mutations2[<span class="st">'Valeur fonciere'</span>] <span class="op">&lt;</span> <span class="fl">5e6</span>] <span class="co">#keep only values below 10 millions</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>mutations2.columns <span class="op">=</span> mutations2.columns.<span class="bu">str</span>.replace(<span class="st">" "</span>, <span class="st">"_"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>numeric_features <span class="op">=</span> mutations2.columns[<span class="op">~</span>mutations2.columns.isin([<span class="st">'dep'</span>,<span class="st">'Code_type_local'</span>, <span class="st">'confinement'</span>])].tolist()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> [<span class="st">'dep'</span>,<span class="st">'Code_type_local'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Au passage, nous avons abandonné la variable de code postal pour privilégier
la commune afin de réduire la dimension de notre jeu de données. Si on voulait
vraiment avoir un bon modèle, il faudrait faire autrement car le code postal
est probablement un très bon prédicteur du prix d’un bien, une fois que
les caractéristiques du bien sont contrôlées.</p>
<p>Nous allons stratifier notre échantillonage de train/test par département
afin de tenir compte, de manière minimale, de la géographie.
Pour accélérer les calculs pour ce tutoriel, nous n’allons considérer que
20% des transactions observées sur chaque département.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>mutations2 <span class="op">=</span> mutations2.groupby(<span class="st">'dep'</span>).sample(frac <span class="op">=</span> <span class="fl">0.2</span>, random_state <span class="op">=</span> <span class="dv">123</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(mutations2[xvars2], mutations2[[<span class="st">"Valeur_fonciere"</span>]].values.ravel(), test_size <span class="op">=</span> <span class="fl">0.2</span>, random_state <span class="op">=</span> <span class="dv">0</span>, stratify<span class="op">=</span>mutations2[[<span class="st">'dep'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="définition-du-premier-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="définition-du-premier-pipeline">Définition du premier pipeline</h3>
<p>Nous allons donc partir d’un <em>random forest</em> avec des valeurs d’hyperparamètres
données.</p>
<p>Les <em>random forest</em> sont une méthode d’aggrégation<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> d’arbres de décision.
On calcule <span class="math inline">\(K\)</span> arbres de décision et en tire, par une méthode d’agrégation,
une règle de décision moyenne qu’on va appliquer pour tirer une
prédiction de nos données.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://upload.wikimedia.org/wikipedia/commons/7/76/Random_forest_diagram_complete.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://upload.wikimedia.org/wikipedia/commons/7/76/Random_forest_diagram_complete.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p>C’est un article de Léo Breiman (2001)<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, statisticien à Berkeley, qui
est à l’origine du succès des <em>random forests</em>. L’un des intérêts
des <em>random forest</em> est qu’il existe des méthodes pour déterminer
l’importance relative de chaque variable dans la prédiction.</p>
<p>Pour commencer, nous allons fixer la taille des arbres de décision avec
l’hyperparamètre <code>max_depth = 2</code>.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>regr <span class="op">=</span> RandomForestRegressor(max_depth<span class="op">=</span><span class="dv">2</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notre <em>pipeline</em> va intégrer les étapes suivantes :</p>
<ol type="1">
<li><strong>Preprocessing</strong> :
<ul>
<li>Les variables numériques vont être standardisées avec un <code>StandardScaler</code>.
Pour cela, nous allons utiliser la liste <code>numeric_features</code> définie précédemment.</li>
<li>Les variables catégorielles vont être explosées avec un <em>one hot encoding</em>
(méthode <code>OneHotEncoder</code> de <code>scikit</code>)
Pour cela, nous allons utiliser la liste <code>categorical_features</code></li>
</ul></li>
<li><strong>Random forest</strong> : nous allons appliquer l’estimateur <code>regr</code> défini plus haut</li>
</ol>
<p>J’ajoute en commentaire un exemple de comment s’introduirait une imputation
de valeurs manquantes. La version 1.0 de <code>scikit</code> facilite l’intégration
d’étapes complexes dans les pipelines<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Si vous utilisez une
version antérieure à la 1.0 de <code>scikit</code>, vous pouvez vous rendre dans
la section <a href="#annexe">Annexe</a> pour avoir des exemples de définition alternative
(attention cependant, vous ne pourrez récupérer le nom des <em>features</em>
transformées comme ici, ce qui peut pénaliser l’analyse d’importance
de variables)</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, OneHotEncoder</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>numeric_pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#SimpleImputer(),</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  StandardScaler()</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>transformer <span class="op">=</span> make_column_transformer(</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    (numeric_pipeline, numeric_features[:<span class="op">-</span><span class="dv">1</span>]),</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    (OneHotEncoder(sparse <span class="op">=</span> <span class="va">False</span>, handle_unknown <span class="op">=</span> <span class="st">"ignore"</span>), categorical_features))</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'preprocessor'</span>, transformer),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                      (<span class="st">'randomforest'</span>, regr)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous avons construit ce pipeline sous forme de couches successives. La couche
<code>randomforest</code> prendra automatiquement le résultat de la couche <code>preprocessor</code>
en <em>input</em>. La couche <code>features</code> permet d’introduire de manière relativement
simple (quand on a les bonnes méthodes) la complexité du <em>preprocessing</em>
sur données réelles dont les types divergent.</p>
<p>On peut visualiser le graphe et ainsi se représenter la manière dont
ce <em>pipeline</em> opère:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>pipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Maintenant, il ne reste plus qu’à estimer notre modèle sur l’ensemble
d’entraînement. C’est très simple avec un <em>pipeline</em> : il suffit d’utiliser
de mettre à jour le <em>pipeline</em> avec la méthode <code>fit</code></p>
<p>On peut utiliser le nom du pipeline en conjonction de certaines méthodes
pour appliquer cette étape sur un jeu de données pour visualiser
l’effet de la transformation.</p>
<p>Par exemple, pour visualiser le jeu de données transformé avant l’étape
d’estimation, on peut
faire</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>pipe[:<span class="op">-</span><span class="dv">1</span>].fit_transform(X_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>De même, si on veut récupérer le nom des <em>features</em> en sortie du preprocessing,
on utilisera la méthode <code>.get_feature_names_out</code> qui est bien pratique
(c’est cette méthode qui est plus complexe à appeler dans les versions <code>scikit</code>
ancienne qui nous a fait privilégier le <em>pipeline</em> ci-dessous)</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>features_names<span class="op">=</span>pipe[<span class="st">'preprocessor'</span>].get_feature_names_out()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>features_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="variable-importance" class="level3">
<h3 class="anchored" data-anchor-id="variable-importance"><em>Variable importance</em></h3>
<p>On ne va représenter, parmi notre ensemble important de colonnes, que celles
qui ont une importance non nulle. Grâce à notre vecteur <code>features_names</code>,
on va pouvoir facilement afficher le nom des colonnes en question (et donc
comprendre les <em>features</em> déterminantes)</p>
<p>L’importance va être définie à partir
de la mesure d’impureté<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>On voit donc que deux variables déterminantes sont des effets fixes
géographiques (qui servent à ajuster de la différence de prix entre
Paris et les Hauts de Seine et le reste de la France), une autre variable
est un effet fixe type de bien. Les deux variables qui pourraient introduire
de la variabilité, à savoir la surface et, dans une moindre mesure, le
nombre de lots, ont une importance moindre.</p>
<div class="cell markdown">
<div class="alert alert-info" role="alert">
<h3 class="alert-heading anchored"><i class="fa-solid fa-comment"></i> Note</h3>
<p>Idéalement, on utiliserait <code>yellowbrick</code> pour représenter l’importance des variables
Mais en l’état actuel du <em>pipeline</em> on a beaucoup de variables dont le poids
est nul qui viennent polluer la visualisation. Vous pouvez
consulter la
<a href="https://www.scikit-yb.org/en/latest/api/model_selection/importances.html">documentation de <code>yellowbrick</code> sur ce sujet</a></p>
</div>
</div>
</section>
<section id="prédiction" class="level3">
<h3 class="anchored" data-anchor-id="prédiction">Prédiction</h3>
<p>L’analyse de l’importance de variables permet de mieux comprendre
le fonctionnement interne des <em>random forests</em>.</p>
<p>On obtient un modèle dont les performances sont les suivantes :</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>compar <span class="op">=</span> pd.DataFrame([y_test, pipe.predict(X_test)]).T</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>compar.columns <span class="op">=</span> [<span class="st">'obs'</span>,<span class="st">'pred'</span>]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>compar[<span class="st">'diff'</span>] <span class="op">=</span> compar.obs <span class="op">-</span> compar.pred</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Le RMSE sur le jeu de test est {:,}"</span>.<span class="bu">format</span>(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>   <span class="bu">int</span>(np.sqrt(mean_squared_error(y_test, pipe.predict(X_test))))</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le RMSE n’est pas très bon. Pour comprendre pourquoi, représentons
notre nuage de point des valeurs observées et prédites:</p>
<p>C’est très décevant. La prédiction a trop peu de variabilité pour capturer
la variance des prix observée. Cela vient du fait que les variables
ayant de l’importance dans la prédiction sont principalement des effets fixes,
qui ne permettent donc qu’une variabilité limitée.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>g.figure.get_figure()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="recherche-des-hyperparamètres-optimaux-avec-une-validation-croisée" class="level2">
<h2 class="anchored" data-anchor-id="recherche-des-hyperparamètres-optimaux-avec-une-validation-croisée">Recherche des hyperparamètres optimaux avec une validation croisée</h2>
<p>On détecte que le premier modèle n’est pas très bon et ne nous aidera
pas vraiment à évaluer de manière fiable la maison de nos rêves.</p>
<p>On va essayer de voir si notre modèle ne serait pas meilleur avec des
hyperparamètres plus adaptés. Après tout, nous avons choisi par défaut
la profondeur de l’arbre mais c’était un choix au doigt mouillé.</p>
<p>Quels sont les hyperparamètres qu’on peut essayer d’optimiser ?</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>pipe[<span class="st">'randomforest'</span>].get_params()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Un <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html">détour par la documentation</a>
nous aide à comprendre ceux sur lesquels on va jouer. Par exemple, il serait
absurde de jouer sur le paramètre <code>random_state</code> qui est la racine du générateur
pseudo-aléatoire.</p>
<p>Comme l’objectif est de se concentrer sur la démarche plus qu’essayer de
trouver un bon modèle,
nous allons également réduire la taille des données pour accélérer
les calculs</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>mutations2 <span class="op">=</span> mutations2.groupby(<span class="st">'dep'</span>).sample(frac <span class="op">=</span> <span class="fl">0.5</span>, random_state <span class="op">=</span> <span class="dv">123</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(mutations2[xvars2], mutations2[[<span class="st">"Valeur_fonciere"</span>]].values.ravel(), test_size <span class="op">=</span> <span class="fl">0.2</span>, random_state <span class="op">=</span> <span class="dv">0</span>, stratify<span class="op">=</span>mutations2[[<span class="st">'dep'</span>]])</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.concat((X_train, X_test), axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> np.concatenate([y_train,y_test])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous allons nous contenter de jouer sur les paramètres:</p>
<ul>
<li><code>n_estimators</code>: Le nombre d’arbres de décision que notre forêt contient</li>
<li><code>max_depth</code>: La profondeur de chaque arbre</li>
</ul>
<p>Il existe plusieurs manières de faire de la validation croisée. Nous allons ici
utiliser la <em>grid search</em> qui consiste à estimer et tester le modèle sur chaque
combinaison d’une grille de paramètres et sélectionner le couple de valeurs
des hyperparamètres amenant à la meilleure prédiction. Par défaut, <code>scikit</code>
effectue une <em>5-fold cross validation</em>. Nous n’allons pas changer
ce comportement.</p>
<p>Comme expliqué précédemment, les paramètres s’appelent sous la forme
<code>&lt;step&gt;__&lt;parameter_name&gt;</code></p>
<p>La validation croisée pouvant être très consommatrice de temps, nous
n’allons l’effectuer que sur un nombre réduit de valeurs de notre grille.
Il est possible de passer la liste des valeurs à passer au crible sous
forme de liste (comme pour l’argument <code>max_depth</code> ci-dessous) ou
sous forme d’<code>array</code> (comme pour l’argument <code>n_estimators</code>) ce qui est
souvent pratique pour générer un criblage d’un intervalle avec <code>np.linspace</code>.</p>
<p>On peut récupérer les paramètres optimaux avec la méthode <code>best_params_</code>:</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>grid_search.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On pourra aussi ré-utiliser le modèle optimal de la manière suivante :</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>grid_search.best_estimator_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Toutes les performances sur les ensembles d’échantillons et de test sur la grille
d’hyperparamètres sont disponibles dans l’attribut:</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>perf_random_forest <span class="op">=</span> pd.DataFrame(grid_search.cv_results_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Regardons les résultats moyens pour chaque valeur des hyperparamètres:</p>
<p>Globalement, à profondeur d’arbre donnée, le nombre d’arbres change
marginalement la performance (cela détériore
la performance quand la profondeur est de 4, cela améliore quand
on fixe la profondeur de 2).
En revanche, changer la profondeur de l’arbre améliore la
performance de manière plus marquée.</p>
<p>Maintenant, il nous reste à re-entraîner le modèle avec ces nouveaux
paramètres sur l’ensemble du jeu de <em>train</em> et l’évaluer sur l’ensemble
du jeu de <em>test</em>:</p>
<p>On obtient le RMSE suivant :</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Le RMSE sur le jeu de test est {:,}"</span>.<span class="bu">format</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>   <span class="bu">int</span>(np.sqrt(mean_squared_error(y_test, pipe_optimal.predict(X_test))))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Et si on regarde la qualité en prédiction:</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>g.figure.get_figure()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On obtient plus de variance dans la prédiction, c’est déjà un peu mieux.
Cependant, cela reste décevant pour plusieurs raisons:</p>
<ul>
<li>nous n’avons pas fait d’étape de sélection de variable</li>
<li>nous n’avons pas chercher à déterminer si la variable à prédire la plus
pertinente était le prix ou une transformation de celle-ci
(par exemple le prix au <span class="math inline">\(m^2\)</span>)</li>
</ul>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>features_names<span class="op">=</span>pipe_optimal[<span class="st">'preprocessor'</span>].get_feature_names_out()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> pipe_optimal[<span class="st">'randomforest'</span>].feature_importances_</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>std <span class="op">=</span> np.std([tree.feature_importances_ <span class="cf">for</span> tree <span class="kw">in</span> pipe_optimal[<span class="st">'randomforest'</span>].estimators_], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>forest_importances <span class="op">=</span> pd.Series(importances[importances<span class="op">&gt;</span><span class="dv">0</span>], index<span class="op">=</span>features_names[importances<span class="op">&gt;</span><span class="dv">0</span>])</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>forest_importances.plot.bar(yerr<span class="op">=</span>std[importances<span class="op">&gt;</span><span class="dv">0</span>], ax<span class="op">=</span>ax)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Feature importances using MDI"</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Mean decrease in impurity"</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="remarque-sur-la-performance" class="level3">
<h3 class="anchored" data-anchor-id="remarque-sur-la-performance">Remarque sur la performance</h3>
<p>Les estimations sont, par défaut, menées de manière séquentielle (l’une après
l’autre). Nous sommes cependant face à un problème
<em>embarassingly parallel</em>.
Pour gagner en performance, il est recommandé d’utiliser l’argument
<code>n_jobs=-1</code>.</p>
</section>
<section id="remarque-sur-léchantillonnage" class="level3">
<h3 class="anchored" data-anchor-id="remarque-sur-léchantillonnage">Remarque sur l’échantillonnage</h3>
<p>En l’état actuel de l’échantillonnage entre train et test au sein de la
<em>grid search</em>,
on est face à un problème de <em>data leaking</em> car l’échantillon
n’est pas balancé entre nos classes (les départements).</p>
<p>Certaines classes se
retrouvent hors de l’échantillon d’estimation mais dans l’échantillon de prédiction.
Autrement dit, notre <em>pipeline</em> de <em>preprocessing</em> se retrouve à devoir
nettoyer des valeurs qu’il ne connaît pas.</p>
<p>Nous avons choisi une option, dans notre <em>pipeline</em> pour se faciliter la vie
à ce propos. Nous ne rencontrons pas d’erreur car nous avons utilisé l’option
<code>handle_unknown = "ignore"</code> plutôt que
<code>handle_unknown = "error"</code> (défaut) dans le <em>one hot encoding</em>.
Cette option est dangereuse et n’est pas recommandée pour un vrai <em>pipeline</em>.
De manière générale, il vaut mieux adopter une approche de
programmation défensive en n’hésitant pas à renvoyer une erreur si la
structure du <em>DataFrame</em> de prédiction diffère vraiment de celle du <em>DataFrame</em>
d’entraînement.</p>
<p>Pour éviter cette erreur, il serait mieux de définir explicitement le schéma de
validation croisée à mettre en oeuvre.
Précédemment, nous avions utilisé un échantillonnage stratifié.
Cela pourrait être fait ici avec
la méthode <code>StratifiedGroupKFold</code> (plus d’éléments à venir)</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> StratifiedGroupKFold</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>cv <span class="op">=</span> StratifiedGroupKFold(n_splits<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#grid_search.fit(pd.concat((X_train, X_test), axis=0), np.concatenate([y_train,y_test]), cv = cv, groups = pd.concat((X_train, X_test), axis=0)['dep'])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="eléments-supplémentaires-à-venir" class="level2">
<h2 class="anchored" data-anchor-id="eléments-supplémentaires-à-venir">Eléments supplémentaires à venir</h2>
<p>Ce chapitre est amené à être enrichi des éléments suivants
(cf.&nbsp;<a href="https://github.com/linogaliana/python-datascientist/issues/207">#207</a>)</p>
<ul class="task-list">
<li><input type="checkbox">Comparaison performance entre modèles grâce aux pipelines</li>
<li><input type="checkbox">Intégration d’une étape de sélection de variable dans un pipeline</li>
<li><input type="checkbox"><code>statsmodels</code> dans un pipeline</li>
<li><input type="checkbox"><code>Keras</code> dans un pipeline</li>
</ul>
</section>
<section id="annexes-pipelines-alternatifs" class="level2">
<h2 class="anchored" data-anchor-id="annexes-pipelines-alternatifs">Annexes : pipelines alternatifs</h2>
<section id="préalable-quelques-méthodes-pour-gagner-en-flexibilité-dans-le-preprocessing" class="level3">
<h3 class="anchored" data-anchor-id="préalable-quelques-méthodes-pour-gagner-en-flexibilité-dans-le-preprocessing">Préalable : quelques méthodes pour gagner en flexibilité dans le preprocessing</h3>
<p>Notre <em>DataFrame</em> comporte des types hétérogènes de variables:</p>
<ul>
<li>Des variables numériques dont les variances sont très hétérogènes</li>
<li>Des variables textuelles qui mériteraient un recodage sous forme numérique</li>
<li>Des variables discrètes dont les modalités devraient être éclatées (<em>one hot encoding</em>)</li>
</ul>
<p>Pour gagner en flexibilité, nous allons proposer certaines méthodes qui permettent
d’appliquer les étapes de <em>preprocessing</em> adéquates à un sous-ensemble de
variables<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. Ces méthodes ne sont plus nécessaires dans les versions
récentes de <code>scikit</code>.</p>
<p>Pour cela, il convient d’adopter l’approche de la programmation orientée objet.
On va créer des classes avec des méthodes <code>transform</code> et <code>fit_transform</code>
qui pourront ainsi être intégrées directement dans les <em>pipelines</em>, comme s’il
s’agissait de méthodes issues de <code>scikit</code>.</p>
<p>La première généralise <code>LabelEncoder</code> à un sous-ensemble de colonnes:</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder, OneHotEncoder</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MultiColumnLabelEncoder:</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,columns <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.columns <span class="op">=</span> columns <span class="co"># array of column names to encode</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>,X,y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span> <span class="co"># not relevant here</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>,X):</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">'''</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Transforms columns of X specified in self.columns using</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co">        LabelEncoder(). If no columns specified, transforms all</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co">        columns in X.</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co">        '''</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> X.copy()</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.columns <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> col <span class="kw">in</span> <span class="va">self</span>.columns:</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>                output[col] <span class="op">=</span> LabelEncoder().fit_transform(output[col])</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> colname,col <span class="kw">in</span> output.iteritems():</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>                output[colname] <span class="op">=</span> LabelEncoder().fit_transform(col)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> output</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit_transform(<span class="va">self</span>,X,y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.fit(X,y).transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La seconde généralise cette fois le <em>one hot encoding</em> à un sous ensemble de
fonctions</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MultiColumnOneHotEncoder:</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,columns <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.columns <span class="op">=</span> columns <span class="co"># array of column names to encode</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>,X,y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span> <span class="co"># not relevant here</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>,X):</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">'''</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Transforms columns of X specified in self.columns using</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">        LabelEncoder(). If no columns specified, transforms all</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">        columns in X.</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co">        '''</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> X.copy()</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.columns <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> col <span class="kw">in</span> <span class="va">self</span>.columns:</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>                output[col] <span class="op">=</span> OneHotEncoder(sparse<span class="op">=</span><span class="va">False</span>).fit_transform(output[col])</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> colname,col <span class="kw">in</span> output.iteritems():</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>                output[colname] <span class="op">=</span> OneHotEncoder(sparse<span class="op">=</span><span class="va">False</span>).fit_transform(col)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> output</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit_transform(<span class="va">self</span>,X,y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.fit(X,y).transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Les méthodes suivantes vont nous permettre de passer en arguments les noms
de colonnes pour intégrer la récupération des bonnes colonnes de nos
dataframes dans le pipeline:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.base <span class="im">import</span> BaseEstimator, TransformerMixin, RegressorMixin</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Columns(BaseEstimator, TransformerMixin):</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, names<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.names <span class="op">=</span> names</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y<span class="op">=</span><span class="va">None</span>, <span class="op">**</span>fit_params):</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, X):</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> X[<span class="va">self</span>.names]</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Normalize(BaseEstimator, TransformerMixin):</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, func<span class="op">=</span><span class="va">None</span>, func_param<span class="op">=</span>{}):</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.func <span class="op">=</span> func</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.func_param <span class="op">=</span> func_param</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, X):</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.func <span class="op">!=</span> <span class="va">None</span>:</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.func(X, <span class="op">**</span><span class="va">self</span>.func_param)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> X</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y<span class="op">=</span><span class="va">None</span>, <span class="op">**</span>fit_params):</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Enfin, on va créer une méthode intermédiaire sous forme de <em>hack</em>
(elle prend une matrice en entrée et renvoie la même matrice)
pour
pouvoir facilement récupérer notre matrice de <em>feature</em> afin de vérifier
ses caractéristiques (notamment le nombre de colonnes disponibles):</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Collect(BaseEstimator, TransformerMixin):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, X):</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print(X.shape)</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">#self.shape = shape</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># what other output you want</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> X</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y<span class="op">=</span><span class="va">None</span>, <span class="op">**</span>fit_params):</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline, FeatureUnion</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelEncoder, OneHotEncoder</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>pipe2 <span class="op">=</span> Pipeline([</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"features"</span>, FeatureUnion([</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'numeric'</span>, make_pipeline(Columns(names<span class="op">=</span>numeric_features[:<span class="op">-</span><span class="dv">1</span>]),StandardScaler())),</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'categorical'</span>, make_pipeline(Columns(names<span class="op">=</span>categorical_features),OneHotEncoder(sparse<span class="op">=</span><span class="va">False</span>)))</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    ])),</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'identity'</span>, Collect()),</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'randomforest'</span>, regr)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    transformers<span class="op">=</span>[</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'numeric'</span>, StandardScaler(), numeric_features[:<span class="op">-</span><span class="dv">1</span>]),</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'categorical'</span>, OneHotEncoder(sparse<span class="op">=</span><span class="va">False</span>, handle_unknown <span class="op">=</span> <span class="st">"ignore"</span>), categorical_features)])</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>pipe3 <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'preprocessor'</span>, preprocessor),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                      (<span class="st">'randomforest'</span>, regr)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="références" class="level2">
<h2 class="anchored" data-anchor-id="références">Références</h2>
<ul>
<li>Breiman L (2001). <em>“Random Forests”. Machine Learning</em>. 45 (1): 5–32.</li>
</ul>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>En <em>machine learning</em> on retrouve un principe inspiré du
<em>bootstrap</em>
qui permet d’agréger un ensemble d’estimateurs en un estimateur <em>“moyennisé”</em>.
Il s’agit du <a href="https://en.wikipedia.org/wiki/Bootstrap_aggregating"><em>bagging</em></a>.
En économétrie, le <em>bootstrap</em> consiste à ré-estimer sur <em>K</em> sous-échantillons
aléatoires des données un estimateur afin d’en tirer, par exemple, un intervalle
de confiance empirique à 95%. Le principe du <em>bagging</em> est le même. On ré-estime
<em>K</em> fois notre estimateur (par exemple un arbre de décision) et propose une
règle d’agrégation pour en tirer une règle moyennisée et donc une prédiction.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Extrait de <a href="https://mljar.com/blog/feature-importance-in-random-forest/">ce blog</a>:
Gini importance (or mean decrease impurity), which is computed from the Random Forest structure. Let’s look how the Random Forest is constructed. It is a set of Decision Trees. Each Decision Tree is a set of internal nodes and leaves. In the internal node, the selected feature is used to make decision how to divide the data set into two separate sets with similars responses within. The features for internal nodes are selected with some criterion, which for classification tasks can be gini impurity or infomation gain, and for regression is variance reduction. We can measure how each feature decrease the impurity of the split (the feature with highest decrease is selected for internal node). For each feature we can collect how on average it decreases the impurity. The average over all trees in the forest is the measure of the feature importance.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Voir ce <a href="https://stackoverflow.com/questions/54646709/sklearn-pipeline-get-feature-names-after-onehotencode-in-columntransformer"><em>thread stackoverflow</em></a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Extrait de <a href="https://mljar.com/blog/feature-importance-in-random-forest/">ce blog</a>:
Gini importance (or mean decrease impurity), which is computed from the Random Forest structure. Let’s look how the Random Forest is constructed. It is a set of Decision Trees. Each Decision Tree is a set of internal nodes and leaves. In the internal node, the selected feature is used to make decision how to divide the data set into two separate sets with similars responses within. The features for internal nodes are selected with some criterion, which for classification tasks can be gini impurity or infomation gain, and for regression is variance reduction. We can measure how each feature decrease the impurity of the split (the feature with highest decrease is selected for internal node). For each feature we can collect how on average it decreases the impurity. The average over all trees in the forest is the measure of the feature importance.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Un certain nombre des éléments suivants ont été glannés, par ci par là,
depuis <code>stackoverflow</code>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@book{galiana2023,
  author = {Galiana, Lino},
  title = {Python Pour La Data Science},
  date = {2023},
  url = {https://pythonds.linogaliana.fr/},
  doi = {10.5281/zenodo.8229676},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-galiana2023" class="csl-entry quarto-appendix-citeas" role="listitem">
Galiana, Lino. 2023. <em>Python Pour La Data Science</em>. <a href="https://doi.org/10.5281/zenodo.8229676">https://doi.org/10.5281/zenodo.8229676</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="linogaliana/python-datascientist" data-repo-id="MDEwOlJlcG9zaXRvcnkyODAxNjE2Nzc=" data-category="General" data-category-id="DIC_kwDOELLtjc4B-5TX" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../content/modelisation/5_clustering.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Clustering</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Python pour la <em>data science</em>, Lino Galiana.<br>
Licence <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i><br>
Code source disponible sur <a href="https://github.com/linogaliana/python-datascientist"><code>Github</code></a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Site construit avec <i class="fa-brands fa-python" aria-label="python"></i> et <a href="https://quarto.org/"><code>Quarto</code></a><br>
Inspiration pour la mise en forme du site <a href="https://www.andreashandel.com">ici</a><br>
<a href="https://github.com/linogaliana/python-datascientist">Code source disponible sur <i class="fa-brands fa-github" aria-label="github"></i> <code>GitHub</code></a></div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","selector":".lightbox","loop":true,"openEffect":"zoom","descPosition":"bottom"});</script>



</body></html>